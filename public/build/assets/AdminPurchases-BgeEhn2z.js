import{a as B}from"./adminPaginationMixin-DN7Wb3ng.js";import{_ as j,d as F,w as s,a,r,f as _,t as u,g as M,b as t,c as h,e as v,h as E,F as N,o as m,p as H}from"./app-CHlE1Mvy.js";const R={name:"PurchaseDialog",props:{modelValue:{type:Boolean,default:!1},editingPurchase:{type:Object,default:null},supplierOptions:{type:Array,default:()=>[]},warehouseOptions:{type:Array,default:()=>[]},grnOptions:{type:Array,default:()=>[]},productOptions:{type:Array,default:()=>[]},saving:{type:Boolean,default:!1}},emits:["update:modelValue","save","cancel"],data(){return{activeTab:"basic",localForm:{supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},rules:{required:l=>!!l||"This field is required",minValue:l=>l>0||"Quantity must be greater than 0"}}},computed:{calculatedSubtotal(){return this.localForm.items.reduce((l,e)=>{const n=(e.quantity||0)*(e.unit_price||0)-(e.discount||0);return l+n},0)},calculatedTax(){return this.localForm.items.reduce((l,e)=>l+(e.tax||0),0)},calculatedDiscount(){return this.localForm.items.reduce((l,e)=>l+(e.discount||0),0)},calculatedTotal(){return this.calculatedSubtotal+this.calculatedTax+(this.localForm.shipping_cost||0)-this.calculatedDiscount}},watch:{modelValue(l){l&&this.editingPurchase?this.initializeForm(this.editingPurchase):l&&this.resetForm()},editingPurchase:{handler(l){l&&this.modelValue&&this.initializeForm(l)},deep:!0}},methods:{initializeForm(l){var e;this.activeTab="basic",this.localForm={supplier_id:l.supplier_id,warehouse_id:l.warehouse_id,grn_id:l.grn_id,invoice_date:l.invoice_date,due_date:l.due_date,shipping_cost:l.shipping_cost||0,notes:l.notes||"",items:((e=l.items)==null?void 0:e.map(n=>({product_id:n.product_id,quantity:n.quantity,unit_price:n.unit_price,discount:n.discount||0,tax:n.tax||0,total:n.total||0})))||[]}},resetForm(){this.activeTab="basic",this.localForm={supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},this.$refs.form&&this.$refs.form.resetValidation()},calculateItemTotal(l){const e=this.localForm.items[l];if(e.quantity&&e.unit_price){const n=e.quantity*e.unit_price-(e.discount||0)+(e.tax||0);this.$set(this.localForm.items[l],"total",n)}},calculateTotals(){},addPurchaseItem(){this.localForm.items.push({product_id:null,quantity:1,unit_price:0,discount:0,tax:0,total:0})},removePurchaseItem(l){this.localForm.items.splice(l,1)},handleSave(){if(this.$refs.form.validate()){if(this.localForm.items.length===0){this.$emit("save",{...this.localForm},"Please add at least one item");return}this.$emit("save",{...this.localForm},null)}},handleCancel(){this.resetForm(),this.$emit("cancel")},formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)}}},W={class:"pa-6"},L={class:"pa-6"},Q={class:"d-flex justify-space-between align-center mb-2"},G={key:0},K={key:1},J={class:"font-weight-bold"},X={key:2},Y={key:3},Z={key:4},$={key:5},ee={class:"font-weight-bold"};function te(l,e,n,q,o,i){const V=r("v-card-title"),k=r("v-tab"),f=r("v-tabs"),b=r("v-select"),x=r("v-col"),w=r("v-text-field"),C=r("v-textarea"),I=r("v-row"),y=r("v-window-item"),P=r("v-btn"),U=r("v-table"),T=r("v-window"),p=r("v-form"),A=r("v-card-text"),d=r("v-spacer"),S=r("v-card-actions"),z=r("v-card"),O=r("v-dialog");return m(),F(O,{"model-value":n.modelValue,"onUpdate:modelValue":e[9]||(e[9]=c=>l.$emit("update:modelValue",c)),"max-width":"1000",scrollable:"",persistent:""},{default:s(()=>[a(z,null,{default:s(()=>[a(V,null,{default:s(()=>[_(u(n.editingPurchase?"Edit Purchase Invoice":"New Purchase Invoice"),1)]),_:1}),a(A,{class:"pa-0"},{default:s(()=>[a(p,{ref:"form",onSubmit:M(i.handleSave,["prevent"])},{default:s(()=>[a(f,{modelValue:o.activeTab,"onUpdate:modelValue":e[0]||(e[0]=c=>o.activeTab=c),"bg-color":"grey-lighten-4"},{default:s(()=>[a(k,{value:"basic"},{default:s(()=>e[10]||(e[10]=[_("Basic Information")])),_:1,__:[10]}),a(k,{value:"items"},{default:s(()=>e[11]||(e[11]=[_("Items")])),_:1,__:[11]})]),_:1},8,["modelValue"]),a(T,{modelValue:o.activeTab,"onUpdate:modelValue":e[8]||(e[8]=c=>o.activeTab=c)},{default:s(()=>[a(y,{value:"basic"},{default:s(()=>[t("div",W,[a(I,null,{default:s(()=>[a(x,{cols:"12",md:"6"},{default:s(()=>[a(b,{modelValue:o.localForm.supplier_id,"onUpdate:modelValue":e[1]||(e[1]=c=>o.localForm.supplier_id=c),items:n.supplierOptions,"item-title":"label","item-value":"value",label:"Supplier",rules:[o.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(x,{cols:"12",md:"6"},{default:s(()=>[a(b,{modelValue:o.localForm.warehouse_id,"onUpdate:modelValue":e[2]||(e[2]=c=>o.localForm.warehouse_id=c),items:n.warehouseOptions,"item-title":"label","item-value":"value",label:"Warehouse",rules:[o.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(x,{cols:"12",md:"6"},{default:s(()=>[a(b,{modelValue:o.localForm.grn_id,"onUpdate:modelValue":e[3]||(e[3]=c=>o.localForm.grn_id=c),items:n.grnOptions,"item-title":"label","item-value":"value",label:"GRN (Optional)",clearable:""},null,8,["modelValue","items"])]),_:1}),a(x,{cols:"12",md:"6"},{default:s(()=>[a(w,{modelValue:o.localForm.invoice_date,"onUpdate:modelValue":e[4]||(e[4]=c=>o.localForm.invoice_date=c),label:"Invoice Date",type:"date",rules:[o.rules.required],required:""},null,8,["modelValue","rules"])]),_:1}),a(x,{cols:"12",md:"6"},{default:s(()=>[a(w,{modelValue:o.localForm.due_date,"onUpdate:modelValue":e[5]||(e[5]=c=>o.localForm.due_date=c),label:"Due Date",type:"date"},null,8,["modelValue"])]),_:1}),a(x,{cols:"12",md:"6"},{default:s(()=>[a(w,{modelValue:o.localForm.shipping_cost,"onUpdate:modelValue":e[6]||(e[6]=c=>o.localForm.shipping_cost=c),modelModifiers:{number:!0},label:"Shipping Cost",type:"number",min:"0",step:"0.01",prefix:"৳",onInput:i.calculateTotals},null,8,["modelValue","onInput"])]),_:1}),a(x,{cols:"12"},{default:s(()=>[a(C,{modelValue:o.localForm.notes,"onUpdate:modelValue":e[7]||(e[7]=c=>o.localForm.notes=c),label:"Notes",variant:"outlined",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),a(y,{value:"items"},{default:s(()=>[t("div",L,[t("div",Q,[e[13]||(e[13]=t("h3",{class:"text-h6"},"Invoice Items",-1)),a(P,{size:"small",color:"primary","prepend-icon":"mdi-plus",onClick:i.addPurchaseItem},{default:s(()=>e[12]||(e[12]=[_("Add Item")])),_:1,__:[12]},8,["onClick"])]),a(U,null,{default:s(()=>[e[25]||(e[25]=t("thead",null,[t("tr",null,[t("th",null,"Product"),t("th",null,"Quantity"),t("th",null,"Unit Price"),t("th",null,"Discount"),t("th",null,"Tax"),t("th",null,"Total"),t("th",null,"Actions")])],-1)),t("tbody",null,[(m(!0),h(N,null,E(o.localForm.items,(c,D)=>(m(),h("tr",{key:D},[t("td",null,[a(b,{modelValue:c.product_id,"onUpdate:modelValue":[g=>c.product_id=g,g=>i.calculateItemTotal(D)],items:n.productOptions,"item-title":"label","item-value":"value",density:"compact",rules:[o.rules.required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),t("td",null,[a(w,{modelValue:c.quantity,"onUpdate:modelValue":g=>c.quantity=g,modelModifiers:{number:!0},type:"number",min:"1",density:"compact",onInput:g=>i.calculateItemTotal(D),rules:[o.rules.required,o.rules.minValue]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),t("td",null,[a(w,{modelValue:c.unit_price,"onUpdate:modelValue":g=>c.unit_price=g,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",onInput:g=>i.calculateItemTotal(D),rules:[o.rules.required]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),t("td",null,[a(w,{modelValue:c.discount,"onUpdate:modelValue":g=>c.discount=g,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",onInput:g=>i.calculateItemTotal(D)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),t("td",null,[a(w,{modelValue:c.tax,"onUpdate:modelValue":g=>c.tax=g,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",onInput:g=>i.calculateItemTotal(D)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),t("td",null,u(i.formatCurrency(c.total||0)),1),t("td",null,[a(P,{size:"small",icon:"mdi-delete",variant:"text",color:"error",onClick:g=>i.removePurchaseItem(D)},null,8,["onClick"])])]))),128)),o.localForm.items.length===0?(m(),h("tr",G,e[14]||(e[14]=[t("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items added",-1)]))):v("",!0),o.localForm.items.length>0?(m(),h("tr",K,[e[15]||(e[15]=t("td",{colspan:"5",class:"text-right font-weight-bold"},"Subtotal:",-1)),t("td",J,u(i.formatCurrency(i.calculatedSubtotal)),1),e[16]||(e[16]=t("td",null,null,-1))])):v("",!0),o.localForm.items.length>0?(m(),h("tr",X,[e[17]||(e[17]=t("td",{colspan:"5",class:"text-right"},"Tax:",-1)),t("td",null,u(i.formatCurrency(i.calculatedTax)),1),e[18]||(e[18]=t("td",null,null,-1))])):v("",!0),o.localForm.items.length>0?(m(),h("tr",Y,[e[19]||(e[19]=t("td",{colspan:"5",class:"text-right"},"Shipping:",-1)),t("td",null,u(i.formatCurrency(o.localForm.shipping_cost||0)),1),e[20]||(e[20]=t("td",null,null,-1))])):v("",!0),o.localForm.items.length>0?(m(),h("tr",Z,[e[21]||(e[21]=t("td",{colspan:"5",class:"text-right"},"Discount:",-1)),t("td",null,u(i.formatCurrency(i.calculatedDiscount)),1),e[22]||(e[22]=t("td",null,null,-1))])):v("",!0),o.localForm.items.length>0?(m(),h("tr",$,[e[23]||(e[23]=t("td",{colspan:"5",class:"text-right font-weight-bold"},"Total:",-1)),t("td",ee,u(i.formatCurrency(i.calculatedTotal)),1),e[24]||(e[24]=t("td",null,null,-1))])):v("",!0)])]),_:1,__:[25]})])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),a(S,null,{default:s(()=>[a(d),a(P,{onClick:i.handleCancel,variant:"text"},{default:s(()=>e[26]||(e[26]=[_("Cancel")])),_:1,__:[26]},8,["onClick"]),a(P,{onClick:i.handleSave,color:"primary",loading:n.saving},{default:s(()=>[_(u(n.editingPurchase?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const le=j(R,[["render",te]]),ae={name:"ViewPurchaseDialog",props:{modelValue:{type:Boolean,default:!1},purchase:{type:Object,default:null}},emits:["update:modelValue"],methods:{formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},formatDate(l){return l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"},getStatusColor(l){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[l]||"default"}}},se={class:"pa-6"},oe={class:"text-h6 font-weight-bold"},ne={class:"text-body-1"},ie={class:"text-body-1 font-weight-medium"},re={class:"text-body-1 font-weight-medium"},ue={class:"text-body-1"},de={class:"text-body-1"},ce={class:"text-body-1"},me={class:"mt-4"},pe={class:"font-weight-medium"},he={key:0},_e={class:"d-flex justify-space-between mb-2"},ve={class:"text-body-2 font-weight-medium"},fe={class:"d-flex justify-space-between mb-2"},ge={class:"text-body-2"},ye={class:"d-flex justify-space-between mb-2"},be={class:"text-body-2"},we={class:"d-flex justify-space-between mb-2"},xe={class:"text-body-2"},Ve={class:"d-flex justify-space-between mb-2"},Pe={class:"text-h6 font-weight-bold"},Fe={class:"d-flex justify-space-between mb-2"},ke={class:"text-body-2"},Ce={class:"d-flex justify-space-between"};function Se(l,e,n,q,o,i){const V=r("v-chip"),k=r("v-card-title"),f=r("v-col"),b=r("v-row"),x=r("v-table"),w=r("v-divider"),C=r("v-card-text"),I=r("v-card"),y=r("v-spacer"),P=r("v-btn"),U=r("v-card-actions"),T=r("v-dialog");return m(),F(T,{"model-value":n.modelValue,"onUpdate:modelValue":e[1]||(e[1]=p=>l.$emit("update:modelValue",p)),"max-width":"1000",scrollable:""},{default:s(()=>[n.purchase?(m(),F(I,{key:0},{default:s(()=>[a(k,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[2]||(e[2]=t("span",null,"Purchase Invoice Details",-1)),a(V,{color:i.getStatusColor(n.purchase.status),size:"small"},{default:s(()=>[_(u(n.purchase.status),1)]),_:1},8,["color"])]),_:1,__:[2]}),a(C,{class:"pa-0"},{default:s(()=>[t("div",se,[a(b,{class:"mb-4"},{default:s(()=>[a(f,{cols:"12",md:"6"},{default:s(()=>[e[3]||(e[3]=t("div",{class:"text-caption text-grey mb-1"},"Invoice Number",-1)),t("div",oe,u(n.purchase.invoice_number),1)]),_:1,__:[3]}),a(f,{cols:"12",md:"6"},{default:s(()=>[e[4]||(e[4]=t("div",{class:"text-caption text-grey mb-1"},"Invoice Date",-1)),t("div",ne,u(i.formatDate(n.purchase.invoice_date)),1)]),_:1,__:[4]})]),_:1}),a(b,{class:"mb-4"},{default:s(()=>[a(f,{cols:"12",md:"6"},{default:s(()=>{var p;return[e[5]||(e[5]=t("div",{class:"text-caption text-grey mb-1"},"Supplier",-1)),t("div",ie,u(((p=n.purchase.supplier)==null?void 0:p.name)||"N/A"),1)]}),_:1,__:[5]}),a(f,{cols:"12",md:"6"},{default:s(()=>{var p;return[e[6]||(e[6]=t("div",{class:"text-caption text-grey mb-1"},"Warehouse",-1)),t("div",re,u(((p=n.purchase.warehouse)==null?void 0:p.name)||"N/A"),1)]}),_:1,__:[6]})]),_:1}),a(b,{class:"mb-4"},{default:s(()=>[n.purchase.grn?(m(),F(f,{key:0,cols:"12",md:"6"},{default:s(()=>{var p;return[e[7]||(e[7]=t("div",{class:"text-caption text-grey mb-1"},"GRN",-1)),t("div",ue,u(((p=n.purchase.grn)==null?void 0:p.grn_number)||"N/A"),1)]}),_:1,__:[7]})):v("",!0),n.purchase.due_date?(m(),F(f,{key:1,cols:"12",md:"6"},{default:s(()=>[e[8]||(e[8]=t("div",{class:"text-caption text-grey mb-1"},"Due Date",-1)),t("div",de,u(i.formatDate(n.purchase.due_date)),1)]),_:1,__:[8]})):v("",!0)]),_:1}),n.purchase.notes?(m(),F(b,{key:0,class:"mb-4"},{default:s(()=>[a(f,{cols:"12"},{default:s(()=>[e[9]||(e[9]=t("div",{class:"text-caption text-grey mb-1"},"Notes",-1)),t("div",ce,u(n.purchase.notes),1)]),_:1,__:[9]})]),_:1})):v("",!0),t("div",me,[e[19]||(e[19]=t("h3",{class:"text-h6 mb-3"},"Invoice Items",-1)),a(x,null,{default:s(()=>[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Product"),t("th",null,"SKU"),t("th",null,"Quantity"),t("th",null,"Unit Price"),t("th",null,"Discount"),t("th",null,"Tax"),t("th",null,"Total")])],-1)),t("tbody",null,[(m(!0),h(N,null,E(n.purchase.items,(p,A)=>{var d,S;return m(),h("tr",{key:A},[t("td",null,u(((d=p.product)==null?void 0:d.name)||"N/A"),1),t("td",null,u(((S=p.product)==null?void 0:S.sku)||"N/A"),1),t("td",null,u(p.quantity),1),t("td",null,u(i.formatCurrency(p.unit_price)),1),t("td",null,u(i.formatCurrency(p.discount||0)),1),t("td",null,u(i.formatCurrency(p.tax||0)),1),t("td",pe,u(i.formatCurrency(p.total||0)),1)])}),128)),!n.purchase.items||n.purchase.items.length===0?(m(),h("tr",he,e[10]||(e[10]=[t("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):v("",!0)])]),_:1,__:[11]}),a(b,{class:"mt-4"},{default:s(()=>[a(f,{cols:"12",md:"6","offset-md":"6"},{default:s(()=>[a(I,{variant:"outlined"},{default:s(()=>[a(C,null,{default:s(()=>[t("div",_e,[e[12]||(e[12]=t("span",{class:"text-body-2"},"Subtotal:",-1)),t("span",ve,u(i.formatCurrency(n.purchase.subtotal||0)),1)]),t("div",fe,[e[13]||(e[13]=t("span",{class:"text-body-2"},"Tax:",-1)),t("span",ge,u(i.formatCurrency(n.purchase.tax_amount||0)),1)]),t("div",ye,[e[14]||(e[14]=t("span",{class:"text-body-2"},"Shipping:",-1)),t("span",be,u(i.formatCurrency(n.purchase.shipping_cost||0)),1)]),t("div",we,[e[15]||(e[15]=t("span",{class:"text-body-2"},"Discount:",-1)),t("span",xe,u(i.formatCurrency(n.purchase.discount_amount||0)),1)]),a(w,{class:"my-2"}),t("div",Ve,[e[16]||(e[16]=t("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),t("span",Pe,u(i.formatCurrency(n.purchase.total_amount||0)),1)]),t("div",Fe,[e[17]||(e[17]=t("span",{class:"text-body-2"},"Paid:",-1)),t("span",ke,u(i.formatCurrency(n.purchase.paid_amount||0)),1)]),t("div",Ce,[e[18]||(e[18]=t("span",{class:"text-body-2 font-weight-medium"},"Balance:",-1)),t("span",{class:H(["text-body-2 font-weight-medium",n.purchase.balance_amount>0?"text-warning":"text-success"])},u(i.formatCurrency(n.purchase.balance_amount||0)),3)])]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1}),a(U,null,{default:s(()=>[a(y),a(P,{onClick:e[0]||(e[0]=p=>l.$emit("update:modelValue",!1)),variant:"text"},{default:s(()=>e[20]||(e[20]=[_("Close")])),_:1,__:[20]})]),_:1})]),_:1})):v("",!0)]),_:1},8,["model-value"])}const De=j(ae,[["render",Se]]),Ie={components:{PurchaseDialog:le,ViewPurchaseDialog:De},mixins:[B],data(){return{purchases:[],suppliers:[],supplierOptions:[],warehouses:[],warehouseOptions:[],products:[],productOptions:[],statusFilter:null,statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}],supplierFilter:null,dialog:!1,editingPurchase:null,saving:!1,viewDialog:!1,viewingPurchase:null}},async mounted(){await this.loadSuppliers(),await this.loadWarehouses(),await this.loadProducts(),await this.loadPurchases()},methods:{async loadPurchases(){try{this.loading=!0;const l=this.buildPaginationParams();this.search&&(l.search=this.search),this.statusFilter&&(l.status=this.statusFilter),this.supplierFilter&&(l.supplier_id=this.supplierFilter);const e=await this.$axios.get("/api/v1/purchases",{params:l,headers:this.getAuthHeaders()});this.purchases=e.data.data||[],this.updatePagination(e.data)}catch(l){this.handleApiError(l,"Failed to load purchases")}finally{this.loading=!1}},async loadSuppliers(){try{const l=await this.$axios.get("/api/v1/suppliers",{params:{per_page:1e3},headers:this.getAuthHeaders()}),e=l.data.data||l.data||[];this.suppliers=e,this.supplierOptions=e.map(n=>({label:n.name,value:n.id}))}catch(l){console.error("Error loading suppliers:",l)}},async loadWarehouses(){try{const l=await this.$axios.get("/api/v1/stock-ledger/warehouses",{headers:this.getAuthHeaders()});this.warehouses=l.data.warehouses||[],this.warehouseOptions=this.warehouses}catch(l){console.error("Error loading warehouses:",l)}},async loadProducts(){try{const l=await this.$axios.get("/api/v1/products",{params:{per_page:1e3,is_active:!0},headers:this.getAuthHeaders()});this.products=l.data.data||[],this.productOptions=this.products.map(e=>({label:`${e.name} (${e.sku})`,value:e.id}))}catch(l){console.error("Error loading products:",l)}},openDialog(l){this.editingPurchase=l||null,this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPurchase=null},async handleSavePurchase(l,e){if(e){this.showError(e);return}this.saving=!0;try{const n=localStorage.getItem("admin_token"),q=this.editingPurchase?`/api/v1/purchases/${this.editingPurchase.id}`:"/api/v1/purchases",o=this.editingPurchase?"put":"post";await axios[o](q,l,{headers:{Authorization:`Bearer ${n}`}}),this.showSuccess(this.editingPurchase?"Purchase updated successfully":"Purchase created successfully"),this.closeDialog(),await this.loadPurchases()}catch(n){this.handleApiError(n,"Error saving purchase")}finally{this.saving=!1}},async receivePurchase(l){if(confirm(`Receive stock for purchase ${l.invoice_number}? This will update stock levels.`))try{const e=localStorage.getItem("admin_token");await this.$axios.post(`/api/v1/purchases/${l.id}/receive`,{},{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("Purchase received and stock updated successfully"),await this.loadPurchases()}catch(e){this.handleApiError(e,"Error receiving purchase")}},async deletePurchase(l){if(confirm(`Delete purchase ${l.invoice_number}?`))try{const e=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/purchases/${l.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("Purchase deleted successfully"),await this.loadPurchases()}catch(e){this.handleApiError(e,"Error deleting purchase")}},async viewPurchase(l){try{const e=await this.$axios.get(`/api/v1/purchases/${l.id}`,{headers:this.getAuthHeaders()});this.viewingPurchase=e.data,this.viewDialog=!0}catch(e){this.handleApiError(e,"Failed to load purchase details")}},formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},getStatusColor(l){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[l]||"default"},onPerPageChange(){this.resetPagination(),this.loadPurchases()}}},Ue={class:"page-header"},Te={class:"text-caption text-grey"},Ae={key:0},Oe={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},Ne={class:"text-caption text-grey"},qe={key:0},ze={key:1},Ee={key:0,class:"d-flex align-center gap-2"};function je(l,e,n,q,o,i){const V=r("v-btn"),k=r("v-select"),f=r("v-col"),b=r("v-text-field"),x=r("v-row"),w=r("v-card-text"),C=r("v-card"),I=r("v-card-title"),y=r("v-skeleton-loader"),P=r("v-chip"),U=r("v-table"),T=r("v-pagination"),p=r("PurchaseDialog"),A=r("ViewPurchaseDialog");return m(),h("div",null,[t("div",Ue,[e[9]||(e[9]=t("h1",{class:"text-h4 page-title"},"Supplier Invoices (Purchases)",-1)),a(V,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=d=>i.openDialog(null)),class:"add-button"},{default:s(()=>e[8]||(e[8]=[_(" New Purchase Invoice ")])),_:1,__:[8]})]),a(C,{class:"mb-4"},{default:s(()=>[a(w,null,{default:s(()=>[a(x,null,{default:s(()=>[a(f,{cols:"12",md:"3"},{default:s(()=>[a(k,{modelValue:l.perPage,"onUpdate:modelValue":[e[1]||(e[1]=d=>l.perPage=d),i.onPerPageChange],items:l.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(f,{cols:"12",md:"3"},{default:s(()=>[a(k,{modelValue:o.statusFilter,"onUpdate:modelValue":[e[2]||(e[2]=d=>o.statusFilter=d),i.loadPurchases],items:o.statusOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(f,{cols:"12",md:"3"},{default:s(()=>[a(k,{modelValue:o.supplierFilter,"onUpdate:modelValue":[e[3]||(e[3]=d=>o.supplierFilter=d),i.loadPurchases],items:o.supplierOptions,label:"Filter by Supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(f,{cols:"12",md:"3"},{default:s(()=>[a(b,{modelValue:l.search,"onUpdate:modelValue":e[4]||(e[4]=d=>l.search=d),label:"Search by invoice number","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:i.loadPurchases},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),a(C,null,{default:s(()=>[a(I,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[11]||(e[11]=t("span",null,"Supplier Invoices",-1)),t("span",Te,[e[10]||(e[10]=_(" Total Records: ")),t("strong",null,u(l.pagination.total||0),1)])]),_:1,__:[11]}),a(w,null,{default:s(()=>[a(U,null,{default:s(()=>[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"Invoice #"),t("th",null,"Supplier"),t("th",null,"Warehouse"),t("th",null,"Invoice Date"),t("th",null,"Status"),t("th",null,"Total Amount"),t("th",null,"Paid"),t("th",null,"Balance"),t("th",null,"Actions")])],-1)),t("tbody",null,[l.loading?(m(),h(N,{key:0},E(5,d=>t("tr",{key:`skeleton-${d}`},[t("td",null,[a(y,{type:"text",width:"120"})]),t("td",null,[a(y,{type:"text",width:"150"})]),t("td",null,[a(y,{type:"text",width:"100"})]),t("td",null,[a(y,{type:"text",width:"100"})]),t("td",null,[a(y,{type:"chip",width:"80",height:"24"})]),t("td",null,[a(y,{type:"text",width:"100"})]),t("td",null,[a(y,{type:"text",width:"100"})]),t("td",null,[a(y,{type:"text",width:"100"})]),t("td",null,[a(y,{type:"button",width:"32",height:"32"})])])),64)):(m(),h(N,{key:1},[(m(!0),h(N,null,E(o.purchases,d=>{var S,z;return m(),h("tr",{key:d.id},[t("td",null,u(d.invoice_number),1),t("td",null,u((S=d.supplier)==null?void 0:S.name),1),t("td",null,u((z=d.warehouse)==null?void 0:z.name),1),t("td",null,u(l.formatDate(d.invoice_date)),1),t("td",null,[a(P,{color:i.getStatusColor(d.status),size:"small"},{default:s(()=>[_(u(d.status),1)]),_:2},1032,["color"])]),t("td",null,u(i.formatCurrency(d.total_amount)),1),t("td",null,u(i.formatCurrency(d.paid_amount)),1),t("td",null,[a(P,{color:d.balance_amount>0?"warning":"success",size:"small"},{default:s(()=>[_(u(i.formatCurrency(d.balance_amount)),1)]),_:2},1032,["color"])]),t("td",null,[a(V,{size:"small",icon:"mdi-eye",onClick:O=>i.viewPurchase(d),variant:"text",title:"View"},null,8,["onClick"]),d.status==="draft"?(m(),F(V,{key:0,size:"small",icon:"mdi-pencil",onClick:O=>i.openDialog(d),variant:"text",title:"Edit"},null,8,["onClick"])):v("",!0),d.status==="draft"?(m(),F(V,{key:1,size:"small",icon:"mdi-package-variant",onClick:O=>i.receivePurchase(d),variant:"text",color:"success",title:"Receive Stock"},null,8,["onClick"])):v("",!0),d.status==="draft"?(m(),F(V,{key:2,size:"small",icon:"mdi-delete",onClick:O=>i.deletePurchase(d),variant:"text",color:"error",title:"Delete"},null,8,["onClick"])):v("",!0)])])}),128)),o.purchases.length===0?(m(),h("tr",Ae,e[12]||(e[12]=[t("td",{colspan:"9",class:"text-center py-4"},"No purchases found",-1)]))):v("",!0)],64))])]),_:1,__:[13]}),t("div",Oe,[t("div",Ne,[o.purchases.length>0&&l.pagination.total>0?(m(),h("span",qe,[e[14]||(e[14]=_(" Showing ")),t("strong",null,u((l.currentPage-1)*l.perPage+1),1),e[15]||(e[15]=_(" to ")),t("strong",null,u(Math.min(l.currentPage*l.perPage,l.pagination.total)),1),e[16]||(e[16]=_(" of ")),t("strong",null,u(l.pagination.total.toLocaleString()),1),e[17]||(e[17]=_(" records "))])):(m(),h("span",ze,"No records found"))]),l.pagination.last_page>1?(m(),h("div",Ee,[a(T,{modelValue:l.currentPage,"onUpdate:modelValue":[e[5]||(e[5]=d=>l.currentPage=d),i.loadPurchases],length:l.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):v("",!0)])]),_:1})]),_:1}),a(p,{modelValue:o.dialog,"onUpdate:modelValue":e[6]||(e[6]=d=>o.dialog=d),"editing-purchase":o.editingPurchase,"supplier-options":o.supplierOptions,"warehouse-options":o.warehouseOptions,"product-options":o.productOptions,saving:o.saving,onSave:i.handleSavePurchase,onCancel:i.closeDialog},null,8,["modelValue","editing-purchase","supplier-options","warehouse-options","product-options","saving","onSave","onCancel"]),a(A,{modelValue:o.viewDialog,"onUpdate:modelValue":e[7]||(e[7]=d=>o.viewDialog=d),purchase:o.viewingPurchase},null,8,["modelValue","purchase"])])}const He=j(Ie,[["render",je],["__scopeId","data-v-5715aa21"]]);export{He as default};
