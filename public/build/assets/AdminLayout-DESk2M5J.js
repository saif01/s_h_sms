import{U as z,h as E}from"./UserProfileDialog-D-MdUa4t.js";import{_ as W,c as A,a as t,w as o,b as c,d as l,e as d,r as u,f as p,t as g,m as h,g as F,u as R,o as n}from"./app-CYStQJ0f.js";import{r as O}from"./uploads-CnEkgyD_.js";const j={components:{UserProfileDialog:z},data(){return{drawer:!0,authStore:null,currentUser:null,userRoles:[],userPermissions:[],currentDate:E().format("Do MMMM YYYY"),currentYear:new Date().getFullYear(),brandingLogo:null,siteName:null,profileDialogVisible:!1,footerPoweredByText:null,footerVersion:null,footerCopyrightText:null}},computed:{resolvedBrandingLogo(){return this.brandingLogo?this.resolveImageUrl(this.brandingLogo):null},resolvedUserAvatar(){return!this.currentUser||!this.currentUser.avatar?null:this.resolveImageUrl(this.currentUser.avatar)}},methods:{async loadUser(){var m;try{const e=localStorage.getItem("admin_token");if(!e){this.$router.push("/admin/login");return}const v=await this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${e}`}});this.currentUser=v.data,this.userRoles=v.data.roles||[],this.authStore&&(this.authStore.user=v.data,this.authStore.token=e,this.authStore.isAuthenticated=!0,this.authStore.extractRolesAndPermissions(v.data)),this.userPermissions=[],this.userRoles&&this.userRoles.length>0&&this.userRoles.forEach(f=>{f.permissions&&f.permissions.length>0&&f.permissions.forEach(r=>{this.userPermissions.includes(r.slug)||this.userPermissions.push(r.slug)})})}catch(e){console.error("Error loading user:",e),((m=e.response)==null?void 0:m.status)===401&&(localStorage.removeItem("admin_token"),this.$router.push("/admin/login"))}},async loadSettings(){try{const m=localStorage.getItem("admin_token");if(!m)return;const e=await this.$axios.get("/api/v1/settings",{headers:{Authorization:`Bearer ${m}`}});e.data.general&&e.data.general.site_name&&e.data.general.site_name.value?this.siteName=e.data.general.site_name.value:this.siteName=null,e.data.branding&&e.data.branding.logo&&e.data.branding.logo.value?this.brandingLogo=e.data.branding.logo.value:this.brandingLogo=null,e.data.footer?(e.data.footer.powered_by_text&&e.data.footer.powered_by_text.value?this.footerPoweredByText=e.data.footer.powered_by_text.value:this.footerPoweredByText=null,e.data.footer.version&&e.data.footer.version.value?this.footerVersion=e.data.footer.version.value:this.footerVersion=null,e.data.footer.copyright_text&&e.data.footer.copyright_text.value?this.footerCopyrightText=e.data.footer.copyright_text.value:this.footerCopyrightText=null):(this.footerPoweredByText=null,this.footerVersion=null,this.footerCopyrightText=null)}catch(m){console.error("Error loading settings:",m)}},async logout(){await R().logout(),this.currentUser=null,this.userRoles=[],this.userPermissions=[],this.$router.push("/admin/login")},hasPermission(m){return this.authStore&&(this.authStore.hasRole&&this.authStore.hasRole(["administrator"])||this.authStore.hasPermission&&this.authStore.hasPermission(m))?!0:!this.currentUser||!this.userPermissions||this.userPermissions.length===0?!1:this.userRoles&&this.userRoles.length>0&&this.userRoles.some(e=>e.slug==="administrator")?!0:this.userPermissions.includes(m)},resolveImageUrl(m){return O(m)},showProfileDialog(){this.profileDialogVisible=!0}},mounted(){this.authStore=R(),localStorage.getItem("admin_token")?(this.loadUser(),this.loadSettings()):this.$router.push("/admin/login")},watch:{$route(m,e){(m.name==="AdminSettings"||e&&e.name==="AdminSettings")&&this.loadSettings()}}},q={class:"pa-2"},G={key:1,class:"d-flex align-center mr-4"},H={class:"footer-content"},J={class:"footer-brand"},K={class:"logo-wrapper"},Q=["src"],X={class:"brand-text"},Z={class:"brand-name"},$={class:"footer-info"},ee={class:"version-badge"},te={class:"copyright-text"};function oe(m,e,v,f,r,i){const y=u("v-img"),b=u("v-avatar"),P=u("v-list-item-title"),s=u("v-list-item"),w=u("v-divider"),_=u("v-list-group"),x=u("v-list"),k=u("v-icon"),L=u("v-btn"),V=u("v-navigation-drawer"),C=u("v-app-bar-nav-icon"),S=u("v-chip"),U=u("v-spacer"),D=u("v-menu"),B=u("v-app-bar"),T=u("router-view"),I=u("v-container"),M=u("v-main"),N=u("v-footer"),Y=u("UserProfileDialog");return n(),A("div",null,[t(V,{modelValue:r.drawer,"onUpdate:modelValue":e[1]||(e[1]=a=>r.drawer=a),class:"gradient_color",location:"left",permanent:"","hide-overlay":"",app:"",dark:""},{append:o(()=>[c("div",q,[t(L,{link:"",router:"",onClick:e[0]||(e[0]=a=>i.logout()),class:"logout-btn text-black",size:"small",block:""},{default:o(()=>[t(k,{left:""},{default:o(()=>e[5]||(e[5]=[p("mdi-logout")])),_:1,__:[5]}),e[6]||(e[6]=p("Logout "))]),_:1,__:[6]})])]),default:o(()=>[e[7]||(e[7]=c("div",{class:"sidebar-shapes"},[c("div",{class:"shape shape-1"}),c("div",{class:"shape shape-2"}),c("div",{class:"shape shape-3"})],-1)),r.currentUser?(n(),l(s,{key:0,class:"user-profile-header"},{prepend:o(()=>[t(b,{size:"48",class:"mr-3"},{default:o(()=>[t(y,{src:i.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"Logo",cover:""},null,8,["src"])]),_:1})]),default:o(()=>[t(P,{class:"text-h6 font-weight-bold"},{default:o(()=>[p(g(r.siteName||"Admin Panel"),1)]),_:1})]),_:1})):d("",!0),t(w,{class:"my-0 divider-glow"}),r.currentUser&&r.userPermissions.length>0?(n(),l(x,{key:1,density:"compact",nav:""},{default:o(()=>[i.hasPermission("access-dashboard")?(n(),l(s,{key:0,link:"",router:"","prepend-icon":"mdi-view-dashboard",title:"Dashboard",to:{name:"AdminDashboard"},value:"Dashboard",exact:""})):d("",!0),i.hasPermission("manage-users")?(n(),l(s,{key:1,link:"",router:"","prepend-icon":"mdi-account-group",title:"Users",to:{name:"AdminUsers"},value:"Users",exact:""})):d("",!0),i.hasPermission("manage-roles")?(n(),l(_,{key:2,value:"roles","prepend-icon":"mdi-shield-account","no-action":""},{activator:o(({props:a})=>[t(s,h(a,{title:"Roles & Permissions"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-shield-account",title:"Roles",to:{name:"AdminRoles"}}),t(s,{"prepend-icon":"mdi-key",title:"Permissions",to:{name:"AdminPermissions"}})]),_:1})):d("",!0),i.hasPermission("view-products")?(n(),l(_,{key:3,value:"inventory","prepend-icon":"mdi-package-variant","no-action":""},{activator:o(({props:a})=>[t(s,h(a,{title:"Inventory"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-package",title:"Products",to:{name:"AdminProducts"}}),t(s,{"prepend-icon":"mdi-folder-multiple",title:"Categories",to:{name:"AdminCategories"}}),i.hasPermission("manage-units")?(n(),l(s,{key:0,"prepend-icon":"mdi-weight-kilogram",title:"Units",to:{name:"AdminUnits"}})):d("",!0)]),_:1})):d("",!0),i.hasPermission("view-stock-ledger")?(n(),l(_,{key:4,value:"stock","prepend-icon":"mdi-warehouse","no-action":""},{activator:o(({props:a})=>[t(s,h(a,{title:"Stock Management"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-book-open-variant",title:"Stock Ledger",to:{name:"AdminStockLedger"}}),i.hasPermission("manage-warehouses")?(n(),l(s,{key:0,"prepend-icon":"mdi-home-city",title:"Warehouses",to:{name:"AdminWarehouses"}})):d("",!0)]),_:1})):d("",!0),i.hasPermission("view-purchases")?(n(),l(_,{key:5,value:"purchase","prepend-icon":"mdi-cart-arrow-down","no-action":""},{activator:o(({props:a})=>[t(s,h(a,{title:"Purchase Management"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-receipt",title:"Supplier Invoices",to:{name:"AdminPurchases"}})]),_:1})):d("",!0),i.hasPermission("view-sales")?(n(),l(s,{key:6,link:"",router:"","prepend-icon":"mdi-point-of-sale",title:"Sales / POS",to:{name:"AdminSales"},value:"Sales",exact:""})):d("",!0),i.hasPermission("manage-suppliers")||i.hasPermission("manage-customers")?(n(),l(_,{key:7,value:"master","prepend-icon":"mdi-database","no-action":""},{activator:o(({props:a})=>[t(s,h(a,{title:"Master Data"}),null,16)]),default:o(()=>[i.hasPermission("manage-suppliers")?(n(),l(s,{key:0,"prepend-icon":"mdi-truck-delivery",title:"Suppliers",to:{name:"AdminSuppliers"}})):d("",!0),i.hasPermission("manage-customers")?(n(),l(s,{key:1,"prepend-icon":"mdi-account-group",title:"Customers",to:{name:"AdminCustomers"}})):d("",!0)]),_:1})):d("",!0),i.hasPermission("view-reports")?(n(),l(s,{key:8,link:"",router:"","prepend-icon":"mdi-chart-box",title:"Reports & Analytics",to:{name:"AdminReports"},value:"Reports",exact:""})):d("",!0),i.hasPermission("manage-settings")?(n(),l(s,{key:9,link:"",router:"","prepend-icon":"mdi-cog",title:"Settings",to:{name:"AdminSettings"},value:"Settings",exact:""})):d("",!0),i.hasPermission("view-login-logs")?(n(),l(s,{key:10,link:"",router:"","prepend-icon":"mdi-login",title:"Login Logs",to:{name:"AdminLoginLogs"},value:"Login Logs",exact:""})):d("",!0)]),_:1})):d("",!0)]),_:1,__:[7]},8,["modelValue"]),t(B,{app:"",flat:"",density:"compact",class:"gradient_color app-bar-modern"},{default:o(()=>[t(C,{onClick:e[2]||(e[2]=F(a=>r.drawer=!r.drawer,["stop"]))}),t(S,{class:"mx-2 date-chip"},{default:o(()=>[p(g(r.currentDate),1)]),_:1}),t(U),r.currentUser&&r.userRoles&&r.userRoles.some(a=>a.slug==="administrator")?(n(),l(S,{key:0,"prepend-icon":"mdi-shield-account"},{default:o(()=>e[8]||(e[8]=[p("Administrator")])),_:1,__:[8]})):d("",!0),t(U),r.currentUser?(n(),A("div",G,[t(D,{"open-on-hover":""},{activator:o(({props:a})=>[t(b,h(a,{size:"42",class:"fill-image mr-2",title:r.currentUser.name}),{default:o(()=>[r.currentUser.avatar?(n(),l(y,{key:0,cover:"",src:i.resolvedUserAvatar,alt:r.currentUser.name},null,8,["src","alt"])):(n(),l(y,{key:1,cover:"",src:"/assets/logo/logo.png",alt:"image"}))]),_:2},1040,["title"])]),default:o(()=>[t(x,null,{default:o(()=>[t(s,{onClick:i.showProfileDialog,style:{cursor:"pointer"}},{prepend:o(()=>[t(k,null,{default:o(()=>e[9]||(e[9]=[p("mdi-account")])),_:1,__:[9]})]),append:o(()=>[t(k,{size:"small"},{default:o(()=>e[10]||(e[10]=[p("mdi-chevron-right")])),_:1,__:[10]})]),default:o(()=>[t(P,null,{default:o(()=>[p(g(r.currentUser.name),1)]),_:1})]),_:1},8,["onClick"]),t(w,{class:"my-2"}),t(s,{link:"",router:"",onClick:e[3]||(e[3]=a=>i.logout())},{prepend:o(()=>[t(k,null,{default:o(()=>e[11]||(e[11]=[p("mdi-logout")])),_:1,__:[11]})]),default:o(()=>[t(P,null,{default:o(()=>e[12]||(e[12]=[p("Logout")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})])):d("",!0)]),_:1}),t(M,null,{default:o(()=>[t(I,{fluid:""},{default:o(()=>[t(T)]),_:1})]),_:1}),t(N,{class:"footer-modern gradient_color rtl-footer",app:""},{default:o(()=>[c("div",H,[c("div",J,[c("div",K,[c("img",{src:i.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"cpb-it",height:"24",class:"footer-logo"},null,8,Q)]),c("div",X,[c("span",Z,g(r.footerPoweredByText||"Powered By CPB-IT"),1)])]),e[13]||(e[13]=c("div",{class:"footer-divider"},null,-1)),c("div",$,[c("span",ee,g(r.footerVersion||"v1.0"),1),c("span",te,"Â© "+g(r.currentYear)+" "+g(r.footerCopyrightText||"All Rights Reserved"),1)])])]),_:1}),t(Y,{modelValue:r.profileDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=a=>r.profileDialogVisible=a),user:r.currentUser},null,8,["modelValue","user"])])}const ne=W(j,[["render",oe],["__scopeId","data-v-2618ba38"]]);export{ne as default};
