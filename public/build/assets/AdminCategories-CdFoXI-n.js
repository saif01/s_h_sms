import{a as L}from"./adminPaginationMixin-DN7Wb3ng.js";import{r as G,n as R}from"./uploads-CnEkgyD_.js";import{_ as W,c as p,b as i,a as l,w as s,f as d,r,t as c,F as k,h as P,e as I,g as H,k as J,o as g,d as K}from"./app-CHlE1Mvy.js";const Q={mixins:[L],data(){return{categories:[],activeFilter:null,activeOptions:[{title:"Active",value:!0},{title:"Inactive",value:!1}],dialog:!1,editingCategory:null,saving:!1,form:{name:"",slug:"",description:"",image:"",order:0,is_active:!0},rules:{required:t=>!!t||"This field is required"},imageFile:null,uploadingImage:!1}},async mounted(){await this.loadCategories()},watch:{"form.name"(t){t?this.form.slug=this.generateSlug(t):this.form.slug=""}},methods:{generateSlug(t){return t.toString().toLowerCase().trim().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},async loadCategories(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.activeFilter!==null&&(t.is_active=this.activeFilter);const e=await this.$axios.get("/api/v1/categories",{params:t,headers:this.getAuthHeaders()});this.categories=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load categories")}finally{this.loading=!1}},openDialog(t){if(this.imageFile=null,t){this.editingCategory=t;const e=this.normalizeImageInput(t.image||"");this.form={name:t.name||"",slug:t.slug||"",description:t.description||"",image:e,order:t.order||0,is_active:t.is_active!==void 0?t.is_active:!0}}else this.editingCategory=null,this.form={name:"",slug:"",description:"",image:"",order:0,is_active:!0};this.dialog=!0},closeDialog(){this.dialog=!1,this.editingCategory=null,this.form={name:"",slug:"",description:"",image:"",order:0,is_active:!0},this.imageFile=null,this.$refs.form&&this.$refs.form.resetValidation()},async handleImageUpload(){var h;if(!this.imageFile)return;const t=Array.isArray(this.imageFile)?this.imageFile[0]:this.imageFile;if(!t)return;if(!t.type.startsWith("image/")){this.showError("Please select a valid image file"),this.imageFile=null;return}const e=5*1024*1024;if(t.size>e){this.showError("File size must be less than 5MB"),this.imageFile=null;return}this.uploadingImage=!0;try{const m=new FormData;m.append("image",t),m.append("folder","products/categories"),this.form.name&&m.append("prefix",this.form.name);const o=localStorage.getItem("admin_token"),n=await this.$axios.post("/api/v1/upload/image",m,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}});if(n.data.success){const u=this.normalizeImageInput(n.data.path||n.data.url);this.form.image=u,this.imageFile=null,this.showSuccess("Image uploaded successfully")}else throw new Error(n.data.message||"Failed to upload image")}catch(m){console.error("Error uploading image:",m);let o="Failed to upload image";m.response?o=((h=m.response.data)==null?void 0:h.message)||m.response.statusText||o:m.message&&(o=m.message),this.showError(o),this.imageFile=null}finally{this.uploadingImage=!1}},clearImage(){this.form.image="",this.imageFile=null},async saveCategory(){var t,e,h,m;if(this.$refs.form.validate()){this.saving=!0;try{const o=localStorage.getItem("admin_token"),n=this.editingCategory?`/api/v1/categories/${this.editingCategory.id}`:"/api/v1/categories",u={...this.form};u.image=this.normalizeImageInput(u.image);const f=this.editingCategory?"put":"post";await axios[f](n,u,{headers:{Authorization:`Bearer ${o}`}}),this.showSuccess(this.editingCategory?"Category updated successfully":"Category created successfully"),this.closeDialog(),await this.loadCategories()}catch(o){console.error("Error saving category:",o);let n="Error saving category";if((e=(t=o.response)==null?void 0:t.data)!=null&&e.errors){const u=o.response.data.errors,f=[];Object.keys(u).forEach(_=>{f.push(u[_][0])}),n=f.join(", ")}else(m=(h=o.response)==null?void 0:h.data)!=null&&m.message&&(n=o.response.data.message);this.showError(n)}finally{this.saving=!1}}},async deleteCategory(t){if(confirm(`Are you sure you want to delete ${t.name}?`))try{const e=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/categories/${t.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("Category deleted successfully"),await this.loadCategories()}catch(e){this.handleApiError(e,"Error deleting category")}},onPerPageChange(){this.resetPagination(),this.loadCategories()},onSort(t){this.handleSort(t),this.loadCategories()},normalizeImageInput(t){return R(t)},resolveImageUrl(t){return G(t)}}},X={class:"page-header"},Y={class:"text-caption text-grey"},Z={class:"d-flex align-center"},$={class:"d-flex align-center"},ee={class:"d-flex align-center"},te={class:"d-flex"},le={class:"d-flex align-center"},oe={key:1,class:"text-caption text-grey"},ie={key:0},ae={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},se={class:"text-caption text-grey"},ne={key:0},re={key:1},de={key:0,class:"d-flex align-center gap-2"},me={class:"pa-6"},ue={class:"mb-4"},ge={key:0,class:"mb-3 text-center"};function pe(t,e,h,m,o,n){const u=r("v-btn"),f=r("v-select"),_=r("v-col"),y=r("v-text-field"),U=r("v-row"),b=r("v-card-text"),w=r("v-card"),x=r("v-card-title"),C=r("v-icon"),v=r("v-skeleton-loader"),V=r("v-chip"),S=r("v-img"),F=r("v-avatar"),z=r("v-table"),A=r("v-pagination"),E=r("v-textarea"),D=r("v-progress-circular"),B=r("v-file-input"),M=r("v-switch"),N=r("v-form"),O=r("v-spacer"),T=r("v-card-actions"),j=r("v-dialog");return g(),p("div",null,[i("div",X,[e[16]||(e[16]=i("h1",{class:"text-h4 page-title"},"Category Management",-1)),l(u,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=a=>n.openDialog(null)),class:"add-button"},{default:s(()=>e[15]||(e[15]=[d(" Add New Category ")])),_:1,__:[15]})]),l(w,{class:"mb-4"},{default:s(()=>[l(b,null,{default:s(()=>[l(U,null,{default:s(()=>[l(_,{cols:"12",md:"3"},{default:s(()=>[l(f,{modelValue:t.perPage,"onUpdate:modelValue":[e[1]||(e[1]=a=>t.perPage=a),n.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(_,{cols:"12",md:"3"},{default:s(()=>[l(f,{modelValue:o.activeFilter,"onUpdate:modelValue":[e[2]||(e[2]=a=>o.activeFilter=a),n.loadCategories],items:o.activeOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),l(_,{cols:"12",md:"3"},{default:s(()=>[l(y,{modelValue:t.search,"onUpdate:modelValue":e[3]||(e[3]=a=>t.search=a),label:"Search by name, slug","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:n.loadCategories},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),l(w,null,{default:s(()=>[l(x,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[18]||(e[18]=i("span",null,"Categories",-1)),i("span",Y,[e[17]||(e[17]=d(" Total Records: ")),i("strong",null,c(t.pagination.total||0),1)])]),_:1,__:[18]}),l(b,null,{default:s(()=>[l(z,null,{default:s(()=>[i("thead",null,[i("tr",null,[i("th",{class:"sortable",onClick:e[4]||(e[4]=a=>n.onSort("name"))},[i("div",Z,[e[19]||(e[19]=d(" Name ")),l(C,{icon:t.getSortIcon("name"),size:"small",class:"ml-1"},null,8,["icon"])])]),i("th",{class:"sortable",onClick:e[5]||(e[5]=a=>n.onSort("slug"))},[i("div",$,[e[20]||(e[20]=d(" Slug ")),l(C,{icon:t.getSortIcon("slug"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[22]||(e[22]=i("th",null,"Image",-1)),i("th",{class:"sortable",onClick:e[6]||(e[6]=a=>n.onSort("order"))},[i("div",ee,[e[21]||(e[21]=d(" Order ")),l(C,{icon:t.getSortIcon("order"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[23]||(e[23]=i("th",null,"Status",-1)),e[24]||(e[24]=i("th",null,"Actions",-1))])]),i("tbody",null,[t.loading?(g(),p(k,{key:0},P(5,a=>i("tr",{key:`skeleton-${a}`},[i("td",null,[l(v,{type:"text",width:"150"})]),i("td",null,[l(v,{type:"text",width:"120"})]),i("td",null,[l(v,{type:"image",width:"50",height:"50"})]),i("td",null,[l(v,{type:"text",width:"40"})]),i("td",null,[l(v,{type:"chip",width:"80",height:"24"})]),i("td",null,[i("div",te,[l(v,{type:"button",width:"32",height:"32",class:"mr-1"}),l(v,{type:"button",width:"32",height:"32"})])])])),64)):(g(),p(k,{key:1},[(g(!0),p(k,null,P(o.categories,a=>(g(),p("tr",{key:a.id},[i("td",null,[i("div",le,[l(C,{size:"small",color:"primary",class:"mr-2"},{default:s(()=>e[25]||(e[25]=[d(" mdi-folder ")])),_:1,__:[25]}),d(" "+c(a.name),1)])]),i("td",null,[l(V,{size:"small",variant:"outlined"},{default:s(()=>[d(c(a.slug),1)]),_:2},1024)]),i("td",null,[a.image?(g(),K(F,{key:0,size:"50"},{default:s(()=>[l(S,{src:a.image,alt:a.name},null,8,["src","alt"])]),_:2},1024)):(g(),p("span",oe,"-"))]),i("td",null,[l(V,{size:"small",color:"grey-lighten-2"},{default:s(()=>[d(c(a.order||0),1)]),_:2},1024)]),i("td",null,[l(V,{color:a.is_active?"success":"error",size:"small"},{default:s(()=>[d(c(a.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),i("td",null,[l(u,{size:"small",icon:"mdi-pencil",onClick:q=>n.openDialog(a),variant:"text",title:"Edit Category"},null,8,["onClick"]),l(u,{size:"small",icon:"mdi-delete",onClick:q=>n.deleteCategory(a),variant:"text",color:"error",title:"Delete Category"},null,8,["onClick"])])]))),128)),o.categories.length===0?(g(),p("tr",ie,e[26]||(e[26]=[i("td",{colspan:"6",class:"text-center py-4"},"No categories found",-1)]))):I("",!0)],64))])]),_:1}),i("div",ae,[i("div",se,[o.categories.length>0&&t.pagination.total>0?(g(),p("span",ne,[e[27]||(e[27]=d(" Showing ")),i("strong",null,c((t.currentPage-1)*t.perPage+1),1),e[28]||(e[28]=d(" to ")),i("strong",null,c(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[29]||(e[29]=d(" of ")),i("strong",null,c(t.pagination.total.toLocaleString()),1),e[30]||(e[30]=d(" records "))])):(g(),p("span",re,"No records found"))]),t.pagination.last_page>1?(g(),p("div",de,[l(A,{modelValue:t.currentPage,"onUpdate:modelValue":[e[7]||(e[7]=a=>t.currentPage=a),n.loadCategories],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):I("",!0)])]),_:1})]),_:1}),l(j,{modelValue:o.dialog,"onUpdate:modelValue":e[14]||(e[14]=a=>o.dialog=a),"max-width":"700",scrollable:"",persistent:""},{default:s(()=>[l(w,null,{default:s(()=>[l(x,null,{default:s(()=>[d(c(o.editingCategory?"Edit Category":"Add New Category"),1)]),_:1}),l(b,{class:"pa-0"},{default:s(()=>[l(N,{ref:"form",onSubmit:H(n.saveCategory,["prevent"])},{default:s(()=>[i("div",me,[l(y,{modelValue:o.form.name,"onUpdate:modelValue":e[8]||(e[8]=a=>o.form.name=a),rules:[o.rules.required],required:"",class:"mb-4"},{label:s(()=>e[31]||(e[31]=[d(" Category Name "),i("span",{class:"text-error"},"*",-1)])),_:1},8,["modelValue","rules"]),l(y,{modelValue:o.form.slug,"onUpdate:modelValue":e[9]||(e[9]=a=>o.form.slug=a),label:"Slug",hint:"Auto-generated from category name","persistent-hint":"",class:"mb-4",readonly:""},null,8,["modelValue"]),l(y,{modelValue:o.form.order,"onUpdate:modelValue":e[10]||(e[10]=a=>o.form.order=a),modelModifiers:{number:!0},label:"Display Order",type:"number",min:"0",hint:"Lower numbers appear first","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),l(E,{modelValue:o.form.description,"onUpdate:modelValue":e[11]||(e[11]=a=>o.form.description=a),label:"Description",variant:"outlined",rows:"3",hint:"Brief description about the category","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),i("div",ue,[e[33]||(e[33]=i("div",{class:"text-subtitle-2 font-weight-medium mb-2"},"Category Image",-1)),o.form.image?(g(),p("div",ge,[l(F,{size:"120",class:"mb-2"},{default:s(()=>[l(S,{src:o.form.image?n.resolveImageUrl(o.form.image):"",alt:"Category Preview"},null,8,["src"])]),_:1}),i("div",null,[l(u,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-delete",onClick:n.clearImage},{default:s(()=>e[32]||(e[32]=[d("Remove Image")])),_:1,__:[32]},8,["onClick"])])])):I("",!0),l(B,{modelValue:o.imageFile,"onUpdate:modelValue":[e[12]||(e[12]=a=>o.imageFile=a),n.handleImageUpload],label:"Upload Image",variant:"outlined",density:"comfortable",color:"primary",accept:"image/*","prepend-icon":"mdi-image",hint:"Upload a category image (JPG, PNG, GIF, WebP - Max 5MB)","persistent-hint":"","show-size":""},J({_:2},[o.uploadingImage?{name:"append-inner",fn:s(()=>[l(D,{indeterminate:"",size:"20",color:"primary"})]),key:"0"}:void 0]),1032,["modelValue","onUpdate:modelValue"])]),l(M,{modelValue:o.form.is_active,"onUpdate:modelValue":e[13]||(e[13]=a=>o.form.is_active=a),label:"Active Category",color:"success",class:"mb-4"},null,8,["modelValue"])])]),_:1},8,["onSubmit"])]),_:1}),l(T,null,{default:s(()=>[l(O),l(u,{onClick:n.closeDialog,variant:"text"},{default:s(()=>e[34]||(e[34]=[d("Cancel")])),_:1,__:[34]},8,["onClick"]),l(u,{onClick:n.saveCategory,color:"primary",loading:o.saving},{default:s(()=>[d(c(o.editingCategory?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const he=W(Q,[["render",pe],["__scopeId","data-v-a8ed2d4d"]]);export{he as default};
