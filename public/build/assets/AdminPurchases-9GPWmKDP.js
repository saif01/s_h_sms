import{c as L}from"./commonMixin-BwIVv23E.js";import{D as H}from"./DatePickerVuetifyInput-D5jbgwcl.js";import{_ as M,d as v,w as i,a as o,r,b as l,t as u,g as R,f as h,c as f,e as g,h as j,F as q,o as d,p as Y}from"./app-CHfYI-xI.js";import{f as Q,a as G,b as K}from"./formatters-DzU97YYy.js";import{P as J,p as W}from"./PaginationControls-6l2F_IVt.js";const X={name:"PurchaseDialog",components:{DatePickerVuetifyInput:H},props:{modelValue:{type:Boolean,default:!1},editingPurchase:{type:Object,default:null},supplierOptions:{type:Array,default:()=>[]},warehouseOptions:{type:Array,default:()=>[]},grnOptions:{type:Array,default:()=>[]},productOptions:{type:Array,default:()=>[]},saving:{type:Boolean,default:!1}},emits:["update:modelValue","save","cancel"],data(){return{activeTab:"basic",localForm:{supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},rules:{required:t=>!!t||"This field is required",minValue:t=>t>0||"Quantity must be greater than 0"}}},computed:{calculatedSubtotal(){return this.localForm.items.reduce((t,e)=>t+(e.quantity||0)*(e.unit_price||0),0)},calculatedTax(){return this.localForm.items.reduce((t,e)=>t+(e.tax||0),0)},calculatedDiscount(){return this.localForm.items.reduce((t,e)=>t+(e.discount||0),0)},calculatedTotal(){return this.calculatedSubtotal+this.calculatedTax+(this.localForm.shipping_cost||0)-this.calculatedDiscount},validProductOptions(){const t=this.productOptions;if(!t||typeof t!="object")return[];if(!Array.isArray(t)||t.length===0){if(this.editingPurchase&&this.editingPurchase.items){const a=[],b=new Set;return this.editingPurchase.items.forEach(s=>{var x,y;const n=s.product_id?Number(s.product_id):null;if(n&&!b.has(n)){const _=((x=s.product)==null?void 0:x.name)||`Product #${n}`,P=((y=s.product)==null?void 0:y.sku)||"";a.push({label:P?`${_} (${P})`:_,value:n}),b.add(n)}}),a}return[]}const e=t.filter(a=>{if(!a||typeof a!="object")return!1;const b=a.label||a.title,s=a.value!==void 0&&a.value!==null;return b&&s}).map(a=>({...a,value:Number(a.value)}));if(this.editingPurchase&&this.editingPurchase.items){const a=new Set(e.map(b=>b.value));this.editingPurchase.items.forEach(b=>{var n,x;const s=b.product_id?Number(b.product_id):null;if(s&&!a.has(s)){const y=((n=b.product)==null?void 0:n.name)||`Product #${s}`,_=((x=b.product)==null?void 0:x.sku)||"";e.push({label:_?`${y} (${_})`:y,value:s}),a.add(s)}})}return e.length===0&&t.length>0&&console.warn("No valid product options found. All options are missing label or value."),e},validWarehouseOptions(){const t=this.warehouseOptions;if(!t||typeof t!="object")return[];if(!Array.isArray(t)||t.length===0)return[];const e=t.filter(a=>{if(!a||typeof a!="object")return!1;const b=a.label||a.title,s=a.value!==void 0&&a.value!==null;return b&&s});return e.length===0&&t.length>0&&console.warn("No valid warehouse options found. All options are missing label or value."),e}},watch:{modelValue(t){t&&this.editingPurchase?this.initializeForm(this.editingPurchase):t&&this.resetForm()},editingPurchase:{handler(t){t&&this.modelValue&&this.initializeForm(t)},deep:!0},productOptions:{handler(t){t!=null&&(Array.isArray(t)?t.length>0&&console.log("ProductOptions updated:",t.length,"products"):console.warn("ProductOptions is not an array:",typeof t))},immediate:!0},warehouseOptions:{handler(t){t!=null&&(Array.isArray(t)?t.length>0&&console.log("WarehouseOptions updated:",t.length,"warehouses"):console.warn("WarehouseOptions is not an array:",typeof t))},immediate:!0}},methods:{initializeForm(t){var e;this.activeTab="basic",this.localForm={supplier_id:t.supplier_id?Number(t.supplier_id):null,warehouse_id:t.warehouse_id?Number(t.warehouse_id):null,grn_id:t.grn_id?Number(t.grn_id):null,invoice_date:t.invoice_date?t.invoice_date.includes("T")?t.invoice_date.split("T")[0]:t.invoice_date:new Date().toISOString().split("T")[0],due_date:t.due_date?t.due_date.includes("T")?t.due_date.split("T")[0]:t.due_date:null,shipping_cost:t.shipping_cost||0,notes:t.notes||"",items:((e=t.items)==null?void 0:e.map(a=>({product_id:a.product_id?Number(a.product_id):null,quantity:a.quantity,unit_price:a.unit_price,discount:a.discount||0,tax:a.tax||0,total:a.total||0})))||[]}},resetForm(){this.activeTab="basic",this.localForm={supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},this.$refs.form&&this.$refs.form.resetValidation()},calculateItemTotal(t){const e=this.localForm.items[t];if(e&&e.quantity&&e.unit_price){const a=e.quantity*e.unit_price-(e.discount||0)+(e.tax||0);e.total=a}else e&&(e.total=0)},calculateTotals(){},addPurchaseItem(){this.activeTab!=="items"&&(this.activeTab="items"),this.localForm.items.push({product_id:null,quantity:1,unit_price:0,discount:0,tax:0,total:0})},removePurchaseItem(t){this.localForm.items.splice(t,1)},handleSave(){if(!this.$refs.form.validate())return;if(this.localForm.items.length===0){this.$emit("save",{...this.localForm},"Please add at least one item");return}const t={...this.localForm,subtotal:this.calculatedSubtotal,tax_amount:this.calculatedTax,discount_amount:this.calculatedDiscount,shipping_cost:this.localForm.shipping_cost||0,items:this.localForm.items.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price,discount:e.discount||0,tax:e.tax||0,notes:e.notes||null}))};this.$emit("save",t,null)},handleSaveDraft(){if(!this.localForm.supplier_id||!this.localForm.warehouse_id||!this.localForm.invoice_date){this.$emit("save",{...this.localForm},"Please fill in required fields (Supplier, Warehouse, and Invoice Date)");return}if(this.localForm.items.length===0){this.$emit("save",{...this.localForm},"Please add at least one item");return}const t={...this.localForm,subtotal:this.calculatedSubtotal,tax_amount:this.calculatedTax,discount_amount:this.calculatedDiscount,shipping_cost:this.localForm.shipping_cost||0,paid_amount:0,items:this.localForm.items.map(e=>({product_id:e.product_id,quantity:e.quantity,unit_price:e.unit_price,discount:e.discount||0,tax:e.tax||0,notes:e.notes||null}))};this.$emit("save",t,null)},handleCancel(){this.resetForm(),this.$emit("cancel")},formatCurrency(t){return t==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)}}},Z={class:"text-h6"},$={class:"pa-3"},ee={class:"pa-3"},te={class:"items-header mb-4"},le={class:"d-flex justify-space-between align-center"},ae={class:"d-flex align-center"},oe={key:0,class:"text-caption text-medium-emphasis mt-1"},se={key:1,class:"text-caption text-medium-emphasis mt-1"},ne={class:"pa-1"},ie={class:"pa-1"},re={class:"pa-1"},ue={class:"pa-1"},de={class:"pa-1"},ce={class:"text-body-2 font-weight-medium text-end"},me={class:"text-center"},pe={key:0},he={key:1,class:"summary-row"},_e={class:"text-body-2 font-weight-bold text-end"},ve={key:2},fe={class:"text-caption text-end"},ye={key:3},ge={class:"text-caption text-end"},be={key:4},xe={class:"text-caption text-end"},Pe={key:5,class:"total-row"},we={class:"text-body-1 font-weight-bold text-end"};function ke(t,e,a,b,s,n){const x=r("v-card-title"),y=r("v-tab"),_=r("v-tabs"),P=r("v-select"),C=r("v-col"),I=r("DatePickerVuetifyInput"),D=r("v-text-field"),A=r("v-textarea"),k=r("v-row"),w=r("v-window-item"),T=r("v-icon"),F=r("v-btn"),m=r("v-table"),S=r("v-window"),U=r("v-form"),N=r("v-card-text"),c=r("v-spacer"),z=r("v-card-actions"),E=r("v-card"),B=r("v-dialog");return d(),v(B,{"model-value":a.modelValue,"onUpdate:modelValue":e[9]||(e[9]=p=>t.$emit("update:modelValue",p)),"max-width":"1500px",scrollable:"",persistent:""},{default:i(()=>[o(E,null,{default:i(()=>[o(x,{class:"pa-3 d-flex justify-space-between align-center"},{default:i(()=>[l("span",Z,u(a.editingPurchase?"Edit Purchase Invoice":"New Purchase Invoice"),1)]),_:1}),o(N,{class:"pa-0"},{default:i(()=>[o(U,{ref:"form",onSubmit:R(n.handleSave,["prevent"])},{default:i(()=>[o(_,{modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=p=>s.activeTab=p),"bg-color":"grey-lighten-4"},{default:i(()=>[o(y,{value:"basic"},{default:i(()=>e[10]||(e[10]=[h("Basic Information")])),_:1,__:[10]}),o(y,{value:"items"},{default:i(()=>e[11]||(e[11]=[h("Items")])),_:1,__:[11]})]),_:1},8,["modelValue"]),o(S,{modelValue:s.activeTab,"onUpdate:modelValue":e[8]||(e[8]=p=>s.activeTab=p)},{default:i(()=>[o(w,{value:"basic"},{default:i(()=>[l("div",$,[o(k,{dense:"",class:"ma-0"},{default:i(()=>[o(C,{cols:"12",md:"6",class:"pa-2"},{default:i(()=>[o(P,{modelValue:s.localForm.supplier_id,"onUpdate:modelValue":e[1]||(e[1]=p=>s.localForm.supplier_id=p),items:a.supplierOptions,"item-title":"label","item-value":"value",label:"Supplier",density:"compact",variant:"outlined","hide-details":"auto",rules:[s.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),o(C,{cols:"12",md:"6",class:"pa-2"},{default:i(()=>[o(P,{modelValue:s.localForm.warehouse_id,"onUpdate:modelValue":e[2]||(e[2]=p=>s.localForm.warehouse_id=p),items:n.validWarehouseOptions,"item-title":"label","item-value":"value",label:"Warehouse",density:"compact",variant:"outlined","hide-details":"auto",rules:[s.rules.required],required:"","no-data-text":"No warehouses available"},null,8,["modelValue","items","rules"])]),_:1}),o(C,{cols:"12",md:"6",class:"pa-2"},{default:i(()=>[o(P,{modelValue:s.localForm.grn_id,"onUpdate:modelValue":e[3]||(e[3]=p=>s.localForm.grn_id=p),items:a.grnOptions,"item-title":"label","item-value":"value",label:"GRN (Optional)",density:"compact",variant:"outlined","hide-details":"auto",clearable:""},null,8,["modelValue","items"])]),_:1}),o(C,{cols:"12",md:"6",class:"pa-2"},{default:i(()=>[o(I,{"field-label":"Invoice Date",required:"true",variant:"outlined","initial-date":s.localForm.invoice_date,onTrigerInputValue:e[4]||(e[4]=p=>{s.localForm.invoice_date=p})},null,8,["initial-date"]),e[12]||(e[12]=l("div",{class:"text-caption text-grey mt-1 ml-2"},[l("span",{class:"text-error",style:{"font-size":"1.1em","font-weight":"bold"}},"*"),h(" Select the invoice date ")],-1))]),_:1,__:[12]}),o(C,{cols:"12",md:"6",class:"pa-2"},{default:i(()=>[o(I,{"field-label":"Due Date",variant:"outlined","initial-date":s.localForm.due_date,onTrigerInputValue:e[5]||(e[5]=p=>{s.localForm.due_date=p})},null,8,["initial-date"]),e[13]||(e[13]=l("div",{class:"text-caption text-grey mt-1 ml-2"}," Optional: Select payment due date ",-1))]),_:1,__:[13]}),o(C,{cols:"12",md:"6",class:"pa-2"},{default:i(()=>[o(D,{modelValue:s.localForm.shipping_cost,"onUpdate:modelValue":e[6]||(e[6]=p=>s.localForm.shipping_cost=p),modelModifiers:{number:!0},label:"Shipping Cost",type:"number",min:"0",step:"0.01",prefix:"৳",density:"compact",variant:"outlined","hide-details":"auto",onInput:n.calculateTotals},null,8,["modelValue","onInput"])]),_:1}),o(C,{cols:"12",class:"pa-2"},{default:i(()=>[o(A,{modelValue:s.localForm.notes,"onUpdate:modelValue":e[7]||(e[7]=p=>s.localForm.notes=p),label:"Notes",variant:"outlined",density:"compact",rows:"2","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),o(w,{value:"items"},{default:i(()=>[l("div",ee,[l("div",te,[l("div",le,[l("div",ae,[o(T,{icon:"mdi-cart-outline",size:"24",color:"primary",class:"mr-3"}),l("div",null,[e[14]||(e[14]=l("h3",{class:"text-h6 font-weight-medium ma-0"},"Invoice Items",-1)),s.localForm.items.length===0?(d(),f("div",oe," Click the button below to add products to this invoice ")):(d(),f("div",se,u(s.localForm.items.length)+" "+u(s.localForm.items.length===1?"item":"items")+" added ",1))])]),o(F,{color:"primary","prepend-icon":"mdi-plus",density:"default",onClick:n.addPurchaseItem,variant:"elevated",elevation:"2"},{default:i(()=>e[15]||(e[15]=[h(" Add Item ")])),_:1,__:[15]},8,["onClick"])])]),o(m,{density:"compact",class:"items-table"},{default:i(()=>[e[27]||(e[27]=l("thead",null,[l("tr",null,[l("th",{class:"text-caption"},"Product"),l("th",{class:"text-caption text-center",style:{width:"150px"}},"Qty"),l("th",{class:"text-caption text-end",style:{width:"150px"}},"Unit Price"),l("th",{class:"text-caption text-end",style:{width:"130px"}},"Discount"),l("th",{class:"text-caption text-end",style:{width:"120px"}},"Tax"),l("th",{class:"text-caption text-end",style:{width:"110px"}},"Total"),l("th",{class:"text-caption",style:{width:"50px"}})])],-1)),l("tbody",null,[(d(!0),f(q,null,j(s.localForm.items,(p,O)=>(d(),f("tr",{key:O},[l("td",ne,[o(P,{modelValue:p.product_id,"onUpdate:modelValue":[V=>p.product_id=V,V=>n.calculateItemTotal(O)],items:n.validProductOptions,"item-title":"label","item-value":"value",label:"Product",placeholder:"Select product",density:"compact",variant:"outlined","hide-details":"auto","menu-props":{maxHeight:400,offset:[0,8],attach:"body",zIndex:9999},rules:[s.rules.required],clearable:"","no-data-text":"No products available"},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),l("td",ie,[o(D,{modelValue:p.quantity,"onUpdate:modelValue":V=>p.quantity=V,modelModifiers:{number:!0},type:"number",min:"1",density:"compact",variant:"outlined","hide-details":"",onInput:V=>n.calculateItemTotal(O),rules:[s.rules.required,s.rules.minValue]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),l("td",re,[o(D,{modelValue:p.unit_price,"onUpdate:modelValue":V=>p.unit_price=V,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",variant:"outlined","hide-details":"",onInput:V=>n.calculateItemTotal(O),rules:[s.rules.required]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),l("td",ue,[o(D,{modelValue:p.discount,"onUpdate:modelValue":V=>p.discount=V,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",variant:"outlined","hide-details":"",onInput:V=>n.calculateItemTotal(O)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),l("td",de,[o(D,{modelValue:p.tax,"onUpdate:modelValue":V=>p.tax=V,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",variant:"outlined","hide-details":"",onInput:V=>n.calculateItemTotal(O)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),l("td",ce,u(n.formatCurrency(p.total||0)),1),l("td",me,[o(F,{size:"x-small",icon:"mdi-delete",variant:"text",color:"error",onClick:V=>n.removePurchaseItem(O)},null,8,["onClick"])])]))),128)),s.localForm.items.length===0?(d(),f("tr",pe,e[16]||(e[16]=[l("td",{colspan:"7",class:"text-center py-3 text-grey text-caption"},"No items added",-1)]))):g("",!0),s.localForm.items.length>0?(d(),f("tr",he,[e[17]||(e[17]=l("td",{colspan:"5",class:"text-right text-body-2 font-weight-bold"},"Subtotal: ",-1)),l("td",_e,u(n.formatCurrency(n.calculatedSubtotal)),1),e[18]||(e[18]=l("td",null,null,-1))])):g("",!0),s.localForm.items.length>0?(d(),f("tr",ve,[e[19]||(e[19]=l("td",{colspan:"5",class:"text-right text-caption"},"Tax:",-1)),l("td",fe,u(n.formatCurrency(n.calculatedTax)),1),e[20]||(e[20]=l("td",null,null,-1))])):g("",!0),s.localForm.items.length>0?(d(),f("tr",ye,[e[21]||(e[21]=l("td",{colspan:"5",class:"text-right text-caption"},"Shipping:",-1)),l("td",ge,u(n.formatCurrency(s.localForm.shipping_cost||0)),1),e[22]||(e[22]=l("td",null,null,-1))])):g("",!0),s.localForm.items.length>0?(d(),f("tr",be,[e[23]||(e[23]=l("td",{colspan:"5",class:"text-right text-caption"},"Discount:",-1)),l("td",xe,u(n.formatCurrency(n.calculatedDiscount)),1),e[24]||(e[24]=l("td",null,null,-1))])):g("",!0),s.localForm.items.length>0?(d(),f("tr",Pe,[e[25]||(e[25]=l("td",{colspan:"5",class:"text-right text-body-1 font-weight-bold"},"Total:",-1)),l("td",we,u(n.formatCurrency(n.calculatedTotal)),1),e[26]||(e[26]=l("td",null,null,-1))])):g("",!0)])]),_:1,__:[27]})])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(z,{class:"pa-3"},{default:i(()=>[o(c),o(F,{onClick:n.handleCancel,variant:"text",density:"compact"},{default:i(()=>e[28]||(e[28]=[h("Cancel")])),_:1,__:[28]},8,["onClick"]),o(F,{onClick:n.handleSaveDraft,color:"grey",variant:"outlined",loading:a.saving,density:"compact"},{default:i(()=>e[29]||(e[29]=[h(" Save as Draft ")])),_:1,__:[29]},8,["onClick","loading"]),o(F,{onClick:n.handleSave,color:"primary",loading:a.saving,density:"compact"},{default:i(()=>[h(u(a.editingPurchase?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Ve=M(X,[["render",ke],["__scopeId","data-v-51a26f11"]]),Ce={name:"ViewPurchaseDialog",props:{modelValue:{type:Boolean,default:!1},purchase:{type:Object,default:null}},emits:["update:modelValue"],methods:{formatCurrency:K,formatDate:G,formatDateShort:Q,getStatusColor(t){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[t]||"default"}}},De={class:"pa-6"},Se={class:"text-h6 font-weight-bold"},Fe={class:"text-body-1"},Ie={class:"text-body-1 font-weight-medium"},Ae={class:"text-body-1 font-weight-medium"},Te={class:"text-body-1"},Oe={class:"text-body-1"},Ue={class:"text-body-1"},Ne={class:"mt-4"},Be={class:"font-weight-medium"},qe={key:0},ze={class:"d-flex justify-space-between mb-2"},Ee={class:"text-body-2 font-weight-medium"},je={class:"d-flex justify-space-between mb-2"},Me={class:"text-body-2"},We={class:"d-flex justify-space-between mb-2"},He={class:"text-body-2"},Le={class:"d-flex justify-space-between mb-2"},Re={class:"text-body-2"},Ye={class:"d-flex justify-space-between mb-2"},Qe={class:"text-h6 font-weight-bold"},Ge={class:"d-flex justify-space-between mb-2"},Ke={class:"text-body-2"},Je={class:"d-flex justify-space-between"},Xe={class:"text-body-2"},Ze={class:"text-body-2"},$e={class:"text-body-2"},et={class:"text-body-2"};function tt(t,e,a,b,s,n){const x=r("v-chip"),y=r("v-card-title"),_=r("v-col"),P=r("v-row"),C=r("v-table"),I=r("v-divider"),D=r("v-card-text"),A=r("v-card"),k=r("v-spacer"),w=r("v-btn"),T=r("v-card-actions"),F=r("v-dialog");return d(),v(F,{"model-value":a.modelValue,"onUpdate:modelValue":e[1]||(e[1]=m=>t.$emit("update:modelValue",m)),"max-width":"1000",scrollable:""},{default:i(()=>[a.purchase?(d(),v(A,{key:0},{default:i(()=>[o(y,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[2]||(e[2]=l("span",null,"Purchase Invoice Details",-1)),o(x,{color:n.getStatusColor(a.purchase.status),size:"small"},{default:i(()=>[h(u(a.purchase.status),1)]),_:1},8,["color"])]),_:1,__:[2]}),o(D,{class:"pa-0"},{default:i(()=>[l("div",De,[o(P,{class:"mb-4"},{default:i(()=>[o(_,{cols:"12",md:"6"},{default:i(()=>[e[3]||(e[3]=l("div",{class:"text-caption text-grey mb-1"},"Invoice Number",-1)),l("div",Se,u(a.purchase.invoice_number),1)]),_:1,__:[3]}),o(_,{cols:"12",md:"6"},{default:i(()=>[e[4]||(e[4]=l("div",{class:"text-caption text-grey mb-1"},"Invoice Date",-1)),l("div",Fe,u(n.formatDate(a.purchase.invoice_date)),1)]),_:1,__:[4]})]),_:1}),o(P,{class:"mb-4"},{default:i(()=>[o(_,{cols:"12",md:"6"},{default:i(()=>{var m;return[e[5]||(e[5]=l("div",{class:"text-caption text-grey mb-1"},"Supplier",-1)),l("div",Ie,u(((m=a.purchase.supplier)==null?void 0:m.name)||"N/A"),1)]}),_:1,__:[5]}),o(_,{cols:"12",md:"6"},{default:i(()=>{var m;return[e[6]||(e[6]=l("div",{class:"text-caption text-grey mb-1"},"Warehouse",-1)),l("div",Ae,u(((m=a.purchase.warehouse)==null?void 0:m.name)||"N/A"),1)]}),_:1,__:[6]})]),_:1}),o(P,{class:"mb-4"},{default:i(()=>[a.purchase.grn?(d(),v(_,{key:0,cols:"12",md:"6"},{default:i(()=>{var m;return[e[7]||(e[7]=l("div",{class:"text-caption text-grey mb-1"},"GRN",-1)),l("div",Te,u(((m=a.purchase.grn)==null?void 0:m.grn_number)||"N/A"),1)]}),_:1,__:[7]})):g("",!0),a.purchase.due_date?(d(),v(_,{key:1,cols:"12",md:"6"},{default:i(()=>[e[8]||(e[8]=l("div",{class:"text-caption text-grey mb-1"},"Due Date",-1)),l("div",Oe,u(n.formatDate(a.purchase.due_date)),1)]),_:1,__:[8]})):g("",!0)]),_:1}),a.purchase.notes?(d(),v(P,{key:0,class:"mb-4"},{default:i(()=>[o(_,{cols:"12"},{default:i(()=>[e[9]||(e[9]=l("div",{class:"text-caption text-grey mb-1"},"Notes",-1)),l("div",Ue,u(a.purchase.notes),1)]),_:1,__:[9]})]),_:1})):g("",!0),l("div",Ne,[e[19]||(e[19]=l("h3",{class:"text-h6 mb-3"},"Invoice Items",-1)),o(C,null,{default:i(()=>[e[11]||(e[11]=l("thead",null,[l("tr",null,[l("th",null,"Product"),l("th",null,"SKU"),l("th",null,"Quantity"),l("th",null,"Unit Price"),l("th",null,"Discount"),l("th",null,"Tax"),l("th",null,"Total")])],-1)),l("tbody",null,[(d(!0),f(q,null,j(a.purchase.items,(m,S)=>{var U,N;return d(),f("tr",{key:S},[l("td",null,u(((U=m.product)==null?void 0:U.name)||"N/A"),1),l("td",null,u(((N=m.product)==null?void 0:N.sku)||"N/A"),1),l("td",null,u(m.quantity),1),l("td",null,u(n.formatCurrency(m.unit_price)),1),l("td",null,u(n.formatCurrency(m.discount||0)),1),l("td",null,u(n.formatCurrency(m.tax||0)),1),l("td",Be,u(n.formatCurrency(m.total||0)),1)])}),128)),!a.purchase.items||a.purchase.items.length===0?(d(),f("tr",qe,e[10]||(e[10]=[l("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):g("",!0)])]),_:1,__:[11]}),o(P,{class:"mt-4"},{default:i(()=>[o(_,{cols:"12",md:"6","offset-md":"6"},{default:i(()=>[o(A,{variant:"outlined"},{default:i(()=>[o(D,null,{default:i(()=>[l("div",ze,[e[12]||(e[12]=l("span",{class:"text-body-2"},"Subtotal:",-1)),l("span",Ee,u(n.formatCurrency(a.purchase.subtotal||0)),1)]),l("div",je,[e[13]||(e[13]=l("span",{class:"text-body-2"},"Tax:",-1)),l("span",Me,u(n.formatCurrency(a.purchase.tax_amount||0)),1)]),l("div",We,[e[14]||(e[14]=l("span",{class:"text-body-2"},"Shipping:",-1)),l("span",He,u(n.formatCurrency(a.purchase.shipping_cost||0)),1)]),l("div",Le,[e[15]||(e[15]=l("span",{class:"text-body-2"},"Discount:",-1)),l("span",Re,u(n.formatCurrency(a.purchase.discount_amount||0)),1)]),o(I,{class:"my-2"}),l("div",Ye,[e[16]||(e[16]=l("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),l("span",Qe,u(n.formatCurrency(a.purchase.total_amount||0)),1)]),l("div",Ge,[e[17]||(e[17]=l("span",{class:"text-body-2"},"Paid:",-1)),l("span",Ke,u(n.formatCurrency(a.purchase.paid_amount||0)),1)]),l("div",Je,[e[18]||(e[18]=l("span",{class:"text-body-2 font-weight-medium"},"Balance:",-1)),l("span",{class:Y(["text-body-2 font-weight-medium",a.purchase.balance_amount>0?"text-warning":"text-success"])},u(n.formatCurrency(a.purchase.balance_amount||0)),3)])]),_:1})]),_:1})]),_:1})]),_:1})]),o(I,{class:"my-4"}),o(P,{class:"mt-2"},{default:i(()=>[a.purchase.created_by?(d(),v(_,{key:0,cols:"12",md:"6"},{default:i(()=>{var m;return[e[20]||(e[20]=l("div",{class:"text-caption text-grey mb-1"},"Created By",-1)),l("div",Xe,u(((m=a.purchase.created_by)==null?void 0:m.name)||"N/A"),1)]}),_:1,__:[20]})):g("",!0),a.purchase.created_at?(d(),v(_,{key:1,cols:"12",md:"6"},{default:i(()=>[e[21]||(e[21]=l("div",{class:"text-caption text-grey mb-1"},"Created At",-1)),l("div",Ze,u(n.formatDateShort(a.purchase.created_at)),1)]),_:1,__:[21]})):g("",!0),a.purchase.updated_by?(d(),v(_,{key:2,cols:"12",md:"6"},{default:i(()=>{var m;return[e[22]||(e[22]=l("div",{class:"text-caption text-grey mb-1"},"Updated By",-1)),l("div",$e,u(((m=a.purchase.updated_by)==null?void 0:m.name)||"N/A"),1)]}),_:1,__:[22]})):g("",!0),a.purchase.updated_at?(d(),v(_,{key:3,cols:"12",md:"6"},{default:i(()=>[e[23]||(e[23]=l("div",{class:"text-caption text-grey mb-1"},"Updated At",-1)),l("div",et,u(n.formatDateShort(a.purchase.updated_at)),1)]),_:1,__:[23]})):g("",!0)]),_:1})])]),_:1}),o(T,null,{default:i(()=>[o(k),o(w,{onClick:e[0]||(e[0]=m=>t.$emit("update:modelValue",!1)),variant:"text"},{default:i(()=>e[24]||(e[24]=[h("Close")])),_:1,__:[24]})]),_:1})]),_:1})):g("",!0)]),_:1},8,["model-value"])}const lt=M(Ce,[["render",tt]]),at={name:"PaymentDialog",components:{DatePickerVuetifyInput:H},props:{modelValue:{type:Boolean,default:!1},purchase:{type:Object,default:null},saving:{type:Boolean,default:!1}},emits:["update:modelValue","save","cancel"],data(){return{localPaymentAmount:0,localPaymentMethod:"cash",localPaymentDate:new Date().toISOString().split("T")[0],localPaymentNotes:"",paymentMethods:[{title:"Cash",value:"cash"},{title:"Card",value:"card"},{title:"Mobile Banking",value:"mobile_banking"},{title:"Bank Transfer",value:"bank_transfer"},{title:"Cheque",value:"cheque"}]}},computed:{rules(){return{required:t=>!!t||"This field is required",maxDue:t=>{if(!this.purchase)return!0;const e=parseFloat(this.purchase.balance_amount||0);return t<=e||`Cannot exceed balance amount (${this.formatCurrency(e)})`}}}},watch:{modelValue(t){t&&this.purchase&&(this.localPaymentAmount=parseFloat(this.purchase.balance_amount||0),this.localPaymentDate=new Date().toISOString().split("T")[0],this.localPaymentMethod="cash",this.localPaymentNotes="")},purchase(t){t&&this.modelValue&&(this.localPaymentAmount=parseFloat(t.balance_amount||0),this.localPaymentDate=new Date().toISOString().split("T")[0],this.localPaymentMethod="cash",this.localPaymentNotes="")}},methods:{formatCurrency(t){return t==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},async handleSave(){if(this.$refs.paymentForm){const{valid:t}=await this.$refs.paymentForm.validate();if(!t)return}this.$emit("save",{amount:this.localPaymentAmount,payment_method:this.localPaymentMethod,payment_date:this.localPaymentDate,notes:this.localPaymentNotes})},handleCancel(){this.$refs.paymentForm&&this.$refs.paymentForm.resetValidation(),this.$emit("cancel")}}};function ot(t,e,a,b,s,n){const x=r("v-card-title"),y=r("v-text-field"),_=r("v-select"),P=r("DatePickerVuetifyInput"),C=r("v-textarea"),I=r("v-form"),D=r("v-card-text"),A=r("v-spacer"),k=r("v-btn"),w=r("v-card-actions"),T=r("v-card"),F=r("v-dialog");return d(),v(F,{"model-value":a.modelValue,"onUpdate:modelValue":e[4]||(e[4]=m=>t.$emit("update:modelValue",m)),"max-width":"500px"},{default:i(()=>[a.purchase?(d(),v(T,{key:0},{default:i(()=>[o(x,null,{default:i(()=>e[5]||(e[5]=[h("Add Payment")])),_:1,__:[5]}),o(D,null,{default:i(()=>[o(I,{ref:"paymentForm"},{default:i(()=>{var m;return[o(y,{"model-value":(m=a.purchase.supplier)==null?void 0:m.name,label:"Supplier",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"]),o(y,{"model-value":a.purchase.invoice_number,label:"Invoice Number",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"]),o(y,{"model-value":n.formatCurrency(a.purchase.total_amount),label:"Total Amount",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"]),o(y,{"model-value":n.formatCurrency(a.purchase.paid_amount),label:"Paid Amount",readonly:"",variant:"outlined",density:"compact"},null,8,["model-value"]),o(y,{"model-value":n.formatCurrency(a.purchase.balance_amount),label:"Balance (Due)",readonly:"",variant:"outlined",density:"compact",color:a.purchase.balance_amount>0?"warning":"success"},null,8,["model-value","color"]),o(y,{modelValue:s.localPaymentAmount,"onUpdate:modelValue":e[0]||(e[0]=S=>s.localPaymentAmount=S),modelModifiers:{number:!0},type:"number",label:"Payment Amount *",variant:"outlined",density:"compact",rules:[n.rules.required,n.rules.maxDue],hint:"Enter the amount to pay","persistent-hint":""},null,8,["modelValue","rules"]),o(_,{modelValue:s.localPaymentMethod,"onUpdate:modelValue":e[1]||(e[1]=S=>s.localPaymentMethod=S),items:s.paymentMethods,label:"Payment Method *",variant:"outlined",density:"compact",rules:[n.rules.required]},null,8,["modelValue","items","rules"]),o(P,{"field-label":"Payment Date",required:"true",variant:"outlined","initial-date":s.localPaymentDate,onTrigerInputValue:e[2]||(e[2]=S=>{s.localPaymentDate=S})},null,8,["initial-date"]),o(C,{modelValue:s.localPaymentNotes,"onUpdate:modelValue":e[3]||(e[3]=S=>s.localPaymentNotes=S),label:"Notes",variant:"outlined",density:"compact",rows:"2"},null,8,["modelValue"])]}),_:1},512)]),_:1}),o(w,null,{default:i(()=>[o(A),o(k,{onClick:n.handleCancel,variant:"text"},{default:i(()=>e[6]||(e[6]=[h("Cancel")])),_:1,__:[6]},8,["onClick"]),o(k,{color:"primary",loading:a.saving,onClick:n.handleSave,variant:"flat"},{default:i(()=>e[7]||(e[7]=[h("Save Payment")])),_:1,__:[7]},8,["loading","onClick"])]),_:1})]),_:1})):g("",!0)]),_:1},8,["model-value"])}const st=M(at,[["render",ot]]),nt={components:{PurchaseDialog:Ve,ViewPurchaseDialog:lt,PaymentDialog:st,PaginationControls:J},mixins:[L],data(){return{purchases:[],suppliers:[],supplierOptions:[],warehouses:[],warehouseOptions:[],products:[],productOptions:[],statusFilter:null,statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}],supplierFilter:null,warehouseFilter:null,dialog:!1,editingPurchase:null,viewDialog:!1,viewingPurchase:null,paymentDialog:!1,selectedPurchase:null,savingPayment:!1,currentPage:1,perPage:10,perPageOptions:[{title:"10",value:10,description:"Quick view"},{title:"25",value:25,description:"Standard"},{title:"50",value:50,description:"Comfortable"},{title:"100",value:100,description:"Extended"},{title:"500",value:500,description:"Large dataset"},{title:"Show All",value:"all",description:"All records"}],pagination:{current_page:1,last_page:1,per_page:10,total:0}}},async mounted(){await this.loadSuppliers(),await this.loadWarehouses(),await this.loadProducts(),await this.loadPurchases()},methods:{async loadPurchases(){try{this.loading=!0;const t=this.buildPaginationParams();this.perPage==="all"&&(t.per_page=999999),this.search&&(t.search=this.search),this.statusFilter&&(t.status=this.statusFilter),this.supplierFilter&&(t.supplier_id=this.supplierFilter),this.warehouseFilter&&(t.warehouse_id=this.warehouseFilter);const e=await this.$axios.get("/api/v1/purchases",{params:t,headers:this.getAuthHeaders()});this.purchases=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load purchases")}finally{this.loading=!1}},async loadSuppliers(){try{const t=await this.$axios.get("/api/v1/suppliers",{params:{per_page:1e3},headers:this.getAuthHeaders()}),e=t.data.data||t.data||[];this.suppliers=e,this.supplierOptions=e.map(a=>({label:a.name,value:a.id}))}catch(t){console.error("Error loading suppliers:",t)}},async loadWarehouses(){try{const t=await this.$axios.get("/api/v1/stock-ledger/warehouses",{headers:this.getAuthHeaders()});this.warehouseOptions=t.data.warehouses||[]}catch(t){console.error("Error loading warehouses:",t),this.warehouseOptions=[]}},async loadProducts(){try{let t=await this.$axios.get("/api/v1/products",{params:{per_page:1e3,is_active:!0},headers:this.getAuthHeaders()}),e=[];t.data&&(t.data.data&&Array.isArray(t.data.data)?e=t.data.data:Array.isArray(t.data)&&(e=t.data)),e.length===0&&(console.log("No active products found, loading all products..."),t=await this.$axios.get("/api/v1/products",{params:{per_page:1e3},headers:this.getAuthHeaders()}),t.data&&(t.data.data&&Array.isArray(t.data.data)?e=t.data.data:Array.isArray(t.data)&&(e=t.data))),console.log("Products API response:",{total:e.length,sample:e.length>0?e[0]:null}),this.products=e,this.productOptions=e.filter(a=>a&&typeof a=="object"&&a.id!==void 0&&a.id!==null).map(a=>({label:a.sku?`${a.name||"Unnamed Product"} (${a.sku})`:a.name||`Product #${a.id}`,value:a.id})),console.log("Products loaded:",this.productOptions.length,"options"),this.productOptions.length===0&&e.length>0?console.warn("Products were loaded but none passed validation. Sample product:",e[0]):this.productOptions.length===0&&console.warn("No products found in the system. Please create products first.")}catch(t){console.error("Error loading products:",t),t.response&&console.error("API Error Response:",t.response.status,t.response.data),this.productOptions=[],this.products=[]}},openDialog(t){this.editingPurchase=t||null,this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPurchase=null},async handleSavePurchase(t,e){if(e){this.showError(e);return}this.saving=!0;try{const a=localStorage.getItem("admin_token"),b=this.editingPurchase?`/api/v1/purchases/${this.editingPurchase.id}`:"/api/v1/purchases",s=this.editingPurchase?"put":"post";await axios[s](b,t,{headers:{Authorization:`Bearer ${a}`}}),this.showSuccess(this.editingPurchase?"Purchase updated successfully":"Purchase created successfully"),this.closeDialog(),await this.loadPurchases()}catch(a){this.handleApiError(a,"Error saving purchase")}finally{this.saving=!1}},async receivePurchase(t){if((await window.Swal.fire({title:"Receive Stock?",text:`Receive stock for purchase invoice "${t.invoice_number}"? This will update stock levels.`,icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, receive stock!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)try{const a=localStorage.getItem("admin_token");await this.$axios.post(`/api/v1/purchases/${t.id}/receive`,{},{headers:{Authorization:`Bearer ${a}`}}),this.showSuccess("Purchase received and stock updated successfully"),await this.loadPurchases()}catch(a){this.handleApiError(a,"Error receiving purchase")}},async deletePurchase(t){if((await window.Swal.fire({title:"Delete Purchase Invoice?",text:`Are you sure you want to delete purchase invoice "${t.invoice_number}"? This action cannot be undone.`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#6c757d",confirmButtonText:"Yes, delete it!",cancelButtonText:"Cancel",reverseButtons:!0})).isConfirmed)try{const a=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/purchases/${t.id}`,{headers:{Authorization:`Bearer ${a}`}}),this.showSuccess("Purchase deleted successfully"),await this.loadPurchases()}catch(a){this.handleApiError(a,"Error deleting purchase")}},async viewPurchase(t){try{const e=await this.$axios.get(`/api/v1/purchases/${t.id}`,{headers:this.getAuthHeaders()});this.viewingPurchase=e.data,this.viewDialog=!0}catch(e){this.handleApiError(e,"Failed to load purchase details")}},formatCurrency(t){return t==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},getStatusColor(t){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[t]||"default"},buildPaginationParams(t={}){return W.buildPaginationParams(this.currentPage,this.perPage,t,this.sortBy,this.sortDirection)},updatePagination(t){W.updatePagination(this,t)},resetPagination(){W.resetPagination(this)},onPerPageUpdate(t){this.perPage=t,this.onPerPageChange()},onPageChange(t){this.currentPage=t,this.loadPurchases()},onPerPageChange(){this.resetPagination(),this.loadPurchases()},onSort(t){this.handleSort(t),this.currentPage=1,this.loadPurchases()},openPaymentDialog(t){this.selectedPurchase=t,this.paymentDialog=!0},closePaymentDialog(){this.paymentDialog=!1,this.selectedPurchase=null},async handleSavePayment(t){this.savingPayment=!0;try{const e=localStorage.getItem("admin_token");await this.$axios.post("/api/v1/payments",{party_type:"supplier",party_id:this.selectedPurchase.supplier_id,reference_type:"purchase",reference_id:this.selectedPurchase.id,reference_number:this.selectedPurchase.invoice_number,payment_date:t.payment_date,amount:t.amount,payment_method:t.payment_method,notes:t.notes},{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("Payment added successfully"),this.closePaymentDialog(),await this.loadPurchases()}catch(e){this.handleApiError(e,"Error adding payment")}finally{this.savingPayment=!1}}}},it={class:"page-header"},rt={class:"text-caption text-grey"},ut={class:"sortable-header"},dt={class:"sortable-header"},ct={class:"sortable-header"},mt={class:"sortable-header justify-end"},pt={key:0},ht={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},_t={class:"text-caption text-grey"},vt={key:0},ft={key:0},yt={key:1},gt={key:1};function bt(t,e,a,b,s,n){const x=r("v-btn"),y=r("v-select"),_=r("v-col"),P=r("v-text-field"),C=r("v-row"),I=r("v-card-text"),D=r("v-card"),A=r("v-card-title"),k=r("v-icon"),w=r("v-skeleton-loader"),T=r("v-chip"),F=r("v-table"),m=r("PaginationControls"),S=r("PurchaseDialog"),U=r("ViewPurchaseDialog"),N=r("PaymentDialog");return d(),f("div",null,[l("div",it,[e[14]||(e[14]=l("h1",{class:"text-h4 page-title"},"Supplier Invoices (Purchases)",-1)),o(x,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=c=>n.openDialog(null)),class:"add-button"},{default:i(()=>e[13]||(e[13]=[h(" New Purchase Invoice ")])),_:1,__:[13]})]),o(D,{class:"mb-4"},{default:i(()=>[o(I,null,{default:i(()=>[o(C,null,{default:i(()=>[o(_,{cols:"12",md:"3"},{default:i(()=>[o(y,{modelValue:s.statusFilter,"onUpdate:modelValue":[e[1]||(e[1]=c=>s.statusFilter=c),n.loadPurchases],items:s.statusOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(_,{cols:"12",md:"3"},{default:i(()=>[o(y,{modelValue:s.supplierFilter,"onUpdate:modelValue":[e[2]||(e[2]=c=>s.supplierFilter=c),n.loadPurchases],items:s.supplierOptions,"item-title":"label","item-value":"value",label:"Filter by Supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(_,{cols:"12",md:"3"},{default:i(()=>[o(y,{modelValue:s.warehouseFilter,"onUpdate:modelValue":[e[3]||(e[3]=c=>s.warehouseFilter=c),n.loadPurchases],items:s.warehouseOptions,"item-title":"label","item-value":"value",label:"Filter by Warehouse",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(_,{cols:"12",md:"3"},{default:i(()=>[o(P,{modelValue:t.search,"onUpdate:modelValue":e[4]||(e[4]=c=>t.search=c),label:"Search by invoice number","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:n.loadPurchases},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(D,null,{default:i(()=>[o(A,{class:"d-flex justify-space-between align-center"},{default:i(()=>[e[16]||(e[16]=l("span",null,"Supplier Invoices",-1)),l("span",rt,[e[15]||(e[15]=h(" Total Records: ")),l("strong",null,u(s.pagination.total||0),1)])]),_:1,__:[16]}),o(I,null,{default:i(()=>[o(F,null,{default:i(()=>[l("thead",null,[l("tr",null,[l("th",{class:"sortable",onClick:e[5]||(e[5]=c=>n.onSort("invoice_number"))},[l("div",ut,[e[18]||(e[18]=l("span",null,"Invoice #",-1)),t.sortBy==="invoice_number"?(d(),v(k,{key:0,size:"18",class:"sort-icon active"},{default:i(()=>[h(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),v(k,{key:1,size:"18",class:"sort-icon inactive"},{default:i(()=>e[17]||(e[17]=[h(" mdi-unfold-more-horizontal ")])),_:1,__:[17]}))])]),e[25]||(e[25]=l("th",null,"Supplier",-1)),e[26]||(e[26]=l("th",null,"Warehouse",-1)),l("th",{class:"sortable",onClick:e[6]||(e[6]=c=>n.onSort("invoice_date"))},[l("div",dt,[e[20]||(e[20]=l("span",null,"Invoice Date",-1)),t.sortBy==="invoice_date"?(d(),v(k,{key:0,size:"18",class:"sort-icon active"},{default:i(()=>[h(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),v(k,{key:1,size:"18",class:"sort-icon inactive"},{default:i(()=>e[19]||(e[19]=[h(" mdi-unfold-more-horizontal ")])),_:1,__:[19]}))])]),l("th",{class:"sortable",onClick:e[7]||(e[7]=c=>n.onSort("status"))},[l("div",ct,[e[22]||(e[22]=l("span",null,"Status",-1)),t.sortBy==="status"?(d(),v(k,{key:0,size:"18",class:"sort-icon active"},{default:i(()=>[h(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),v(k,{key:1,size:"18",class:"sort-icon inactive"},{default:i(()=>e[21]||(e[21]=[h(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),l("th",{class:"text-end sortable",onClick:e[8]||(e[8]=c=>n.onSort("total_amount"))},[l("div",mt,[e[24]||(e[24]=l("span",null,"Total Amount",-1)),t.sortBy==="total_amount"?(d(),v(k,{key:0,size:"18",class:"sort-icon active"},{default:i(()=>[h(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),v(k,{key:1,size:"18",class:"sort-icon inactive"},{default:i(()=>e[23]||(e[23]=[h(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),e[27]||(e[27]=l("th",{class:"text-end"},[l("span",null,"Paid")],-1)),e[28]||(e[28]=l("th",{class:"text-end"},[l("span",null,"Balance")],-1)),e[29]||(e[29]=l("th",null,"Actions",-1))])]),l("tbody",null,[t.loading?(d(),f(q,{key:0},j(5,c=>l("tr",{key:`skeleton-${c}`},[l("td",null,[o(w,{type:"text",width:"120"})]),l("td",null,[o(w,{type:"text",width:"150"})]),l("td",null,[o(w,{type:"text",width:"100"})]),l("td",null,[o(w,{type:"text",width:"100"})]),l("td",null,[o(w,{type:"chip",width:"80",height:"24"})]),l("td",null,[o(w,{type:"text",width:"100"})]),l("td",null,[o(w,{type:"text",width:"100"})]),l("td",null,[o(w,{type:"text",width:"100"})]),l("td",null,[o(w,{type:"button",width:"32",height:"32"})])])),64)):(d(),f(q,{key:1},[(d(!0),f(q,null,j(s.purchases,c=>{var z,E;return d(),f("tr",{key:c.id},[l("td",null,u(c.invoice_number),1),l("td",null,u((z=c.supplier)==null?void 0:z.name),1),l("td",null,u((E=c.warehouse)==null?void 0:E.name),1),l("td",null,u(t.formatDate(c.invoice_date)),1),l("td",null,[o(T,{color:n.getStatusColor(c.status),size:"small"},{default:i(()=>[h(u(c.status),1)]),_:2},1032,["color"])]),l("td",null,u(n.formatCurrency(c.total_amount)),1),l("td",null,u(n.formatCurrency(c.paid_amount)),1),l("td",null,[o(T,{color:c.balance_amount>0?"warning":"success",size:"small"},{default:i(()=>[h(u(n.formatCurrency(c.balance_amount)),1)]),_:2},1032,["color"])]),l("td",null,[o(x,{size:"small",icon:"mdi-eye",onClick:B=>n.viewPurchase(c),variant:"text",title:"View"},null,8,["onClick"]),c.status==="draft"?(d(),v(x,{key:0,size:"small",icon:"mdi-pencil",onClick:B=>n.openDialog(c),variant:"text",title:"Edit"},null,8,["onClick"])):g("",!0),c.status==="draft"?(d(),v(x,{key:1,size:"small",icon:"mdi-package-variant",onClick:B=>n.receivePurchase(c),variant:"text",color:"success",title:"Receive Stock"},null,8,["onClick"])):g("",!0),c.status!=="draft"&&c.balance_amount>0?(d(),v(x,{key:2,size:"small",icon:"mdi-cash",onClick:B=>n.openPaymentDialog(c),variant:"text",color:"primary",title:"Add Payment"},null,8,["onClick"])):g("",!0),c.status==="draft"?(d(),v(x,{key:3,size:"small",icon:"mdi-delete",onClick:B=>n.deletePurchase(c),variant:"text",color:"error",title:"Delete"},null,8,["onClick"])):g("",!0)])])}),128)),s.purchases.length===0?(d(),f("tr",pt,e[30]||(e[30]=[l("td",{colspan:"9",class:"text-center py-4"},"No purchases found",-1)]))):g("",!0)],64))])]),_:1}),l("div",ht,[l("div",_t,[s.purchases.length>0&&s.pagination.total>0?(d(),f("span",vt,[s.perPage==="all"?(d(),f("span",ft,[e[31]||(e[31]=h(" Showing ")),l("strong",null,"all "+u(s.pagination.total.toLocaleString()),1),e[32]||(e[32]=h(" records "))])):(d(),f("span",yt,[e[33]||(e[33]=h(" Showing ")),l("strong",null,u((s.currentPage-1)*s.perPage+1),1),e[34]||(e[34]=h(" to ")),l("strong",null,u(Math.min(s.currentPage*s.perPage,s.pagination.total)),1),e[35]||(e[35]=h(" of ")),l("strong",null,u(s.pagination.total.toLocaleString()),1),e[36]||(e[36]=h(" records "))]))])):(d(),f("span",gt,"No records found"))]),o(m,{modelValue:s.currentPage,"onUpdate:modelValue":e[9]||(e[9]=c=>s.currentPage=c),pagination:s.pagination,"per-page-value":s.perPage,"per-page-options":s.perPageOptions,"onUpdate:perPage":n.onPerPageUpdate,onPageChange:n.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),o(S,{modelValue:s.dialog,"onUpdate:modelValue":e[10]||(e[10]=c=>s.dialog=c),"editing-purchase":s.editingPurchase,"supplier-options":s.supplierOptions,"warehouse-options":s.warehouseOptions,"product-options":s.productOptions,saving:t.saving,onSave:n.handleSavePurchase,onCancel:n.closeDialog},null,8,["modelValue","editing-purchase","supplier-options","warehouse-options","product-options","saving","onSave","onCancel"]),o(U,{modelValue:s.viewDialog,"onUpdate:modelValue":e[11]||(e[11]=c=>s.viewDialog=c),purchase:s.viewingPurchase},null,8,["modelValue","purchase"]),o(N,{modelValue:s.paymentDialog,"onUpdate:modelValue":e[12]||(e[12]=c=>s.paymentDialog=c),purchase:s.selectedPurchase,saving:s.savingPayment,onSave:n.handleSavePayment,onCancel:n.closePaymentDialog},null,8,["modelValue","purchase","saving","onSave","onCancel"])])}const Ct=M(nt,[["render",bt],["__scopeId","data-v-93a53742"]]);export{Ct as default};
