import{c as N}from"./commonMixin-BwIVv23E.js";import{P as M,p as T,d as b}from"./PaginationControls-DoA1lTDa.js";import{D as j}from"./DatePicker-BLvehJM4.js";import{_ as I,c as h,b as o,a as s,w as l,r as m,f as p,e as R,t as a,d as P,F as S,h as z,o as u}from"./app-BqLCFCMY.js";const Y={components:{PaginationControls:M,DatePicker:j},mixins:[N],data(){return{ledgers:[],products:[],warehouses:[],productFilter:null,productOptions:[],warehouseFilter:null,warehouseOptions:[],typeFilter:null,typeOptions:[{title:"Stock In",value:"in"},{title:"Stock Out",value:"out"}],referenceTypeFilter:null,referenceTypeOptions:[{title:"Purchase",value:"purchase"},{title:"Sales",value:"sales"},{title:"Return",value:"return"},{title:"Damage",value:"damage"},{title:"Lost",value:"lost"}],dateFrom:"",dateTo:"",exporting:!1,currentPage:b.currentPage,perPage:b.perPage,perPageOptions:b.perPageOptions,pagination:{...b.pagination}}},async mounted(){await this.loadProducts(),await this.loadWarehouses(),await this.loadLedger()},methods:{async loadLedger(){try{this.loading=!0;const t=this.buildPaginationParams();this.perPage==="all"&&(t.per_page=999999),this.search&&(t.search=this.search),this.productFilter&&(t.product_id=this.productFilter),this.warehouseFilter&&(t.warehouse_id=this.warehouseFilter),this.typeFilter&&(t.type=this.typeFilter),this.referenceTypeFilter&&(t.reference_type=this.referenceTypeFilter),this.dateFrom&&String(this.dateFrom).trim()!==""&&(t.date_from=this.dateFrom),this.dateTo&&String(this.dateTo).trim()!==""&&(t.date_to=this.dateTo);const e=await this.$axios.get("/api/v1/stock-ledger",{params:t,headers:this.getAuthHeaders()});this.ledgers=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load stock ledger")}finally{this.loading=!1}},async loadProducts(){try{const t=await this.$axios.get("/api/v1/products",{params:{per_page:1e3},headers:this.getAuthHeaders()});this.products=t.data.data||[],this.productOptions=this.products.map(e=>({title:`${e.name} (${e.sku})`,value:e.id}))}catch(t){console.error("Error loading products:",t)}},async loadWarehouses(){try{const t=await this.$axios.get("/api/v1/stock-ledger/warehouses",{headers:this.getAuthHeaders()});this.warehouses=t.data.warehouses||[],this.warehouseOptions=this.warehouses.map(e=>({title:e.label,value:e.value}))}catch(t){console.error("Error loading warehouses:",t)}},formatReferenceType(t){return{purchase:"Purchase",sales:"Sales",return:"Return",damage:"Damage",lost:"Lost"}[t]||t},formatCurrency(t){return t==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},buildPaginationParams(t={}){return T.buildPaginationParams(this.currentPage,this.perPage,t,this.sortBy,this.sortDirection)},updatePagination(t){T.updatePagination(this,t)},resetPagination(){T.resetPagination(this)},onPerPageUpdate(t){this.perPage=t,this.onPerPageChange()},onPageChange(t){this.currentPage=t,this.loadLedger()},onPerPageChange(){this.resetPagination(),this.loadLedger()},onSort(t){this.handleSort(t),this.currentPage=1,this.loadLedger()},onDateFromChange(t){this.dateFrom=t||"",this.resetPagination(),this.loadLedger()},onDateToChange(t){this.dateTo=t||"",this.resetPagination(),this.loadLedger()},async exportToExcel(){try{this.exporting=!0;const t={};this.search&&(t.search=this.search),this.productFilter&&(t.product_id=this.productFilter),this.warehouseFilter&&(t.warehouse_id=this.warehouseFilter),this.typeFilter&&(t.type=this.typeFilter),this.referenceTypeFilter&&(t.reference_type=this.referenceTypeFilter),this.dateFrom&&String(this.dateFrom).trim()!==""&&(t.date_from=this.dateFrom),this.dateTo&&String(this.dateTo).trim()!==""&&(t.date_to=this.dateTo),t.per_page=999999;const k=(await this.$axios.get("/api/v1/stock-ledger",{params:t,headers:this.getAuthHeaders()})).data.data||[];if(k.length===0){this.showError("No data to export");return}const C=["Date","Product Name","Product SKU","Warehouse","Type","Reference Type","Reference Number","Quantity","Unit Cost","Total Cost","Balance After","Created By","Created At"],n=k.map(d=>{var w,g,y,c;return[this.formatDateDDMMYYYY(d.transaction_date)||"",((w=d.product)==null?void 0:w.name)||"",((g=d.product)==null?void 0:g.sku)||"",((y=d.warehouse)==null?void 0:y.name)||"",d.type==="in"?"IN":"OUT",this.formatReferenceType(d.reference_type)||"",d.reference_number||"",d.quantity||0,parseFloat(d.unit_cost||0).toFixed(2),parseFloat(d.total_cost||0).toFixed(2),d.balance_after||0,((c=d.creator)==null?void 0:c.name)||"",this.formatDateShort(d.created_at)||""]}),i=[C.join(","),...n.map(d=>d.map(w=>{const g=String(w||"");return g.includes(",")||g.includes('"')||g.includes(`
`)?`"${g.replace(/"/g,'""')}"`:g}).join(","))].join(`
`),v="\uFEFF",f=new Blob([v+i],{type:"text/csv;charset=utf-8;"}),F=window.URL.createObjectURL(f),_=document.createElement("a");_.href=F;const x=new Date().toISOString().split("T")[0];_.setAttribute("download",`stock_ledger_${x}.csv`),document.body.appendChild(_),_.click(),_.remove(),window.URL.revokeObjectURL(F),this.showSuccess("Stock ledger exported successfully")}catch(t){this.handleApiError(t,"Failed to export stock ledger")}finally{this.exporting=!1}}}},W={class:"d-flex align-center gap-2"},q={class:"text-caption text-grey"},H={key:0},Q={class:"sortable-header"},K={class:"sortable-header justify-end"},G={class:"sortable-header"},J={class:"d-flex flex-column"},X={class:"font-weight-medium"},Z={class:"text-caption text-grey"},$={class:"d-flex flex-column"},ee={class:"text-body-2"},te={class:"text-caption text-grey"},oe={class:"text-right"},ne={class:"text-right"},re={class:"text-right"},se={class:"text-right"},ae={key:0},le={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},ie={class:"text-caption text-grey"},de={key:0},ue={key:0},pe={key:1},ce={key:1};function me(t,e,k,C,n,i){const v=m("v-select"),f=m("v-col"),F=m("DatePicker"),_=m("v-text-field"),V=m("v-row"),x=m("v-card-text"),d=m("v-card"),w=m("v-btn"),g=m("v-card-title"),y=m("v-icon"),c=m("v-skeleton-loader"),D=m("v-chip"),A=m("v-table"),E=m("PaginationControls");return u(),h("div",null,[e[35]||(e[35]=o("div",{class:"page-header"},[o("h1",{class:"text-h4 page-title"},"Stock Ledger")],-1)),s(d,{class:"mb-4"},{default:l(()=>[s(x,null,{default:l(()=>[s(V,null,{default:l(()=>[s(f,{cols:"12",md:"3"},{default:l(()=>[s(v,{modelValue:n.productFilter,"onUpdate:modelValue":[e[0]||(e[0]=r=>n.productFilter=r),i.loadLedger],items:n.productOptions,label:"Filter by Product",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(f,{cols:"12",md:"3"},{default:l(()=>[s(v,{modelValue:n.warehouseFilter,"onUpdate:modelValue":[e[1]||(e[1]=r=>n.warehouseFilter=r),i.loadLedger],items:n.warehouseOptions,label:"Filter by Warehouse",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(f,{cols:"12",md:"3"},{default:l(()=>[s(v,{modelValue:n.typeFilter,"onUpdate:modelValue":[e[2]||(e[2]=r=>n.typeFilter=r),i.loadLedger],items:n.typeOptions,label:"Filter by Type",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(f,{cols:"12",md:"3"},{default:l(()=>[s(v,{modelValue:n.referenceTypeFilter,"onUpdate:modelValue":[e[3]||(e[3]=r=>n.referenceTypeFilter=r),i.loadLedger],items:n.referenceTypeOptions,label:"Filter by Reference",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(f,{cols:"12",md:"3"},{default:l(()=>[s(F,{modelValue:n.dateFrom,"onUpdate:modelValue":[e[4]||(e[4]=r=>n.dateFrom=r),i.onDateFromChange],label:"Date From",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(f,{cols:"12",md:"3"},{default:l(()=>[s(F,{modelValue:n.dateTo,"onUpdate:modelValue":[e[5]||(e[5]=r=>n.dateTo=r),i.onDateToChange],label:"Date To",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),s(f,{cols:"12",md:"3"},{default:l(()=>[s(_,{modelValue:t.search,"onUpdate:modelValue":e[6]||(e[6]=r=>t.search=r),label:"Search by reference number or product","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:i.loadLedger},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),s(d,null,{default:l(()=>[s(g,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[13]||(e[13]=o("span",null,"Stock Movements",-1)),o("div",W,[s(w,{color:"success",size:"small","prepend-icon":"mdi-file-excel",onClick:i.exportToExcel,disabled:t.loading||n.ledgers.length===0,loading:n.exporting},{default:l(()=>e[11]||(e[11]=[p(" Export Excel ")])),_:1,__:[11]},8,["onClick","disabled","loading"]),o("span",q,[e[12]||(e[12]=p(" Total Records: ")),o("strong",null,a(n.pagination.total||0),1),n.ledgers.length>0?(u(),h("span",H," | Showing "+a((n.currentPage-1)*n.perPage+1)+" to "+a(Math.min(n.currentPage*n.perPage,n.pagination.total))+" of "+a(n.pagination.total),1)):R("",!0)])])]),_:1,__:[13]}),s(x,null,{default:l(()=>[s(A,null,{default:l(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[7]||(e[7]=r=>i.onSort("transaction_date"))},[o("div",Q,[e[15]||(e[15]=o("span",null,"Date",-1)),t.sortBy==="transaction_date"?(u(),P(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(a(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(u(),P(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[14]||(e[14]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[14]}))])]),e[20]||(e[20]=o("th",null,"Product",-1)),e[21]||(e[21]=o("th",null,"Warehouse",-1)),e[22]||(e[22]=o("th",null,"Type",-1)),e[23]||(e[23]=o("th",null,"Reference",-1)),o("th",{class:"text-end sortable",onClick:e[8]||(e[8]=r=>i.onSort("quantity"))},[o("div",K,[e[17]||(e[17]=o("span",null,"Quantity",-1)),t.sortBy==="quantity"?(u(),P(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(a(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(u(),P(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[16]||(e[16]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[16]}))])]),e[24]||(e[24]=o("th",null,"Unit Cost",-1)),e[25]||(e[25]=o("th",null,"Total Cost",-1)),e[26]||(e[26]=o("th",null,"Balance After",-1)),e[27]||(e[27]=o("th",null,"Created By",-1)),o("th",{class:"sortable",onClick:e[9]||(e[9]=r=>i.onSort("created_at"))},[o("div",G,[e[19]||(e[19]=o("span",null,"Created At",-1)),t.sortBy==="created_at"?(u(),P(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(a(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(u(),P(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[18]||(e[18]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[18]}))])])])]),o("tbody",null,[t.loading?(u(),h(S,{key:0},z(5,r=>o("tr",{key:`skeleton-${r}`},[o("td",null,[s(c,{type:"text",width:"100"})]),o("td",null,[s(c,{type:"text",width:"150"})]),o("td",null,[s(c,{type:"text",width:"120"})]),o("td",null,[s(c,{type:"chip",width:"80",height:"24"})]),o("td",null,[s(c,{type:"text",width:"120"})]),o("td",null,[s(c,{type:"text",width:"80"})]),o("td",null,[s(c,{type:"text",width:"80"})]),o("td",null,[s(c,{type:"text",width:"80"})]),o("td",null,[s(c,{type:"text",width:"80"})]),o("td",null,[s(c,{type:"text",width:"100"})]),o("td",null,[s(c,{type:"text",width:"120"})])])),64)):(u(),h(S,{key:1},[(u(!0),h(S,null,z(n.ledgers,r=>{var U,L,O,B;return u(),h("tr",{key:r.id},[o("td",null,a(t.formatDateDDMMYYYY(r.transaction_date)),1),o("td",null,[o("div",J,[o("span",X,a((U=r.product)==null?void 0:U.name),1),o("span",Z,a((L=r.product)==null?void 0:L.sku),1)])]),o("td",null,a((O=r.warehouse)==null?void 0:O.name),1),o("td",null,[s(D,{color:r.type==="in"?"success":"error",size:"small"},{default:l(()=>[p(a(r.type==="in"?"IN":"OUT"),1)]),_:2},1032,["color"])]),o("td",null,[o("div",$,[o("span",ee,a(i.formatReferenceType(r.reference_type)),1),o("span",te,a(r.reference_number||"-"),1)])]),o("td",oe,a(r.quantity),1),o("td",ne,a(i.formatCurrency(r.unit_cost)),1),o("td",re,a(i.formatCurrency(r.total_cost)),1),o("td",se,[s(D,{size:"small",color:r.balance_after<0?"error":"default"},{default:l(()=>[p(a(r.balance_after),1)]),_:2},1032,["color"])]),o("td",null,a(((B=r.creator)==null?void 0:B.name)||"-"),1),o("td",null,a(t.formatDateShort(r.created_at)),1)])}),128)),n.ledgers.length===0?(u(),h("tr",ae,e[28]||(e[28]=[o("td",{colspan:"11",class:"text-center py-4"},"No stock movements found",-1)]))):R("",!0)],64))])]),_:1}),o("div",le,[o("div",ie,[n.ledgers.length>0&&n.pagination.total>0?(u(),h("span",de,[n.perPage==="all"?(u(),h("span",ue,[e[29]||(e[29]=p(" Showing ")),o("strong",null,"all "+a(n.pagination.total.toLocaleString()),1),e[30]||(e[30]=p(" records "))])):(u(),h("span",pe,[e[31]||(e[31]=p(" Showing ")),o("strong",null,a((n.currentPage-1)*n.perPage+1),1),e[32]||(e[32]=p(" to ")),o("strong",null,a(Math.min(n.currentPage*n.perPage,n.pagination.total)),1),e[33]||(e[33]=p(" of ")),o("strong",null,a(n.pagination.total.toLocaleString()),1),e[34]||(e[34]=p(" records "))]))])):(u(),h("span",ce,"No records found"))]),s(E,{modelValue:n.currentPage,"onUpdate:modelValue":e[10]||(e[10]=r=>n.currentPage=r),pagination:n.pagination,"per-page-value":n.perPage,"per-page-options":n.perPageOptions,"onUpdate:perPage":i.onPerPageUpdate,onPageChange:i.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1})])}const _e=I(Y,[["render",me],["__scopeId","data-v-0457737e"]]);export{_e as default};
