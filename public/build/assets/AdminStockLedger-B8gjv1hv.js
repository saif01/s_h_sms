import{c as A}from"./commonMixin-LD1l2-5e.js";import{p as E,P as N}from"./PaginationControls-CGFLaHsK.js";import{D as M}from"./DatePicker-pwDn7i3L.js";import{_ as j,c as h,b as o,a,w as l,r as c,f as u,e as O,t as r,d as _,F as T,y as R,o as d}from"./app-CYStQJ0f.js";const I={components:{PaginationControls:N,DatePicker:M},mixins:[A,E],data(){return{ledgers:[],products:[],warehouses:[],productFilter:null,productOptions:[],warehouseFilter:null,warehouseOptions:[],typeFilter:null,typeOptions:[{title:"Stock In",value:"in"},{title:"Stock Out",value:"out"}],referenceTypeFilter:null,referenceTypeOptions:[{title:"Purchase",value:"purchase"},{title:"Sales",value:"sales"},{title:"Return",value:"return"},{title:"Damage",value:"damage"},{title:"Lost",value:"lost"}],dateFrom:"",dateTo:"",exporting:!1}},async mounted(){await this.loadProducts(),await this.loadWarehouses(),await this.loadLedger()},methods:{async loadLedger(){try{this.loading=!0;const t=this.buildPaginationParams();this.perPage==="all"&&(t.per_page=999999),this.search&&(t.search=this.search),this.productFilter&&(t.product_id=this.productFilter),this.warehouseFilter&&(t.warehouse_id=this.warehouseFilter),this.typeFilter&&(t.type=this.typeFilter),this.referenceTypeFilter&&(t.reference_type=this.referenceTypeFilter),this.dateFrom&&String(this.dateFrom).trim()!==""&&(t.date_from=this.dateFrom),this.dateTo&&String(this.dateTo).trim()!==""&&(t.date_to=this.dateTo);const e=await this.$axios.get("/api/v1/stock-ledger",{params:t,headers:this.getAuthHeaders()});this.ledgers=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load stock ledger")}finally{this.loading=!1}},async loadProducts(){try{const t=await this.$axios.get("/api/v1/products",{params:{per_page:1e3},headers:this.getAuthHeaders()});this.products=t.data.data||[],this.productOptions=this.products.map(e=>({title:`${e.name} (${e.sku})`,value:e.id}))}catch(t){console.error("Error loading products:",t)}},async loadWarehouses(){try{const t=await this.$axios.get("/api/v1/stock-ledger/warehouses",{headers:this.getAuthHeaders()});this.warehouses=t.data.warehouses||[],this.warehouseOptions=this.warehouses.map(e=>({title:e.label,value:e.value}))}catch(t){console.error("Error loading warehouses:",t)}},formatReferenceType(t){return{purchase:"Purchase",sales:"Sales",return:"Return",damage:"Damage",lost:"Lost"}[t]||t},formatCurrency(t){return t==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},onDateFromChange(t){this.dateFrom=t||"",this.resetPagination(),this.loadLedger()},onDateToChange(t){this.dateTo=t||"",this.resetPagination(),this.loadLedger()},async exportToExcel(){try{this.exporting=!0;const t={};this.search&&(t.search=this.search),this.productFilter&&(t.product_id=this.productFilter),this.warehouseFilter&&(t.warehouse_id=this.warehouseFilter),this.typeFilter&&(t.type=this.typeFilter),this.referenceTypeFilter&&(t.reference_type=this.referenceTypeFilter),this.dateFrom&&String(this.dateFrom).trim()!==""&&(t.date_from=this.dateFrom),this.dateTo&&String(this.dateTo).trim()!==""&&(t.date_to=this.dateTo),t.per_page=999999;const P=(await this.$axios.get("/api/v1/stock-ledger",{params:t,headers:this.getAuthHeaders()})).data.data||[];if(P.length===0){this.showError("No data to export");return}const S=["Date","Product Name","Product SKU","Warehouse","Type","Reference Type","Reference Number","Quantity","Unit Cost","Total Cost","Balance After","Created By","Created At"],s=P.map(i=>{var F,f,y,p;return[this.formatDateDDMMYYYY(i.transaction_date)||"",((F=i.product)==null?void 0:F.name)||"",((f=i.product)==null?void 0:f.sku)||"",((y=i.warehouse)==null?void 0:y.name)||"",i.type==="in"?"IN":"OUT",this.formatReferenceType(i.reference_type)||"",i.reference_number||"",i.quantity||0,parseFloat(i.unit_cost||0).toFixed(2),parseFloat(i.total_cost||0).toFixed(2),i.balance_after||0,((p=i.creator)==null?void 0:p.name)||"",this.formatDateShort(i.created_at)||""]}),m=[S.join(","),...s.map(i=>i.map(F=>{const f=String(F||"");return f.includes(",")||f.includes('"')||f.includes(`
`)?`"${f.replace(/"/g,'""')}"`:f}).join(","))].join(`
`),w="\uFEFF",g=new Blob([w+m],{type:"text/csv;charset=utf-8;"}),b=window.URL.createObjectURL(g),v=document.createElement("a");v.href=b;const k=new Date().toISOString().split("T")[0];v.setAttribute("download",`stock_ledger_${k}.csv`),document.body.appendChild(v),v.click(),v.remove(),window.URL.revokeObjectURL(b),this.showSuccess("Stock ledger exported successfully")}catch(t){this.handleApiError(t,"Failed to export stock ledger")}finally{this.exporting=!1}}}},Y={class:"d-flex align-center gap-2"},W={class:"text-caption text-grey"},q={key:0},H={class:"sortable-header"},Q={class:"sortable-header justify-end"},K={class:"sortable-header"},G={class:"d-flex flex-column"},J={class:"font-weight-medium"},X={class:"text-caption text-grey"},Z={class:"d-flex flex-column"},$={class:"text-body-2"},ee={class:"text-caption text-grey"},te={class:"text-right"},oe={class:"text-right"},ne={class:"text-right"},ae={class:"text-right"},se={key:0},re={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},le={class:"text-caption text-grey"},ie={key:0},de={key:0},ue={key:1},pe={key:1};function ce(t,e,P,S,s,m){const w=c("v-select"),g=c("v-col"),b=c("DatePicker"),v=c("v-text-field"),V=c("v-row"),k=c("v-card-text"),i=c("v-card"),F=c("v-btn"),f=c("v-card-title"),y=c("v-icon"),p=c("v-skeleton-loader"),x=c("v-chip"),B=c("v-table"),z=c("PaginationControls");return d(),h("div",null,[e[35]||(e[35]=o("div",{class:"page-header"},[o("h1",{class:"text-h4 page-title"},"Stock Ledger")],-1)),a(i,{class:"mb-4"},{default:l(()=>[a(k,null,{default:l(()=>[a(V,null,{default:l(()=>[a(g,{cols:"12",md:"3"},{default:l(()=>[a(w,{modelValue:s.productFilter,"onUpdate:modelValue":[e[0]||(e[0]=n=>s.productFilter=n),m.loadLedger],items:s.productOptions,label:"Filter by Product",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(g,{cols:"12",md:"3"},{default:l(()=>[a(w,{modelValue:s.warehouseFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>s.warehouseFilter=n),m.loadLedger],items:s.warehouseOptions,label:"Filter by Warehouse",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(g,{cols:"12",md:"3"},{default:l(()=>[a(w,{modelValue:s.typeFilter,"onUpdate:modelValue":[e[2]||(e[2]=n=>s.typeFilter=n),m.loadLedger],items:s.typeOptions,label:"Filter by Type",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(g,{cols:"12",md:"3"},{default:l(()=>[a(w,{modelValue:s.referenceTypeFilter,"onUpdate:modelValue":[e[3]||(e[3]=n=>s.referenceTypeFilter=n),m.loadLedger],items:s.referenceTypeOptions,label:"Filter by Reference",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),a(g,{cols:"12",md:"3"},{default:l(()=>[a(b,{modelValue:s.dateFrom,"onUpdate:modelValue":[e[4]||(e[4]=n=>s.dateFrom=n),m.onDateFromChange],label:"Date From",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{cols:"12",md:"3"},{default:l(()=>[a(b,{modelValue:s.dateTo,"onUpdate:modelValue":[e[5]||(e[5]=n=>s.dateTo=n),m.onDateToChange],label:"Date To",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),a(g,{cols:"12",md:"3"},{default:l(()=>[a(v,{modelValue:t.search,"onUpdate:modelValue":e[6]||(e[6]=n=>t.search=n),label:"Search by reference number or product","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:m.loadLedger},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),a(i,null,{default:l(()=>[a(f,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[13]||(e[13]=o("span",null,"Stock Movements",-1)),o("div",Y,[a(F,{color:"success",size:"small","prepend-icon":"mdi-file-excel",onClick:m.exportToExcel,disabled:t.loading||s.ledgers.length===0,loading:s.exporting},{default:l(()=>e[11]||(e[11]=[u(" Export Excel ")])),_:1,__:[11]},8,["onClick","disabled","loading"]),o("span",W,[e[12]||(e[12]=u(" Total Records: ")),o("strong",null,r((t.pagination.total||0).toLocaleString()),1),s.ledgers.length>0?(d(),h("span",q," | Showing "+r((t.currentPage-1)*t.perPage+1)+" to "+r(Math.min(t.currentPage*t.perPage,t.pagination.total).toLocaleString())+" of "+r(t.pagination.total.toLocaleString()),1)):O("",!0)])])]),_:1,__:[13]}),a(k,null,{default:l(()=>[a(B,null,{default:l(()=>[o("thead",null,[o("tr",null,[o("th",{class:"sortable",onClick:e[7]||(e[7]=n=>t.onSort("transaction_date"))},[o("div",H,[e[15]||(e[15]=o("span",null,"Date",-1)),t.sortBy==="transaction_date"?(d(),_(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[u(r(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),_(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[14]||(e[14]=[u(" mdi-unfold-more-horizontal ")])),_:1,__:[14]}))])]),e[20]||(e[20]=o("th",null,"Product",-1)),e[21]||(e[21]=o("th",null,"Warehouse",-1)),e[22]||(e[22]=o("th",null,"Type",-1)),e[23]||(e[23]=o("th",null,"Reference",-1)),o("th",{class:"text-end sortable",onClick:e[8]||(e[8]=n=>t.onSort("quantity"))},[o("div",Q,[e[17]||(e[17]=o("span",null,"Quantity",-1)),t.sortBy==="quantity"?(d(),_(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[u(r(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),_(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[16]||(e[16]=[u(" mdi-unfold-more-horizontal ")])),_:1,__:[16]}))])]),e[24]||(e[24]=o("th",null,"Unit Cost",-1)),e[25]||(e[25]=o("th",null,"Total Cost",-1)),e[26]||(e[26]=o("th",null,"Balance After",-1)),e[27]||(e[27]=o("th",null,"Created By",-1)),o("th",{class:"sortable",onClick:e[9]||(e[9]=n=>t.onSort("created_at"))},[o("div",K,[e[19]||(e[19]=o("span",null,"Created At",-1)),t.sortBy==="created_at"?(d(),_(y,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[u(r(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),_(y,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[18]||(e[18]=[u(" mdi-unfold-more-horizontal ")])),_:1,__:[18]}))])])])]),o("tbody",null,[t.loading?(d(),h(T,{key:0},R(5,n=>o("tr",{key:`skeleton-${n}`},[o("td",null,[a(p,{type:"text",width:"100"})]),o("td",null,[a(p,{type:"text",width:"150"})]),o("td",null,[a(p,{type:"text",width:"120"})]),o("td",null,[a(p,{type:"chip",width:"80",height:"24"})]),o("td",null,[a(p,{type:"text",width:"120"})]),o("td",null,[a(p,{type:"text",width:"80"})]),o("td",null,[a(p,{type:"text",width:"80"})]),o("td",null,[a(p,{type:"text",width:"80"})]),o("td",null,[a(p,{type:"text",width:"80"})]),o("td",null,[a(p,{type:"text",width:"100"})]),o("td",null,[a(p,{type:"text",width:"120"})])])),64)):(d(),h(T,{key:1},[(d(!0),h(T,null,R(s.ledgers,n=>{var C,D,U,L;return d(),h("tr",{key:n.id},[o("td",null,r(t.formatDateDDMMYYYY(n.transaction_date)),1),o("td",null,[o("div",G,[o("span",J,r((C=n.product)==null?void 0:C.name),1),o("span",X,r((D=n.product)==null?void 0:D.sku),1)])]),o("td",null,r((U=n.warehouse)==null?void 0:U.name),1),o("td",null,[a(x,{color:n.type==="in"?"success":"error",size:"small"},{default:l(()=>[u(r(n.type==="in"?"IN":"OUT"),1)]),_:2},1032,["color"])]),o("td",null,[o("div",Z,[o("span",$,r(m.formatReferenceType(n.reference_type)),1),o("span",ee,r(n.reference_number||"-"),1)])]),o("td",te,r(n.quantity),1),o("td",oe,r(m.formatCurrency(n.unit_cost)),1),o("td",ne,r(m.formatCurrency(n.total_cost)),1),o("td",ae,[a(x,{size:"small",color:n.balance_after<0?"error":"default"},{default:l(()=>[u(r(n.balance_after),1)]),_:2},1032,["color"])]),o("td",null,r(((L=n.creator)==null?void 0:L.name)||"-"),1),o("td",null,r(t.formatDateShort(n.created_at)),1)])}),128)),s.ledgers.length===0?(d(),h("tr",se,e[28]||(e[28]=[o("td",{colspan:"11",class:"text-center py-4"},"No stock movements found",-1)]))):O("",!0)],64))])]),_:1}),o("div",re,[o("div",le,[s.ledgers.length>0&&t.pagination.total>0?(d(),h("span",ie,[t.perPage==="all"?(d(),h("span",de,[e[29]||(e[29]=u(" Showing ")),o("strong",null,"all "+r(t.pagination.total.toLocaleString()),1),e[30]||(e[30]=u(" records "))])):(d(),h("span",ue,[e[31]||(e[31]=u(" Showing ")),o("strong",null,r((t.currentPage-1)*t.perPage+1),1),e[32]||(e[32]=u(" to ")),o("strong",null,r(Math.min(t.currentPage*t.perPage,t.pagination.total).toLocaleString()),1),e[33]||(e[33]=u(" of ")),o("strong",null,r(t.pagination.total.toLocaleString()),1),e[34]||(e[34]=u(" records "))]))])):(d(),h("span",pe,"No records found"))]),a(z,{modelValue:t.currentPage,"onUpdate:modelValue":e[10]||(e[10]=n=>t.currentPage=n),pagination:t.pagination,"per-page-value":t.perPage,"per-page-options":t.perPageOptions,"onUpdate:perPage":t.onPerPageUpdate,onPageChange:t.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1})])}const ye=j(I,[["render",ce],["__scopeId","data-v-08076127"]]);export{ye as default};
