import{c as q}from"./commonMixin-BwIVv23E.js";import{U as Y}from"./UserProfileDialog-aVKRux2g.js";import{r as K,n as Q}from"./uploads-CnEkgyD_.js";import{D as $}from"./DatePickerVuetifyInput-D8pENmvL.js";import{_ as L,d as y,w as r,a as o,r as i,b as a,t as c,g as ee,f as m,e as b,c as p,n as te,j as oe,k as se,o as u,F as D,h as B}from"./app-BqLCFCMY.js";import{P as re,p as M,d as I}from"./PaginationControls-DoA1lTDa.js";import"./moment-C5S46NFB.js";const ae={name:"UserDialog",components:{DatePickerVuetifyInput:$},mixins:[q],props:{modelValue:{type:Boolean,required:!0},user:{type:Object,default:null},roles:{type:Array,default:()=>[]}},emits:["update:modelValue","save","error"],data(){return{form:{name:"",email:"",role_ids:[],password:"",password_confirmation:"",avatar:"",phone:"",date_of_birth:"",gender:null,address:"",city:"",state:"",country:"",postal_code:"",bio:""},activeTab:"basic",showPassword:!1,showPasswordConfirmation:!1,avatarFile:null,uploadingAvatar:!1,saving:!1,AVATAR_MAX_SIZE:5*1024*1024,AVATAR_FOLDER:"users",MIN_PASSWORD_LENGTH:8}},computed:{isEditing(){return!!this.user},dialogTitle(){return this.isEditing?"Edit User":"Add New User"},genderOptions(){return[{title:"Male",value:"male"},{title:"Female",value:"female"},{title:"Other",value:"other"}]},validationRules(){return{required:t=>Array.isArray(t)?t.length>0||"At least one role is required":!!t||"This field is required",email:t=>t?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(t)||"Invalid email address":!0,minLength:t=>t?t.length>=this.MIN_PASSWORD_LENGTH||`Password must be at least ${this.MIN_PASSWORD_LENGTH} characters`:!0}},passwordRules(){return this.isEditing?[]:[this.validationRules.required,this.validationRules.minLength]},passwordConfirmationRules(){return this.form.password?[()=>!!this.form.password_confirmation||"Please confirm your password",()=>this.form.password_confirmation===this.form.password||"Passwords do not match"]:[]},shouldShowPasswordConfirmation(){return!this.isEditing||!!this.form.password},avatarUrl(){return this.form.avatar?this.resolveImageUrl(this.form.avatar):""},avatarUploadHint(){return"Upload an avatar image (JPG, PNG, GIF, WebP - Max 5MB). Recommended size: 200x200px"}},watch:{user:{handler(t){t?this.loadUserData(t):this.resetForm()},immediate:!0},modelValue(t){t?this.activeTab="basic":this.resetForm()}},methods:{loadUserData(t){const e=t.roles?t.roles.map(h=>h.id):[],f=this.normalizeImageInput(t.avatar||"");this.form={name:t.name||"",email:t.email||"",role_ids:e,password:"",password_confirmation:"",avatar:f,phone:t.phone||"",date_of_birth:t.date_of_birth||"",gender:t.gender||null,address:t.address||"",city:t.city||"",state:t.state||"",country:t.country||"",postal_code:t.postal_code||"",bio:t.bio||""}},resetForm(){const t=this.roles.length>0?this.roles[0].value:null;this.form={name:"",email:"",role_ids:t?[t]:[],password:"",password_confirmation:"",avatar:"",phone:"",date_of_birth:"",gender:null,address:"",city:"",state:"",country:"",postal_code:"",bio:""},this.showPassword=!1,this.showPasswordConfirmation=!1,this.avatarFile=null,this.activeTab="basic",this.$refs.formRef&&this.$refs.formRef.resetValidation()},normalizeImageInput(t){return Q(t)},resolveImageUrl(t){return K(t)},async handleAvatarUpload(){if(!this.avatarFile)return;const t=Array.isArray(this.avatarFile)?this.avatarFile[0]:this.avatarFile;if(t){if(!t.type.startsWith("image/")){this.showError("Please select a valid image file"),this.avatarFile=null;return}if(t.size>this.AVATAR_MAX_SIZE){this.showError("File size must be less than 5MB"),this.avatarFile=null;return}this.uploadingAvatar=!0;try{const e=new FormData;e.append("image",t),e.append("folder",this.AVATAR_FOLDER),this.form.name&&e.append("prefix",this.form.name);const f=this.getAuthToken(),h=await this.$axios.post("/api/v1/upload/image",e,{headers:{...this.getAuthHeaders(),"Content-Type":"multipart/form-data"}});if(h.data.success){const s=this.normalizeImageInput(h.data.path||h.data.url);this.form.avatar=s,this.avatarFile=null,this.showSuccess("Avatar uploaded successfully")}else throw new Error(h.data.message||"Failed to upload avatar")}catch(e){console.error("Error uploading avatar:",e);const f=this.extractErrorMessage(e,"Failed to upload avatar");this.showError(f),this.avatarFile=null}finally{this.uploadingAvatar=!1}}},handleClearAvatar(){this.form.avatar="",this.avatarFile=null},extractErrorMessage(t,e){var f,h;return(h=(f=t.response)==null?void 0:f.data)!=null&&h.message?t.response.data.message:t.message?t.message:e},validatePasswords(){return this.form.password&&this.form.password!==this.form.password_confirmation?(this.showError("Passwords do not match"),!1):!this.isEditing&&!this.form.password?(this.showError("Password is required for new users"),!1):this.isEditing&&this.form.password&&!this.form.password_confirmation?(this.showError("Please confirm the password"),!1):!0},prepareFormData(){const t={...this.form};return t.role_ids&&(t.role_ids=Array.isArray(t.role_ids)?t.role_ids:[t.role_ids]),this.form.password?t.password_confirmation=this.form.password_confirmation:(delete t.password,delete t.password_confirmation),t.avatar=this.normalizeImageInput(t.avatar),delete t.role,t},async handleSave(){if(this.validatePasswords()&&this.$refs.formRef.validate()){this.saving=!0;try{const t=this.getAuthToken(),e=this.isEditing?`/api/v1/users/${this.user.id}`:"/api/v1/users",f=this.isEditing?"put":"post",h=this.prepareFormData();await this.$axios[f](e,h,{headers:this.getAuthHeaders()}),this.showSuccess(this.isEditing?"User updated successfully":"User created successfully"),this.$emit("save",h),this.handleClose()}catch(t){console.error("Error saving user:",t),this.handleSaveError(t)}finally{this.saving=!1}}},handleSaveError(t){var f,h,s,d;let e="Error saving user";if((h=(f=t.response)==null?void 0:f.data)!=null&&h.errors){const v=t.response.data.errors,k=[];Object.keys(v).forEach(P=>{Array.isArray(v[P])&&v[P].length>0&&k.push(v[P][0])}),e=k.length>0?k.join(", "):e}else(d=(s=t.response)==null?void 0:s.data)!=null&&d.message&&(e=t.response.data.message);this.handleApiError(t,e),this.$emit("error",t)},handleClose(){this.$emit("update:modelValue",!1)}}},le={class:"text-h6 font-weight-medium"},ie={class:"pa-6"},ne={class:"d-flex align-center"},de={key:1,class:"text-grey text-caption align-self-center"},ue={class:"mb-4"},me={class:"text-subtitle-2 font-weight-medium mb-3"},pe={key:0,class:"mb-3 text-center"},ce={class:"pa-6"},fe={class:"pa-6"},he={key:0,class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},ve={key:0,class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}};function ge(t,e,f,h,s,d){const v=i("v-btn"),k=i("v-card-title"),P=i("v-divider"),V=i("v-icon"),E=i("v-tab"),S=i("v-tabs"),_=i("v-text-field"),z=i("v-chip"),U=i("v-list-item"),g=i("v-select"),R=i("v-img"),F=i("v-avatar"),T=i("v-progress-circular"),O=i("v-file-input"),A=i("v-window-item"),w=i("v-col"),N=i("DatePickerVuetifyInput"),l=i("v-textarea"),x=i("v-row"),H=i("v-window"),j=i("v-form"),G=i("v-card-text"),W=i("v-spacer"),Z=i("v-card-actions"),J=i("v-card"),X=i("v-dialog");return u(),y(X,{"model-value":f.modelValue,"onUpdate:modelValue":e[19]||(e[19]=n=>t.$emit("update:modelValue",n)),"max-width":"900",scrollable:"",persistent:""},{default:r(()=>[o(J,null,{default:r(()=>[o(k,{class:"d-flex align-center justify-space-between"},{default:r(()=>[a("span",le,c(d.dialogTitle),1),o(v,{icon:"mdi-close",variant:"text",size:"small",onClick:d.handleClose},null,8,["onClick"])]),_:1}),o(P),o(G,{class:"pa-0"},{default:r(()=>[o(j,{ref:"formRef",onSubmit:ee(d.handleSave,["prevent"])},{default:r(()=>[o(S,{modelValue:s.activeTab,"onUpdate:modelValue":e[0]||(e[0]=n=>s.activeTab=n),"bg-color":"grey-lighten-5",color:"primary","slider-color":"primary",class:"user-dialog-tabs"},{default:r(()=>[o(E,{value:"basic"},{default:r(()=>[o(V,{start:"",size:"small"},{default:r(()=>e[20]||(e[20]=[m("mdi-account")])),_:1,__:[20]}),e[21]||(e[21]=a("span",{class:"ml-1"},"Basic Information",-1))]),_:1,__:[21]}),o(E,{value:"profile"},{default:r(()=>[o(V,{start:"",size:"small"},{default:r(()=>e[22]||(e[22]=[m("mdi-account-details")])),_:1,__:[22]}),e[23]||(e[23]=a("span",{class:"ml-1"},"Profile Information",-1))]),_:1,__:[23]}),o(E,{value:"security"},{default:r(()=>[o(V,{start:"",size:"small"},{default:r(()=>e[24]||(e[24]=[m("mdi-lock")])),_:1,__:[24]}),e[25]||(e[25]=a("span",{class:"ml-1"},"Security",-1))]),_:1,__:[25]})]),_:1},8,["modelValue"]),o(H,{modelValue:s.activeTab,"onUpdate:modelValue":e[18]||(e[18]=n=>s.activeTab=n)},{default:r(()=>[o(A,{value:"basic"},{default:r(()=>[a("div",ie,[o(_,{modelValue:s.form.name,"onUpdate:modelValue":e[1]||(e[1]=n=>s.form.name=n),placeholder:"Enter full name (e.g., John Doe)",variant:"outlined",density:"comfortable",rules:[d.validationRules.required],required:"","prepend-inner-icon":"mdi-account",hint:"Enter the user's full name as it should appear in the system","persistent-hint":"","hide-details":"auto",class:"mb-4"},{label:r(()=>e[26]||(e[26]=[m(" Full Name "),a("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","rules"]),o(_,{modelValue:s.form.email,"onUpdate:modelValue":e[2]||(e[2]=n=>s.form.email=n),type:"email",placeholder:"Enter email address (e.g., user@example.com)",variant:"outlined",density:"comfortable",rules:[d.validationRules.required,d.validationRules.email],required:"","prepend-inner-icon":"mdi-email",hint:"Enter a valid email address. This will be used for login and notifications","persistent-hint":"","hide-details":"auto",class:"mb-4"},{label:r(()=>e[27]||(e[27]=[m(" Email "),a("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","rules"]),o(g,{modelValue:s.form.role_ids,"onUpdate:modelValue":e[3]||(e[3]=n=>s.form.role_ids=n),items:f.roles,"item-title":"label","item-value":"value",placeholder:"Select one or more roles",variant:"outlined",density:"comfortable",rules:[d.validationRules.required],required:"",multiple:"",chips:"","prepend-inner-icon":"mdi-account-group",hint:"Select at least one role to define user permissions. You can select multiple roles","persistent-hint":"","hide-details":"auto",class:"mb-4"},{label:r(()=>e[28]||(e[28]=[m(" Roles "),a("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),item:r(({props:n,item:C})=>[o(U,te(oe(n)),{title:r(()=>[a("div",ne,[m(c(C.raw.label)+" ",1),C.raw.is_system?(u(),y(z,{key:0,size:"x-small",color:"warning",class:"ml-2"},{default:r(()=>e[29]||(e[29]=[m(" System ")])),_:1,__:[29]})):b("",!0)])]),subtitle:r(()=>[m(c(C.raw.description),1)]),_:2},1040)]),selection:r(({item:n,index:C})=>[C<2?(u(),y(z,{key:0,size:"small",class:"mr-1"},{default:r(()=>[m(c(n.raw.label),1)]),_:2},1024)):b("",!0),C===2?(u(),p("span",de," (+"+c(s.form.role_ids.length-2)+" others) ",1)):b("",!0)]),_:1},8,["modelValue","items","rules"]),a("div",ue,[a("div",me,[o(V,{size:"small",class:"mr-1"},{default:r(()=>e[30]||(e[30]=[m("mdi-image")])),_:1,__:[30]}),e[31]||(e[31]=m(" Avatar "))]),s.form.avatar?(u(),p("div",pe,[o(F,{size:"100",class:"mb-3"},{default:r(()=>[o(R,{src:d.avatarUrl,alt:`${s.form.name||"User"} Avatar`,cover:""},null,8,["src","alt"])]),_:1}),a("div",null,[o(v,{size:"small",variant:"text",color:"error","prepend-icon":"mdi-delete",onClick:d.handleClearAvatar},{default:r(()=>e[32]||(e[32]=[m(" Remove Avatar ")])),_:1,__:[32]},8,["onClick"])])])):b("",!0),o(O,{modelValue:s.avatarFile,"onUpdate:modelValue":[e[4]||(e[4]=n=>s.avatarFile=n),d.handleAvatarUpload],label:"Upload Avatar",variant:"outlined",density:"comfortable",color:"primary",accept:"image/*","prepend-icon":"mdi-image",hint:d.avatarUploadHint,"persistent-hint":"","show-size":""},se({_:2},[s.uploadingAvatar?{name:"append-inner",fn:r(()=>[o(T,{indeterminate:"",size:"20",color:"primary"})]),key:"0"}:void 0]),1032,["modelValue","hint","onUpdate:modelValue"])])])]),_:1}),o(A,{value:"profile"},{default:r(()=>[a("div",ce,[o(x,{dense:""},{default:r(()=>[o(w,{cols:"12",md:"6"},{default:r(()=>[o(_,{modelValue:s.form.phone,"onUpdate:modelValue":e[5]||(e[5]=n=>s.form.phone=n),label:"Phone Number",placeholder:"Enter phone number (e.g., +8801707080401)",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-phone",hint:"Include country code. Format: +[country code][number]","persistent-hint":"","hide-details":"auto"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12",md:"6"},{default:r(()=>[o(N,{"field-label":"Date of Birth",variant:"outlined","initial-date":s.form.date_of_birth,onTrigerInputValue:e[6]||(e[6]=n=>s.form.date_of_birth=n)},null,8,["initial-date"]),e[33]||(e[33]=a("div",{class:"text-caption text-grey mt-1 ml-2"}," Select the user's date of birth ",-1))]),_:1,__:[33]}),o(w,{cols:"12",md:"6"},{default:r(()=>[o(g,{modelValue:s.form.gender,"onUpdate:modelValue":e[7]||(e[7]=n=>s.form.gender=n),items:d.genderOptions,label:"Gender",placeholder:"Select gender",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-gender-male-female",clearable:"",hint:"Optional: Select user's gender","persistent-hint":"","hide-details":"auto"},null,8,["modelValue","items"])]),_:1}),o(w,{cols:"12"},{default:r(()=>[o(l,{modelValue:s.form.address,"onUpdate:modelValue":e[8]||(e[8]=n=>s.form.address=n),label:"Address",placeholder:"Enter street address, building number, etc.",variant:"outlined",density:"comfortable",rows:"2","prepend-inner-icon":"mdi-map-marker",hint:"Enter the complete street address","persistent-hint":"","hide-details":"auto"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12",md:"4"},{default:r(()=>[o(_,{modelValue:s.form.city,"onUpdate:modelValue":e[9]||(e[9]=n=>s.form.city=n),label:"City",placeholder:"Enter city name",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-city",hint:"Optional: City name","persistent-hint":"","hide-details":"auto"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12",md:"4"},{default:r(()=>[o(_,{modelValue:s.form.state,"onUpdate:modelValue":e[10]||(e[10]=n=>s.form.state=n),label:"State/Province",placeholder:"Enter state or province",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-map",hint:"Optional: State or province name","persistent-hint":"","hide-details":"auto"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12",md:"4"},{default:r(()=>[o(_,{modelValue:s.form.country,"onUpdate:modelValue":e[11]||(e[11]=n=>s.form.country=n),label:"Country",placeholder:"Enter country name",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-earth",hint:"Optional: Country name","persistent-hint":"","hide-details":"auto"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12",md:"6"},{default:r(()=>[o(_,{modelValue:s.form.postal_code,"onUpdate:modelValue":e[12]||(e[12]=n=>s.form.postal_code=n),label:"Postal Code",placeholder:"Enter postal or zip code",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-mailbox",hint:"Optional: Postal or ZIP code","persistent-hint":"","hide-details":"auto"},null,8,["modelValue"])]),_:1}),o(w,{cols:"12"},{default:r(()=>[o(l,{modelValue:s.form.bio,"onUpdate:modelValue":e[13]||(e[13]=n=>s.form.bio=n),label:"Bio/Description",placeholder:"Enter a brief description about the user (optional)",variant:"outlined",density:"comfortable",rows:"4","prepend-inner-icon":"mdi-text",hint:"Optional: Brief description about the user. Maximum 1000 characters","persistent-hint":"",counter:1e3,"hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),o(A,{value:"security"},{default:r(()=>[a("div",fe,[o(_,{modelValue:s.form.password,"onUpdate:modelValue":e[15]||(e[15]=n=>s.form.password=n),placeholder:d.isEditing?"Enter new password (leave blank to keep current)":"Enter password (minimum 8 characters)",variant:"outlined",density:"comfortable",type:s.showPassword?"text":"password",rules:d.passwordRules,required:!d.isEditing,hint:d.isEditing?"Leave blank to keep current password. If changing, enter a new password with at least 8 characters":"Password must be at least 8 characters long","persistent-hint":!0,"prepend-inner-icon":"mdi-lock","hide-details":"auto",class:"mb-4"},{label:r(()=>[e[34]||(e[34]=m(" Password ")),d.isEditing?b("",!0):(u(),p("span",he,"*"))]),"append-inner":r(()=>[o(v,{icon:"",variant:"text",size:"small",onClick:e[14]||(e[14]=n=>s.showPassword=!s.showPassword)},{default:r(()=>[o(V,null,{default:r(()=>[m(c(s.showPassword?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","placeholder","type","rules","required","hint"]),d.shouldShowPasswordConfirmation?(u(),y(_,{key:0,modelValue:s.form.password_confirmation,"onUpdate:modelValue":e[17]||(e[17]=n=>s.form.password_confirmation=n),placeholder:"Re-enter the password to confirm",variant:"outlined",density:"comfortable",type:s.showPasswordConfirmation?"text":"password",rules:d.passwordConfirmationRules,required:!!s.form.password,"prepend-inner-icon":"mdi-lock-check",hint:"Re-enter the password to confirm it matches","persistent-hint":"","hide-details":"auto"},{label:r(()=>[e[35]||(e[35]=m(" Confirm Password ")),s.form.password?(u(),p("span",ve,"*")):b("",!0)]),"append-inner":r(()=>[o(v,{icon:"",variant:"text",size:"small",onClick:e[16]||(e[16]=n=>s.showPasswordConfirmation=!s.showPasswordConfirmation)},{default:r(()=>[o(V,null,{default:r(()=>[m(c(s.showPasswordConfirmation?"mdi-eye-off":"mdi-eye"),1)]),_:1})]),_:1})]),_:1},8,["modelValue","type","rules","required"])):b("",!0)])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(P),o(Z,{class:"pa-4"},{default:r(()=>[o(W),o(v,{variant:"text",onClick:d.handleClose,disabled:s.saving},{default:r(()=>e[36]||(e[36]=[m(" Cancel ")])),_:1,__:[36]},8,["onClick","disabled"]),o(v,{color:"primary",variant:"elevated",loading:s.saving,onClick:d.handleSave},{default:r(()=>[m(c(d.isEditing?"Update":"Create"),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const _e=L(ae,[["render",ge],["__scopeId","data-v-49c38b0d"]]),ye={components:{UserProfileDialog:Y,UserDialog:_e,PaginationControls:re},mixins:[q],data(){return{users:[],roles:[],roleFilter:null,roleOptions:[],dialog:!1,editingUser:null,currentUserId:null,profileDialogVisible:!1,selectedUser:null,currentPage:I.currentPage,perPage:I.perPage,perPageOptions:I.perPageOptions,pagination:{...I.pagination}}},async mounted(){await this.loadRoles(),await this.loadUsers(),this.loadCurrentUser()},methods:{async loadUsers(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.roleFilter&&(t.role=this.roleFilter);const e=await this.$axios.get("/api/v1/users",{params:t,headers:this.getAuthHeaders()}),f=e.data.data||[];this.users=f,this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load users")}finally{this.loading=!1}},async loadRoles(){try{const t=await this.$axios.get("/api/v1/users/roles",{headers:this.getAuthHeaders()});this.roles=t.data.roles,this.roleOptions=this.roles.map(e=>({title:e.label,value:e.value}))}catch(t){console.error("Error loading roles:",t)}},loadCurrentUser(){const t=localStorage.getItem("admin_token");this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${t}`}}).then(e=>{this.currentUserId=e.data.id}).catch(()=>{})},openDialog(t){this.editingUser=t,this.dialog=!0},async onUserSaved(){this.editingUser=null,await this.loadUsers()},async deleteUser(t){if(t.id===this.currentUserId){this.showError("You cannot delete your own account");return}if(confirm(`Are you sure you want to delete ${t.name}?`))try{const e=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/users/${t.id}`,{headers:{Authorization:`Bearer ${e}`}}),this.showSuccess("User deleted successfully"),await this.loadUsers()}catch(e){this.handleApiError(e,"Error deleting user")}},getRoleLabel(t){const e=this.roles.find(f=>f.slug===t);return e?e.label:t},getRoleColor(t){return{administrator:"error",editor:"primary","hr-user":"success",staff:"info"}[t]||"primary"},buildPaginationParams(t={}){return M.buildPaginationParams(this.currentPage,this.perPage,t,this.sortBy,this.sortDirection)},updatePagination(t){M.updatePagination(this,t)},resetPagination(){M.resetPagination(this)},onPerPageChange(){this.resetPagination(),this.loadUsers()},onPerPageUpdate(t){this.perPage=t,this.onPerPageChange()},onPageChange(t){this.currentPage=t,this.loadUsers()},onSort(t){this.handleSort(t),this.currentPage=1,this.loadUsers()},async viewUserProfile(t){try{const e=localStorage.getItem("admin_token"),f=await this.$axios.get(`/api/v1/users/${t.id}`,{headers:{Authorization:`Bearer ${e}`}});this.selectedUser=f.data,this.profileDialogVisible=!0}catch(e){console.error("Error loading user profile:",e),this.selectedUser=t,this.profileDialogVisible=!0,this.handleApiError(e,"Failed to load user profile details")}}}},we={class:"page-header"},be={class:"text-caption text-grey"},Pe={class:"sortable-header"},Ue={class:"sortable-header"},Ve={class:"sortable-header"},xe={class:"d-flex align-center gap-2"},ke={class:"d-flex flex-wrap gap-1"},Ce={class:"d-flex"},Ee={class:"d-flex align-center gap-2"},Ae={key:1,class:"text-white"},Se={key:0,class:"d-flex align-center"},ze={key:1,class:"text-caption text-grey"},De={key:0,class:"d-flex flex-column"},Ie={key:0,class:"text-body-2"},Re={key:1,class:"text-caption text-grey"},Fe={key:2,class:"text-caption text-grey"},Te={key:1,class:"text-caption text-grey"},Oe={key:0,class:"d-flex flex-wrap gap-1"},Ne={key:1,class:"text-caption text-grey"},Be={key:0},Me={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},qe={class:"text-caption text-grey"},Le={key:0},He={key:0},je={key:1},Ge={key:1};function We(t,e,f,h,s,d){const v=i("v-btn"),k=i("v-select"),P=i("v-col"),V=i("v-text-field"),E=i("v-row"),S=i("v-card-text"),_=i("v-card"),z=i("v-card-title"),U=i("v-icon"),g=i("v-skeleton-loader"),R=i("v-img"),F=i("v-avatar"),T=i("v-chip"),O=i("v-table"),A=i("PaginationControls"),w=i("UserDialog"),N=i("UserProfileDialog");return u(),p("div",null,[a("div",we,[e[10]||(e[10]=a("h1",{class:"text-h4 page-title"},"User Management",-1)),o(v,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>d.openDialog(null)),class:"add-button"},{default:r(()=>e[9]||(e[9]=[m(" Add New User ")])),_:1,__:[9]})]),o(_,{class:"mb-4"},{default:r(()=>[o(S,null,{default:r(()=>[o(E,null,{default:r(()=>[o(P,{cols:"12",md:"4"},{default:r(()=>[o(k,{modelValue:s.roleFilter,"onUpdate:modelValue":[e[1]||(e[1]=l=>s.roleFilter=l),d.loadUsers],items:s.roleOptions,label:"Filter by Role",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(P,{cols:"12",md:"8"},{default:r(()=>[o(V,{modelValue:t.search,"onUpdate:modelValue":e[2]||(e[2]=l=>t.search=l),label:"Search by name, email, phone, city, or country","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:d.loadUsers},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(_,null,{default:r(()=>[o(z,{class:"d-flex justify-space-between align-center"},{default:r(()=>[e[12]||(e[12]=a("span",null,"Users",-1)),a("span",be,[e[11]||(e[11]=m(" Total Records: ")),a("strong",null,c(s.pagination.total||0),1)])]),_:1,__:[12]}),o(S,null,{default:r(()=>[o(O,null,{default:r(()=>[a("thead",null,[a("tr",null,[a("th",{class:"sortable",onClick:e[3]||(e[3]=l=>d.onSort("name"))},[a("div",Pe,[e[14]||(e[14]=a("span",null,"Name",-1)),t.sortBy==="name"?(u(),y(U,{key:0,size:"18",class:"sort-icon active"},{default:r(()=>[m(c(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(u(),y(U,{key:1,size:"18",class:"sort-icon inactive"},{default:r(()=>e[13]||(e[13]=[m(" mdi-unfold-more-horizontal ")])),_:1,__:[13]}))])]),a("th",{class:"sortable",onClick:e[4]||(e[4]=l=>d.onSort("email"))},[a("div",Ue,[e[16]||(e[16]=a("span",null,"Email",-1)),t.sortBy==="email"?(u(),y(U,{key:0,size:"18",class:"sort-icon active"},{default:r(()=>[m(c(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(u(),y(U,{key:1,size:"18",class:"sort-icon inactive"},{default:r(()=>e[15]||(e[15]=[m(" mdi-unfold-more-horizontal ")])),_:1,__:[15]}))])]),e[19]||(e[19]=a("th",null,"Phone",-1)),e[20]||(e[20]=a("th",null,"Location",-1)),e[21]||(e[21]=a("th",null,"Role",-1)),a("th",{class:"sortable",onClick:e[5]||(e[5]=l=>d.onSort("created_at"))},[a("div",Ve,[e[18]||(e[18]=a("span",null,"Created",-1)),t.sortBy==="created_at"?(u(),y(U,{key:0,size:"18",class:"sort-icon active"},{default:r(()=>[m(c(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(u(),y(U,{key:1,size:"18",class:"sort-icon inactive"},{default:r(()=>e[17]||(e[17]=[m(" mdi-unfold-more-horizontal ")])),_:1,__:[17]}))])]),e[22]||(e[22]=a("th",null,"Actions",-1))])]),a("tbody",null,[t.loading?(u(),p(D,{key:0},B(5,l=>a("tr",{key:`skeleton-${l}`},[a("td",null,[a("div",xe,[o(g,{type:"avatar",width:"32",height:"32"}),o(g,{type:"text",width:"150"})])]),a("td",null,[o(g,{type:"text",width:"200"})]),a("td",null,[o(g,{type:"text",width:"120"})]),a("td",null,[o(g,{type:"text",width:"150"})]),a("td",null,[a("div",ke,[o(g,{type:"chip",width:"80",height:"24",class:"mr-1"}),o(g,{type:"chip",width:"70",height:"24"})])]),a("td",null,[o(g,{type:"text",width:"120"})]),a("td",null,[a("div",Ce,[o(g,{type:"button",width:"32",height:"32",class:"mr-1"}),o(g,{type:"button",width:"32",height:"32"})])])])),64)):(u(),p(D,{key:1},[(u(!0),p(D,null,B(s.users,l=>(u(),p("tr",{key:l.id},[a("td",null,[a("div",Ee,[o(F,{size:"32",color:"primary"},{default:r(()=>[l.avatar?(u(),y(R,{key:0,src:l.avatar,alt:l.name},null,8,["src","alt"])):(u(),p("span",Ae,c(l.name.charAt(0).toUpperCase()),1))]),_:2},1024),m(" "+c(l.name),1)])]),a("td",null,c(l.email),1),a("td",null,[l.phone?(u(),p("span",Se,[o(U,{size:"small",class:"mr-1"},{default:r(()=>e[23]||(e[23]=[m("mdi-phone")])),_:1,__:[23]}),m(" "+c(l.phone),1)])):(u(),p("span",ze,"-"))]),a("td",null,[l.city||l.country?(u(),p("div",De,[l.city?(u(),p("span",Ie,c(l.city),1)):b("",!0),l.country?(u(),p("span",Re,c(l.country),1)):b("",!0),!l.city&&!l.country?(u(),p("span",Fe,"-")):b("",!0)])):(u(),p("span",Te,"-"))]),a("td",null,[l.roles&&l.roles.length>0?(u(),p("div",Oe,[(u(!0),p(D,null,B(l.roles,x=>(u(),y(T,{key:x.id,color:d.getRoleColor(x.slug),size:"small"},{default:r(()=>[m(c(x.name),1)]),_:2},1032,["color"]))),128))])):(u(),p("span",Ne,"No roles"))]),a("td",null,c(t.formatDate(l.created_at)),1),a("td",null,[o(v,{size:"small",icon:"mdi-eye",onClick:x=>d.viewUserProfile(l),variant:"text",color:"info",title:"View Profile"},null,8,["onClick"]),o(v,{size:"small",icon:"mdi-pencil",onClick:x=>d.openDialog(l),variant:"text",title:"Edit User"},null,8,["onClick"]),o(v,{size:"small",icon:"mdi-delete",onClick:x=>d.deleteUser(l),variant:"text",color:"error",disabled:l.id===s.currentUserId,title:"Delete User"},null,8,["onClick","disabled"])])]))),128)),s.users.length===0?(u(),p("tr",Be,e[24]||(e[24]=[a("td",{colspan:"7",class:"text-center py-4"},"No users found",-1)]))):b("",!0)],64))])]),_:1}),a("div",Me,[a("div",qe,[s.users.length>0&&s.pagination.total>0?(u(),p("span",Le,[s.perPage==="all"?(u(),p("span",He,[e[25]||(e[25]=m(" Showing ")),a("strong",null,"all "+c(s.pagination.total.toLocaleString()),1),e[26]||(e[26]=m(" records "))])):(u(),p("span",je,[e[27]||(e[27]=m(" Showing ")),a("strong",null,c((s.currentPage-1)*s.perPage+1),1),e[28]||(e[28]=m(" to ")),a("strong",null,c(Math.min(s.currentPage*s.perPage,s.pagination.total)),1),e[29]||(e[29]=m(" of ")),a("strong",null,c(s.pagination.total.toLocaleString()),1),e[30]||(e[30]=m(" records "))]))])):(u(),p("span",Ge,"No records found"))]),o(A,{modelValue:s.currentPage,"onUpdate:modelValue":e[6]||(e[6]=l=>s.currentPage=l),pagination:s.pagination,"per-page-value":s.perPage,"per-page-options":s.perPageOptions,"onUpdate:perPage":d.onPerPageUpdate,onPageChange:d.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),o(w,{modelValue:s.dialog,"onUpdate:modelValue":e[7]||(e[7]=l=>s.dialog=l),user:s.editingUser,roles:s.roles,onSave:d.onUserSaved},null,8,["modelValue","user","roles","onSave"]),o(N,{modelValue:s.profileDialogVisible,"onUpdate:modelValue":e[8]||(e[8]=l=>s.profileDialogVisible=l),user:s.selectedUser},null,8,["modelValue","user"])])}const et=L(ye,[["render",We],["__scopeId","data-v-eb4e5b21"]]);export{et as default};
