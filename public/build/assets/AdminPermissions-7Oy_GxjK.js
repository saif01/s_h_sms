import{c as N}from"./commonMixin-BwIVv23E.js";import{P as Q,p as V,d as F}from"./PaginationControls-6l2F_IVt.js";import{_ as M,d as v,w as l,a as o,r as m,f as r,t as u,g as j,l as H,o as a,c as g,b as s,e as B,F as w,h as k,p as R}from"./app-CHfYI-xI.js";const K={name:"PermissionDialog",mixins:[N],props:{modelValue:{type:Boolean,required:!0},permission:{type:Object,default:null},groups:{type:Array,default:()=>[]}},emits:["update:modelValue","save","error"],data(){return{form:{name:"",slug:"",group:"",description:""},newGroup:"",rules:{required:t=>!!t||"This field is required"}}},computed:{editingPermission(){return!!this.permission}},watch:{permission:{handler(t){t?this.form={name:t.name||"",slug:t.slug||"",group:t.group||"",description:t.description||""}:this.resetForm()},immediate:!0},modelValue(t){t||this.resetForm()}},methods:{resetForm(){this.form={name:"",slug:"",group:"",description:""},this.newGroup="",this.$refs.permissionForm&&this.$refs.permissionForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){if(this.newGroup&&!this.groups.find(t=>t.name===this.newGroup||typeof t=="string"&&t===this.newGroup)){const t=this.newGroup.trim();this.$emit("add-group",t),this.form.group=t,this.newGroup=""}},close(){this.$emit("update:modelValue",!1)},async onSave(){if(!this.$refs.permissionForm){this.showError("Form reference not found");return}if(this.$refs.permissionForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const t=this.editingPermission?`/api/v1/permissions/${this.permission.id}`:"/api/v1/permissions",e=this.editingPermission?"put":"post",c={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await this.$axios[e](t,c,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.$emit("save",c),this.close()}catch(t){this.handleApiError(t,"Error saving permission"),this.$emit("error",t)}finally{this.saving=!1}}}}};function T(t,e,c,E,i,d){const P=m("v-card-title"),C=m("v-text-field"),z=m("v-list-item"),U=m("v-select"),A=m("v-textarea"),G=m("v-form"),x=m("v-card-text"),f=m("v-spacer"),S=m("v-btn"),y=m("v-card-actions"),D=m("v-card"),h=m("v-dialog");return a(),v(h,{"model-value":c.modelValue,"onUpdate:modelValue":e[5]||(e[5]=p=>t.$emit("update:modelValue",p)),"max-width":"600",persistent:""},{default:l(()=>[o(D,null,{default:l(()=>[o(P,null,{default:l(()=>[r(u(d.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),o(x,null,{default:l(()=>[o(G,{ref:"permissionForm",onSubmit:j(d.onSave,["prevent"])},{default:l(()=>[o(C,{modelValue:i.form.name,"onUpdate:modelValue":e[0]||(e[0]=p=>i.form.name=p),label:"Permission Name",rules:[i.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",onBlur:d.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),o(C,{modelValue:i.form.slug,"onUpdate:modelValue":e[1]||(e[1]=p=>i.form.slug=p),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),o(U,{modelValue:i.form.group,"onUpdate:modelValue":e[3]||(e[3]=p=>i.form.group=p),items:c.groups,"item-title":p=>typeof p=="string"?p:p.name,"item-value":p=>typeof p=="string"?p:p.name,label:"Group",rules:[i.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4"},{"append-item":l(()=>[o(z,null,{default:l(()=>[o(C,{modelValue:i.newGroup,"onUpdate:modelValue":e[2]||(e[2]=p=>i.newGroup=p),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",onKeyup:H(d.addNewGroup,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["modelValue","items","item-title","item-value","rules"]),o(A,{modelValue:i.form.description,"onUpdate:modelValue":e[4]||(e[4]=p=>i.form.description=p),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(y,null,{default:l(()=>[o(f),o(S,{onClick:d.close,variant:"text"},{default:l(()=>e[6]||(e[6]=[r("Cancel")])),_:1,__:[6]},8,["onClick"]),o(S,{onClick:d.onSave,color:"primary",loading:t.saving},{default:l(()=>[r(u(d.editingPermission?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const I=M(K,[["render",T]]),J={components:{PaginationControls:Q,PermissionDialog:I},mixins:[N],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null,currentPage:F.currentPage,perPage:F.perPage,perPageOptions:F.perPageOptions,pagination:{...F.pagination}}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const t={};if(this.searchQuery&&(t.search=this.searchQuery),this.selectedGroup&&(t.group=this.selectedGroup),this.viewMode==="grouped")t.grouped=!0;else{const c=this.buildPaginationParams();t.page=c.page,t.per_page=c.per_page,this.perPage==="all"&&(t.per_page=999999),this.sortBy&&(t.sort_by=this.sortBy,t.sort_direction=this.sortDirection)}const e=await this.$axios.get("/api/v1/permissions",{params:t,headers:this.getAuthHeaders()});this.viewMode==="grouped"?(this.groupedPermissions=e.data,this.permissions=[],Object.values(e.data).forEach(c=>{this.permissions.push(...c)}),V.updatePagination(this,{current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length})):(e.data.data?(this.permissions=e.data.data||[],this.updatePagination(e.data)):(this.permissions=e.data||[],V.updatePagination(this,{current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length})),this.groupedPermissions={},this.permissions.forEach(c=>{this.groupedPermissions[c.group]||(this.groupedPermissions[c.group]=[]),this.groupedPermissions[c.group].push(c)}))}catch(t){this.handleApiError(t,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const t=await this.$axios.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});t.data&&t.data.length>0?typeof t.data[0]=="string"?this.groups=t.data.map(e=>({name:e,permissions_count:0})):this.groups=t.data:this.groups=[]}catch(t){console.error("Error loading groups:",t),this.groups=[]}},openDialog(t){this.editingPermission=t||null,this.dialog=!0},async handlePermissionSave(){await this.loadGroups(),await this.loadPermissions()},handleAddGroup(t){this.groups.find(e=>e.name===t||typeof e=="string"&&e===t)||this.groups.push({name:t,permissions_count:0})},async deletePermission(t){if((t.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${t.name}"?`))try{await this.$axios.delete(`/api/v1/permissions/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(t){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[t]||"grey"},buildPaginationParams(t={}){return V.buildPaginationParams(this.currentPage,this.perPage,t,this.sortBy,this.sortDirection)},updatePagination(t){V.updatePagination(this,t)},resetPagination(){V.resetPagination(this)},onPerPageChange(){this.resetPagination(),this.loadPermissions()},onPerPageUpdate(t){this.perPage=t,this.onPerPageChange()},onPageChange(t){this.currentPage=t,this.loadPermissions()},onSort(t){this.handleSort(t),this.currentPage=1,this.loadPermissions()},filterByGroup(t){this.selectedGroup===t?this.clearGroupFilter():(this.selectedGroup=t,this.resetPagination(),this.loadPermissions())},clearGroupFilter(){this.selectedGroup=null,this.resetPagination(),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},W={class:"page-header"},X={class:"d-flex align-center flex-wrap",style:{gap:"8px"}},Y={class:"text-caption text-grey"},Z={key:0},$={class:"text-h6 mb-3"},ee={class:"sortable-header"},te={class:"sortable-header"},se={class:"d-flex"},oe={class:"font-weight-medium"},ie={class:"text-caption text-grey"},ne={class:"sortable-header"},le={class:"sortable-header"},re={class:"sortable-header"},ae={class:"d-flex"},de={class:"font-weight-medium"},ue={class:"text-caption text-grey"},me={key:0},pe={key:2,class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},ge={class:"text-caption text-grey"},ce={key:0},he={key:0},fe={key:1},ve={key:1};function _e(t,e,c,E,i,d){const P=m("v-btn"),C=m("v-select"),z=m("v-col"),U=m("v-text-field"),A=m("v-row"),G=m("v-card-text"),x=m("v-card"),f=m("v-icon"),S=m("v-btn-toggle"),y=m("v-chip"),D=m("v-card-title"),h=m("v-skeleton-loader"),p=m("v-table"),q=m("PaginationControls"),L=m("PermissionDialog");return a(),g("div",null,[s("div",W,[e[12]||(e[12]=s("h1",{class:"text-h4 page-title"},"Permission Management",-1)),o(P,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=n=>d.openDialog(null)),class:"add-button"},{default:l(()=>e[11]||(e[11]=[r(" Add New Permission ")])),_:1,__:[11]})]),o(x,{class:"mb-4"},{default:l(()=>[o(G,null,{default:l(()=>[o(A,null,{default:l(()=>[o(z,{cols:"12",md:"6"},{default:l(()=>[o(C,{modelValue:i.selectedGroup,"onUpdate:modelValue":[e[1]||(e[1]=n=>i.selectedGroup=n),d.loadPermissions],items:i.groups,"item-title":n=>typeof n=="string"?n:n.name,"item-value":n=>typeof n=="string"?n:n.name,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","item-title","item-value","onUpdate:modelValue"])]),_:1}),o(z,{cols:"12",md:"6"},{default:l(()=>[o(U,{modelValue:i.searchQuery,"onUpdate:modelValue":[e[2]||(e[2]=n=>i.searchQuery=n),d.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(x,{class:"mb-4"},{default:l(()=>[o(G,{class:"py-3"},{default:l(()=>[s("div",X,[o(S,{modelValue:i.viewMode,"onUpdate:modelValue":e[3]||(e[3]=n=>i.viewMode=n),mandatory:"",density:"compact",class:"mr-4"},{default:l(()=>[o(P,{value:"flat",size:"small"},{default:l(()=>[o(f,{start:""},{default:l(()=>e[13]||(e[13]=[r("mdi-format-list-bulleted")])),_:1,__:[13]}),e[14]||(e[14]=r(" Flat View "))]),_:1,__:[14]}),o(P,{value:"grouped",size:"small"},{default:l(()=>[o(f,{start:""},{default:l(()=>e[15]||(e[15]=[r("mdi-folder")])),_:1,__:[15]}),e[16]||(e[16]=r(" Grouped View "))]),_:1,__:[16]})]),_:1},8,["modelValue"]),e[18]||(e[18]=s("span",{class:"text-caption text-grey mr-2"},"Filter by Group:",-1)),(a(!0),g(w,null,k(i.groups,n=>(a(),v(y,{key:n.name,color:d.getGroupColor(n.name),size:"small",variant:i.selectedGroup===n.name?"flat":"outlined",class:R([{"font-weight-bold":i.selectedGroup===n.name},"group-filter-chip"]),onClick:b=>d.filterByGroup(n.name),style:{cursor:"pointer"}},{default:l(()=>[r(u(n.name)+" ",1),o(y,{size:"x-small",color:i.selectedGroup===n.name?"white":d.getGroupColor(n.name),variant:"flat",class:"ml-2"},{default:l(()=>[r(u(n.permissions_count||0),1)]),_:2},1032,["color"])]),_:2},1032,["color","variant","class","onClick"]))),128)),i.selectedGroup?(a(),v(y,{key:0,size:"small",color:"grey",variant:"text","prepend-icon":"mdi-close",onClick:d.clearGroupFilter,style:{cursor:"pointer"},class:"ml-2"},{default:l(()=>e[17]||(e[17]=[r(" Clear Filter ")])),_:1,__:[17]},8,["onClick"])):B("",!0)])]),_:1})]),_:1}),o(x,null,{default:l(()=>[o(D,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[20]||(e[20]=s("span",null,"Permissions",-1)),s("span",Y,[e[19]||(e[19]=r(" Total Records: ")),s("strong",null,u(i.pagination.total||0),1)])]),_:1,__:[20]}),o(G,null,{default:l(()=>[i.viewMode==="grouped"?(a(),g("div",Z,[(a(!0),g(w,null,k(i.groupedPermissions,(n,b)=>(a(),g("div",{key:b,class:"mb-6"},[s("h3",$,[r(u(b.charAt(0).toUpperCase()+b.slice(1))+" ",1),o(y,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:l(()=>[r(u(n.length)+" permission"+u(n.length!==1?"s":""),1)]),_:2},1024)]),o(p,null,{default:l(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[4]||(e[4]=_=>d.onSort("name"))},[s("div",ee,[e[22]||(e[22]=s("span",null,"Name",-1)),t.sortBy==="name"?(a(),v(f,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(f,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[21]||(e[21]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),s("th",{class:"sortable",onClick:e[5]||(e[5]=_=>d.onSort("slug"))},[s("div",te,[e[24]||(e[24]=s("span",null,"Slug",-1)),t.sortBy==="slug"?(a(),v(f,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(f,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[23]||(e[23]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),e[25]||(e[25]=s("th",null,"Description",-1)),e[26]||(e[26]=s("th",null,"Roles",-1)),e[27]||(e[27]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(a(),g(w,{key:0},k(5,_=>s("tr",{key:`skeleton-grouped-${_}`},[s("td",null,[o(h,{type:"text",width:"150"})]),s("td",null,[o(h,{type:"chip",width:"120",height:"24"})]),s("td",null,[o(h,{type:"text",width:"200"})]),s("td",null,[o(h,{type:"chip",width:"60",height:"24"})]),s("td",null,[s("div",se,[o(h,{type:"button",width:"32",height:"32",class:"mr-1"}),o(h,{type:"button",width:"32",height:"32"})])])])),64)):(a(!0),g(w,{key:1},k(n,_=>(a(),g("tr",{key:_.id},[s("td",null,[s("div",oe,u(_.name),1)]),s("td",null,[o(y,{size:"small",variant:"outlined"},{default:l(()=>[r(u(_.slug),1)]),_:2},1024)]),s("td",null,[s("span",ie,u(_.description||"No description"),1)]),s("td",null,[o(y,{size:"small",color:"info",variant:"text"},{default:l(()=>[r(u(_.roles_count||0)+" role"+u((_.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),s("td",null,[o(P,{size:"small",icon:"mdi-pencil",onClick:O=>d.openDialog(_),variant:"text"},null,8,["onClick"]),o(P,{size:"small",icon:"mdi-delete",onClick:O=>d.deletePermission(_),variant:"text",color:"error",disabled:(_.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(a(),v(p,{key:1},{default:l(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[6]||(e[6]=n=>d.onSort("name"))},[s("div",ne,[e[29]||(e[29]=s("span",null,"Name",-1)),t.sortBy==="name"?(a(),v(f,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(f,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[28]||(e[28]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[28]}))])]),s("th",{class:"sortable",onClick:e[7]||(e[7]=n=>d.onSort("slug"))},[s("div",le,[e[31]||(e[31]=s("span",null,"Slug",-1)),t.sortBy==="slug"?(a(),v(f,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(f,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[30]||(e[30]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[30]}))])]),s("th",{class:"sortable",onClick:e[8]||(e[8]=n=>d.onSort("group"))},[s("div",re,[e[33]||(e[33]=s("span",null,"Group",-1)),t.sortBy==="group"?(a(),v(f,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(u(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(f,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[32]||(e[32]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[32]}))])]),e[34]||(e[34]=s("th",null,"Description",-1)),e[35]||(e[35]=s("th",null,"Roles",-1)),e[36]||(e[36]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(a(),g(w,{key:0},k(5,n=>s("tr",{key:`skeleton-flat-${n}`},[s("td",null,[o(h,{type:"text",width:"150"})]),s("td",null,[o(h,{type:"chip",width:"120",height:"24"})]),s("td",null,[o(h,{type:"chip",width:"100",height:"24"})]),s("td",null,[o(h,{type:"text",width:"200"})]),s("td",null,[o(h,{type:"chip",width:"60",height:"24"})]),s("td",null,[s("div",ae,[o(h,{type:"button",width:"32",height:"32",class:"mr-1"}),o(h,{type:"button",width:"32",height:"32"})])])])),64)):(a(),g(w,{key:1},[(a(!0),g(w,null,k(i.permissions,n=>(a(),g("tr",{key:n.id},[s("td",null,[s("div",de,u(n.name),1)]),s("td",null,[o(y,{size:"small",variant:"outlined"},{default:l(()=>[r(u(n.slug),1)]),_:2},1024)]),s("td",null,[o(y,{size:"small",color:d.getGroupColor(n.group)},{default:l(()=>[r(u(n.group),1)]),_:2},1032,["color"])]),s("td",null,[s("span",ue,u(n.description||"No description"),1)]),s("td",null,[o(y,{size:"small",color:"info",variant:"text"},{default:l(()=>[r(u(n.roles_count||0)+" role"+u((n.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),s("td",null,[o(P,{size:"small",icon:"mdi-pencil",onClick:b=>d.openDialog(n),variant:"text"},null,8,["onClick"]),o(P,{size:"small",icon:"mdi-delete",onClick:b=>d.deletePermission(n),variant:"text",color:"error",disabled:(n.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),i.permissions.length===0?(a(),g("tr",me,e[37]||(e[37]=[s("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)]))):B("",!0)],64))])]),_:1})),i.viewMode==="flat"?(a(),g("div",pe,[s("div",ge,[i.permissions.length>0&&i.pagination.total>0?(a(),g("span",ce,[i.perPage==="all"?(a(),g("span",he,[e[38]||(e[38]=r(" Showing ")),s("strong",null,"all "+u(i.pagination.total.toLocaleString()),1),e[39]||(e[39]=r(" records "))])):(a(),g("span",fe,[e[40]||(e[40]=r(" Showing ")),s("strong",null,u((i.currentPage-1)*i.perPage+1),1),e[41]||(e[41]=r(" to ")),s("strong",null,u(Math.min(i.currentPage*i.perPage,i.pagination.total)),1),e[42]||(e[42]=r(" of ")),s("strong",null,u(i.pagination.total.toLocaleString()),1),e[43]||(e[43]=r(" records "))]))])):(a(),g("span",ve,"No records found"))]),o(q,{modelValue:i.currentPage,"onUpdate:modelValue":e[9]||(e[9]=n=>i.currentPage=n),pagination:i.pagination,"per-page-value":i.perPage,"per-page-options":i.perPageOptions,"onUpdate:perPage":d.onPerPageUpdate,onPageChange:d.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])):B("",!0)]),_:1})]),_:1}),o(L,{modelValue:i.dialog,"onUpdate:modelValue":e[10]||(e[10]=n=>i.dialog=n),permission:i.editingPermission,groups:i.groups,onSave:d.handlePermissionSave,onAddGroup:d.handleAddGroup},null,8,["modelValue","permission","groups","onSave","onAddGroup"])])}const be=M(J,[["render",_e]]);export{be as default};
