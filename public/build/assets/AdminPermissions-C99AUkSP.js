import{c as U}from"./commonMixin-LD1l2-5e.js";import{p as q,P as Q}from"./PaginationControls-CGFLaHsK.js";import{_ as B,d as v,w as l,a as o,r as u,f as r,t as d,g as j,E as H,o as a,c as g,b as s,e as D,F as P,y as k,z as R}from"./app-CYStQJ0f.js";const K={name:"PermissionDialog",mixins:[U],props:{modelValue:{type:Boolean,required:!0},permission:{type:Object,default:null},groups:{type:Array,default:()=>[]}},emits:["update:modelValue","save","error"],data(){return{form:{name:"",slug:"",group:"",description:""},newGroup:"",rules:{required:t=>!!t||"This field is required"}}},computed:{editingPermission(){return!!this.permission}},watch:{permission:{handler(t){t?this.form={name:t.name||"",slug:t.slug||"",group:t.group||"",description:t.description||""}:this.resetForm()},immediate:!0},modelValue(t){t||this.resetForm()}},methods:{resetForm(){this.form={name:"",slug:"",group:"",description:""},this.newGroup="",this.$refs.permissionForm&&this.$refs.permissionForm.resetValidation()},autoGenerateSlugFromName(){!this.form.slug&&this.form.name&&!this.editingPermission&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""))},addNewGroup(){if(this.newGroup&&!this.groups.find(t=>t.name===this.newGroup||typeof t=="string"&&t===this.newGroup)){const t=this.newGroup.trim();this.$emit("add-group",t),this.form.group=t,this.newGroup=""}},close(){this.$emit("update:modelValue",!1)},async onSave(){if(!this.$refs.permissionForm){this.showError("Form reference not found");return}if(this.$refs.permissionForm.validate()){!this.form.slug&&this.form.name&&(this.form.slug=this.form.name.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"")),this.saving=!0;try{const t=this.editingPermission?`/api/v1/permissions/${this.permission.id}`:"/api/v1/permissions",e=this.editingPermission?"put":"post",f={name:this.form.name.trim(),slug:this.form.slug?this.form.slug.trim():null,group:this.form.group.trim(),description:this.form.description?this.form.description.trim():null};await this.$axios[e](t,f,{headers:this.getAuthHeaders()}),this.showSuccess(this.editingPermission?"Permission updated successfully":"Permission created successfully"),this.$emit("save",f),this.close()}catch(t){this.handleApiError(t,"Error saving permission"),this.$emit("error",t)}finally{this.saving=!1}}}}};function O(t,e,f,N,n,m){const w=u("v-card-title"),G=u("v-text-field"),z=u("v-list-item"),x=u("v-select"),F=u("v-textarea"),V=u("v-form"),C=u("v-card-text"),h=u("v-spacer"),S=u("v-btn"),_=u("v-card-actions"),A=u("v-card"),c=u("v-dialog");return a(),v(c,{"model-value":f.modelValue,"onUpdate:modelValue":e[5]||(e[5]=p=>t.$emit("update:modelValue",p)),"max-width":"600",persistent:""},{default:l(()=>[o(A,null,{default:l(()=>[o(w,null,{default:l(()=>[r(d(m.editingPermission?"Edit Permission":"Add New Permission"),1)]),_:1}),o(C,null,{default:l(()=>[o(V,{ref:"permissionForm",onSubmit:j(m.onSave,["prevent"])},{default:l(()=>[o(G,{modelValue:n.form.name,"onUpdate:modelValue":e[0]||(e[0]=p=>n.form.name=p),label:"Permission Name",rules:[n.rules.required],required:"",hint:"Display name for the permission (e.g., 'Manage Pages')","persistent-hint":"",class:"mb-4",onBlur:m.autoGenerateSlugFromName},null,8,["modelValue","rules","onBlur"]),o(G,{modelValue:n.form.slug,"onUpdate:modelValue":e[1]||(e[1]=p=>n.form.slug=p),label:"Slug",hint:"URL-friendly identifier (auto-generated if empty)","persistent-hint":"",class:"mb-4"},null,8,["modelValue"]),o(x,{modelValue:n.form.group,"onUpdate:modelValue":e[3]||(e[3]=p=>n.form.group=p),items:f.groups,"item-title":p=>typeof p=="string"?p:p.name,"item-value":p=>typeof p=="string"?p:p.name,label:"Group",rules:[n.rules.required],required:"",hint:"Category/group for organizing permissions","persistent-hint":"",class:"mb-4"},{"append-item":l(()=>[o(z,null,{default:l(()=>[o(G,{modelValue:n.newGroup,"onUpdate:modelValue":e[2]||(e[2]=p=>n.newGroup=p),label:"Add New Group","prepend-inner-icon":"mdi-plus",variant:"outlined",density:"compact",onKeyup:H(m.addNewGroup,["enter"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1},8,["modelValue","items","item-title","item-value","rules"]),o(F,{modelValue:n.form.description,"onUpdate:modelValue":e[4]||(e[4]=p=>n.form.description=p),label:"Description",hint:"Brief description of what this permission allows","persistent-hint":"",rows:"2",class:"mb-4"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),o(_,null,{default:l(()=>[o(h),o(S,{onClick:m.close,variant:"text"},{default:l(()=>e[6]||(e[6]=[r("Cancel")])),_:1,__:[6]},8,["onClick"]),o(S,{onClick:m.onSave,color:"primary",loading:t.saving},{default:l(()=>[r(d(m.editingPermission?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const T=B(K,[["render",O]]),I={components:{PaginationControls:Q,PermissionDialog:T},mixins:[U,q],data(){return{permissions:[],groupedPermissions:{},groups:[],dialog:!1,editingPermission:null,viewMode:"flat",searchQuery:"",selectedGroup:null}},async mounted(){await this.loadGroups(),await this.loadPermissions()},methods:{async loadPermissions(){try{this.loading=!0;const t={};if(this.searchQuery&&(t.search=this.searchQuery),this.selectedGroup&&(t.group=this.selectedGroup),this.viewMode==="grouped")t.grouped=!0;else{const f=this.buildPaginationParams();t.page=f.page,t.per_page=f.per_page,this.perPage==="all"&&(t.per_page=999999),this.sortBy&&(t.sort_by=this.sortBy,t.sort_direction=this.sortDirection)}const e=await this.$axios.get("/api/v1/permissions",{params:t,headers:this.getAuthHeaders()});this.viewMode==="grouped"?(this.groupedPermissions=e.data,this.permissions=[],Object.values(e.data).forEach(f=>{this.permissions.push(...f)}),this.updatePagination({current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length})):(e.data.data?(this.permissions=e.data.data||[],this.updatePagination(e.data)):(this.permissions=e.data||[],this.updatePagination({current_page:1,last_page:1,per_page:this.permissions.length,total:this.permissions.length})),this.groupedPermissions={},this.permissions.forEach(f=>{this.groupedPermissions[f.group]||(this.groupedPermissions[f.group]=[]),this.groupedPermissions[f.group].push(f)}))}catch(t){this.handleApiError(t,"Failed to load permissions")}finally{this.loading=!1}},async loadGroups(){try{const t=await this.$axios.get("/api/v1/permissions/groups",{headers:this.getAuthHeaders()});t.data&&t.data.length>0?typeof t.data[0]=="string"?this.groups=t.data.map(e=>({name:e,permissions_count:0})):this.groups=t.data:this.groups=[]}catch(t){console.error("Error loading groups:",t),this.groups=[]}},openDialog(t){this.editingPermission=t||null,this.dialog=!0},async handlePermissionSave(){await this.loadGroups(),await this.loadPermissions()},handleAddGroup(t){this.groups.find(e=>e.name===t||typeof e=="string"&&e===t)||this.groups.push({name:t,permissions_count:0})},async deletePermission(t){if((t.roles_count||0)>0){this.showError("Cannot delete permission that is assigned to roles. Please remove it from all roles first.");return}if(confirm(`Are you sure you want to delete the permission "${t.name}"?`))try{await this.$axios.delete(`/api/v1/permissions/${t.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Permission deleted successfully"),await this.loadPermissions()}catch(e){this.handleApiError(e,"Error deleting permission")}},getGroupColor(t){return{general:"primary",content:"success",users:"info",leads:"warning",careers:"purple",settings:"orange",system:"error"}[t]||"grey"},filterByGroup(t){this.selectedGroup===t?this.clearGroupFilter():(this.selectedGroup=t,this.resetPagination(),this.loadPermissions())},clearGroupFilter(){this.selectedGroup=null,this.resetPagination(),this.loadPermissions()}},watch:{viewMode(){this.currentPage=1,this.loadPermissions()}}},J={class:"page-header"},W={class:"d-flex align-center flex-wrap",style:{gap:"8px"}},X={class:"text-caption text-grey"},Y={key:0},Z={class:"text-h6 mb-3"},$={class:"sortable-header"},ee={class:"sortable-header"},te={class:"d-flex"},se={class:"font-weight-medium"},oe={class:"text-caption text-grey"},ie={class:"sortable-header"},le={class:"sortable-header"},ne={class:"sortable-header"},re={class:"d-flex"},ae={class:"font-weight-medium"},de={class:"text-caption text-grey"},ue={key:0},me={key:2,class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},pe={class:"text-caption text-grey"},ge={key:0},fe={key:0},ce={key:1},he={key:1};function ve(t,e,f,N,n,m){const w=u("v-btn"),G=u("v-select"),z=u("v-col"),x=u("v-text-field"),F=u("v-row"),V=u("v-card-text"),C=u("v-card"),h=u("v-icon"),S=u("v-btn-toggle"),_=u("v-chip"),A=u("v-card-title"),c=u("v-skeleton-loader"),p=u("v-table"),M=u("PaginationControls"),E=u("PermissionDialog");return a(),g("div",null,[s("div",J,[e[12]||(e[12]=s("h1",{class:"text-h4 page-title"},"Permission Management",-1)),o(w,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=i=>m.openDialog(null)),class:"add-button"},{default:l(()=>e[11]||(e[11]=[r(" Add New Permission ")])),_:1,__:[11]})]),o(C,{class:"mb-4"},{default:l(()=>[o(V,null,{default:l(()=>[o(F,null,{default:l(()=>[o(z,{cols:"12",md:"6"},{default:l(()=>[o(G,{modelValue:n.selectedGroup,"onUpdate:modelValue":[e[1]||(e[1]=i=>n.selectedGroup=i),m.loadPermissions],items:n.groups,"item-title":i=>typeof i=="string"?i:i.name,"item-value":i=>typeof i=="string"?i:i.name,label:"Filter by Group","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","item-title","item-value","onUpdate:modelValue"])]),_:1}),o(z,{cols:"12",md:"6"},{default:l(()=>[o(x,{modelValue:n.searchQuery,"onUpdate:modelValue":[e[2]||(e[2]=i=>n.searchQuery=i),m.loadPermissions],label:"Search permissions","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),o(C,{class:"mb-4"},{default:l(()=>[o(V,{class:"py-3"},{default:l(()=>[s("div",W,[o(S,{modelValue:n.viewMode,"onUpdate:modelValue":e[3]||(e[3]=i=>n.viewMode=i),mandatory:"",density:"compact",class:"mr-4"},{default:l(()=>[o(w,{value:"flat",size:"small"},{default:l(()=>[o(h,{start:""},{default:l(()=>e[13]||(e[13]=[r("mdi-format-list-bulleted")])),_:1,__:[13]}),e[14]||(e[14]=r(" Flat View "))]),_:1,__:[14]}),o(w,{value:"grouped",size:"small"},{default:l(()=>[o(h,{start:""},{default:l(()=>e[15]||(e[15]=[r("mdi-folder")])),_:1,__:[15]}),e[16]||(e[16]=r(" Grouped View "))]),_:1,__:[16]})]),_:1},8,["modelValue"]),e[18]||(e[18]=s("span",{class:"text-caption text-grey mr-2"},"Filter by Group:",-1)),(a(!0),g(P,null,k(n.groups,i=>(a(),v(_,{key:i.name,color:m.getGroupColor(i.name),size:"small",variant:n.selectedGroup===i.name?"flat":"outlined",class:R([{"font-weight-bold":n.selectedGroup===i.name},"group-filter-chip"]),onClick:b=>m.filterByGroup(i.name),style:{cursor:"pointer"}},{default:l(()=>[r(d(i.name)+" ",1),o(_,{size:"x-small",color:n.selectedGroup===i.name?"white":m.getGroupColor(i.name),variant:"flat",class:"ml-2"},{default:l(()=>[r(d(i.permissions_count||0),1)]),_:2},1032,["color"])]),_:2},1032,["color","variant","class","onClick"]))),128)),n.selectedGroup?(a(),v(_,{key:0,size:"small",color:"grey",variant:"text","prepend-icon":"mdi-close",onClick:m.clearGroupFilter,style:{cursor:"pointer"},class:"ml-2"},{default:l(()=>e[17]||(e[17]=[r(" Clear Filter ")])),_:1,__:[17]},8,["onClick"])):D("",!0)])]),_:1})]),_:1}),o(C,null,{default:l(()=>[o(A,{class:"d-flex justify-space-between align-center"},{default:l(()=>[e[20]||(e[20]=s("span",null,"Permissions",-1)),s("span",X,[e[19]||(e[19]=r(" Total Records: ")),s("strong",null,d((t.pagination.total||0).toLocaleString()),1)])]),_:1,__:[20]}),o(V,null,{default:l(()=>[n.viewMode==="grouped"?(a(),g("div",Y,[(a(!0),g(P,null,k(n.groupedPermissions,(i,b)=>(a(),g("div",{key:b,class:"mb-6"},[s("h3",Z,[r(d(b.charAt(0).toUpperCase()+b.slice(1))+" ",1),o(_,{size:"small",color:"primary",variant:"text",class:"ml-2"},{default:l(()=>[r(d(i.length)+" permission"+d(i.length!==1?"s":""),1)]),_:2},1024)]),o(p,null,{default:l(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[4]||(e[4]=y=>t.onSort("name"))},[s("div",$,[e[22]||(e[22]=s("span",null,"Name",-1)),t.sortBy==="name"?(a(),v(h,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(d(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(h,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[21]||(e[21]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),s("th",{class:"sortable",onClick:e[5]||(e[5]=y=>t.onSort("slug"))},[s("div",ee,[e[24]||(e[24]=s("span",null,"Slug",-1)),t.sortBy==="slug"?(a(),v(h,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(d(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(h,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[23]||(e[23]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),e[25]||(e[25]=s("th",null,"Description",-1)),e[26]||(e[26]=s("th",null,"Roles",-1)),e[27]||(e[27]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(a(),g(P,{key:0},k(5,y=>s("tr",{key:`skeleton-grouped-${y}`},[s("td",null,[o(c,{type:"text",width:"150"})]),s("td",null,[o(c,{type:"chip",width:"120",height:"24"})]),s("td",null,[o(c,{type:"text",width:"200"})]),s("td",null,[o(c,{type:"chip",width:"60",height:"24"})]),s("td",null,[s("div",te,[o(c,{type:"button",width:"32",height:"32",class:"mr-1"}),o(c,{type:"button",width:"32",height:"32"})])])])),64)):(a(!0),g(P,{key:1},k(i,y=>(a(),g("tr",{key:y.id},[s("td",null,[s("div",se,d(y.name),1)]),s("td",null,[o(_,{size:"small",variant:"outlined"},{default:l(()=>[r(d(y.slug),1)]),_:2},1024)]),s("td",null,[s("span",oe,d(y.description||"No description"),1)]),s("td",null,[o(_,{size:"small",color:"info",variant:"text"},{default:l(()=>[r(d(y.roles_count||0)+" role"+d((y.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),s("td",null,[o(w,{size:"small",icon:"mdi-pencil",onClick:L=>m.openDialog(y),variant:"text"},null,8,["onClick"]),o(w,{size:"small",icon:"mdi-delete",onClick:L=>m.deletePermission(y),variant:"text",color:"error",disabled:(y.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128))])]),_:2},1024)]))),128))])):(a(),v(p,{key:1},{default:l(()=>[s("thead",null,[s("tr",null,[s("th",{class:"sortable",onClick:e[6]||(e[6]=i=>t.onSort("name"))},[s("div",ie,[e[29]||(e[29]=s("span",null,"Name",-1)),t.sortBy==="name"?(a(),v(h,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(d(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(h,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[28]||(e[28]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[28]}))])]),s("th",{class:"sortable",onClick:e[7]||(e[7]=i=>t.onSort("slug"))},[s("div",le,[e[31]||(e[31]=s("span",null,"Slug",-1)),t.sortBy==="slug"?(a(),v(h,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(d(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(h,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[30]||(e[30]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[30]}))])]),s("th",{class:"sortable",onClick:e[8]||(e[8]=i=>t.onSort("group"))},[s("div",ne,[e[33]||(e[33]=s("span",null,"Group",-1)),t.sortBy==="group"?(a(),v(h,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[r(d(t.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(a(),v(h,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>e[32]||(e[32]=[r(" mdi-unfold-more-horizontal ")])),_:1,__:[32]}))])]),e[34]||(e[34]=s("th",null,"Description",-1)),e[35]||(e[35]=s("th",null,"Roles",-1)),e[36]||(e[36]=s("th",null,"Actions",-1))])]),s("tbody",null,[t.loading?(a(),g(P,{key:0},k(5,i=>s("tr",{key:`skeleton-flat-${i}`},[s("td",null,[o(c,{type:"text",width:"150"})]),s("td",null,[o(c,{type:"chip",width:"120",height:"24"})]),s("td",null,[o(c,{type:"chip",width:"100",height:"24"})]),s("td",null,[o(c,{type:"text",width:"200"})]),s("td",null,[o(c,{type:"chip",width:"60",height:"24"})]),s("td",null,[s("div",re,[o(c,{type:"button",width:"32",height:"32",class:"mr-1"}),o(c,{type:"button",width:"32",height:"32"})])])])),64)):(a(),g(P,{key:1},[(a(!0),g(P,null,k(n.permissions,i=>(a(),g("tr",{key:i.id},[s("td",null,[s("div",ae,d(i.name),1)]),s("td",null,[o(_,{size:"small",variant:"outlined"},{default:l(()=>[r(d(i.slug),1)]),_:2},1024)]),s("td",null,[o(_,{size:"small",color:m.getGroupColor(i.group)},{default:l(()=>[r(d(i.group),1)]),_:2},1032,["color"])]),s("td",null,[s("span",de,d(i.description||"No description"),1)]),s("td",null,[o(_,{size:"small",color:"info",variant:"text"},{default:l(()=>[r(d(i.roles_count||0)+" role"+d((i.roles_count||0)!==1?"s":""),1)]),_:2},1024)]),s("td",null,[o(w,{size:"small",icon:"mdi-pencil",onClick:b=>m.openDialog(i),variant:"text"},null,8,["onClick"]),o(w,{size:"small",icon:"mdi-delete",onClick:b=>m.deletePermission(i),variant:"text",color:"error",disabled:(i.roles_count||0)>0},null,8,["onClick","disabled"])])]))),128)),n.permissions.length===0?(a(),g("tr",ue,e[37]||(e[37]=[s("td",{colspan:"6",class:"text-center py-4"},"No permissions found",-1)]))):D("",!0)],64))])]),_:1})),n.viewMode==="flat"?(a(),g("div",me,[s("div",pe,[n.permissions.length>0&&t.pagination.total>0?(a(),g("span",ge,[t.perPage==="all"?(a(),g("span",fe,[e[38]||(e[38]=r(" Showing ")),s("strong",null,"all "+d(t.pagination.total.toLocaleString()),1),e[39]||(e[39]=r(" records "))])):(a(),g("span",ce,[e[40]||(e[40]=r(" Showing ")),s("strong",null,d((t.currentPage-1)*t.perPage+1),1),e[41]||(e[41]=r(" to ")),s("strong",null,d(Math.min(t.currentPage*t.perPage,t.pagination.total).toLocaleString()),1),e[42]||(e[42]=r(" of ")),s("strong",null,d(t.pagination.total.toLocaleString()),1),e[43]||(e[43]=r(" records "))]))])):(a(),g("span",he,"No records found"))]),o(M,{modelValue:t.currentPage,"onUpdate:modelValue":e[9]||(e[9]=i=>t.currentPage=i),pagination:t.pagination,"per-page-value":t.perPage,"per-page-options":t.perPageOptions,"onUpdate:perPage":t.onPerPageUpdate,onPageChange:t.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])):D("",!0)]),_:1})]),_:1}),o(E,{modelValue:n.dialog,"onUpdate:modelValue":e[10]||(e[10]=i=>n.dialog=i),permission:n.editingPermission,groups:n.groups,onSave:m.handlePermissionSave,onAddGroup:m.handleAddGroup},null,8,["modelValue","permission","groups","onSave","onAddGroup"])])}const Pe=B(I,[["render",ve]]);export{Pe as default};
