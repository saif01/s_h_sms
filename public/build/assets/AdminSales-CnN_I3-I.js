import{c as W}from"./commonMixin-BwIVv23E.js";import{_ as K,i as q,d as S,w as l,a as o,r as u,b as e,f as p,t as d,c as _,e as b,l as $,F as N,h as O,p as L,o as r}from"./app-CHfYI-xI.js";import{D as tt}from"./DatePickerVuetifyInput-D5jbgwcl.js";import{a as Q}from"./formatters-DzU97YYy.js";import{D as et}from"./DatePicker-D0g-fZ2A.js";import{P as st,p as Y}from"./PaginationControls-6l2F_IVt.js";const at={name:"SaleDialog",mixins:[W],components:{DatePickerVuetifyInput:tt},props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue","saved"],data(){return{form:this.getEmptyForm(),formValid:!1,cartItems:[],productSearch:"",searchResults:[],mostSoldProducts:[],customers:[],warehouses:[],saving:!1,paymentMethod:"cash",paymentMethods:[{title:"Cash",value:"cash"},{title:"Card",value:"card"},{title:"Mobile Banking",value:"mobile_banking"},{title:"Bank Transfer",value:"bank_transfer"},{title:"Cheque",value:"cheque"}],rules:{required:a=>!!a||"Required"},discountAmountManuallySet:!1}},computed:{isEdit(){return!!this.form.id},calculatedItemsDiscount(){return this.cartItems.reduce((a,t)=>a+(t.discount||0),0)},calculatedItemsTax(){return this.cartItems.reduce((a,t)=>a+(t.tax||0),0)},calculatedTotalTax(){return this.calculatedItemsTax}},watch:{sale:{immediate:!0,async handler(a){a&&a.id?await this.loadSaleForEdit(a.id):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1)}},modelValue(a){a?(this.fetchOptions(),this.fetchMostSoldProducts(),(!this.sale||!this.sale.id)&&(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1)):(this.form=this.getEmptyForm(),this.cartItems=[],this.discountAmountManuallySet=!1)}},methods:{getEmptyForm(){return{id:null,invoice_number:null,customer_id:null,warehouse_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,status:"draft",subtotal:0,tax_amount:0,discount_amount:0,shipping_cost:0,total_amount:0,paid_amount:0,balance_amount:0,notes:""}},async fetchOptions(){try{const[a,t]=await Promise.all([q.get("/api/v1/customers"),q.get("/api/v1/warehouses")]);this.customers=a.data.data||a.data.customers||[],this.warehouses=t.data.data||t.data.warehouses||[]}catch(a){console.error("Failed to load options",a)}},async fetchMostSoldProducts(){try{const{data:a}=await q.get("/api/v1/products",{params:{per_page:10,is_active:1,sort:"most_sold",order:"desc"}});let t=a.data||a.products||[];if(t.length===0){const{data:f}=await q.get("/api/v1/products",{params:{per_page:10,is_active:1,has_stock:1}});t=f.data||f.products||[]}this.mostSoldProducts=t.filter(f=>f.stock_quantity>0).slice(0,10)}catch(a){console.error("Failed to load most sold products",a)}},async searchProducts(){if(this.productSearch)try{const{data:a}=await q.get("/api/v1/products",{params:{search:this.productSearch,per_page:10}});this.searchResults=a.data||a.products||[]}catch(a){console.error("Failed to search products",a)}},addToCart(a){const t=this.cartItems.findIndex(f=>f.product_id===a.id);if(t>=0)this.cartItems[t].quantity++,this.updateCartItem(t);else{const f=parseFloat(a.tax_rate||0);this.cartItems.push({product_id:a.id,product_name:a.name,quantity:1,unit_price:parseFloat(a.sale_price),discount:0,tax_rate:f,tax:0,total:0,notes:""}),this.updateCartItem(this.cartItems.length-1)}if(!this.form.warehouse_id&&a.stock_by_warehouse&&a.stock_by_warehouse.length>0){const f=a.stock_by_warehouse.filter(x=>x.quantity>0).sort((x,s)=>(s.quantity||0)-(x.quantity||0))[0];f&&f.warehouse_id?this.form.warehouse_id=f.warehouse_id:a.stock_by_warehouse[0]&&a.stock_by_warehouse[0].warehouse_id&&(this.form.warehouse_id=a.stock_by_warehouse[0].warehouse_id)}this.productSearch="",this.searchResults=[],this.calculateTotals()},updateCartItem(a,t=!1){const f=this.cartItems[a];if(!f)return;const s=f.quantity*f.unit_price-(f.discount||0);if(t)s>0&&f.tax>0&&(f.tax_rate=parseFloat((f.tax/s*100).toFixed(2)));else{const i=parseFloat(f.tax_rate||0);f.tax=parseFloat((s*i/100).toFixed(2))}f.total=parseFloat((s+f.tax).toFixed(2)),this.calculateTotals()},removeFromCart(a){this.cartItems.splice(a,1),this.calculateTotals()},calculateTotals(){const a=this.cartItems.reduce((c,v)=>c+v.quantity*v.unit_price,0),t=this.cartItems.reduce((c,v)=>c+(v.discount||0),0),f=this.cartItems.reduce((c,v)=>c+(v.tax||0),0);this.form.subtotal=parseFloat(a.toFixed(2));const x=this.form.discount_amount>0||this.form.discount_amount===0&&t===0?parseFloat(this.form.discount_amount):t,s=f,i=a-x+s+(parseFloat(this.form.shipping_cost)||0);this.form.total_amount=parseFloat(i.toFixed(2)),this.calculateBalance()},calculateBalance(){this.form.balance_amount=parseFloat((this.form.total_amount-(this.form.paid_amount||0)).toFixed(2))},getStatusLabel(a){return{draft:"Draft",pending:"Pending",partial:"Partial",paid:"Paid",cancelled:"Cancelled"}[a]||a},async loadSaleForEdit(a){var t,f,x;if(a)try{const i=(await q.get(`/api/v1/sales/${a}`)).data;if(!i){this.showError("Sale not found");return}if(console.log("Loading sale for edit:",i),this.form={id:i.id,invoice_number:i.invoice_number||null,customer_id:i.customer_id,warehouse_id:i.warehouse_id,invoice_date:i.invoice_date?i.invoice_date.includes("T")?i.invoice_date.split("T")[0]:i.invoice_date:new Date().toISOString().split("T")[0],due_date:i.due_date?i.due_date.includes("T")?i.due_date.split("T")[0]:i.due_date:null,status:i.status||"draft",subtotal:parseFloat(i.subtotal||0),tax_amount:parseFloat(i.tax_amount||0),discount_amount:parseFloat(i.discount_amount||0),shipping_cost:parseFloat(i.shipping_cost||0),total_amount:parseFloat(i.total_amount||0),paid_amount:parseFloat(i.paid_amount||0),balance_amount:parseFloat(i.balance_amount||0),notes:i.notes||""},i.payments&&Array.isArray(i.payments)&&i.payments.length>0){const c=i.payments.find(v=>v.payment_method)||i.payments[0];c&&c.payment_method&&(this.paymentMethod=c.payment_method)}this.discountAmountManuallySet=!0,i.items&&Array.isArray(i.items)&&i.items.length>0?this.cartItems=i.items.map(c=>{var z,P;const v=(c.quantity||0)*(c.unit_price||0),y=parseFloat(c.discount||0),n=v-y;let D=0;((z=c.product)==null?void 0:z.tax_rate)!==void 0?D=parseFloat(c.product.tax_rate||0):n>0&&(D=parseFloat(c.tax||0)/n*100);const C=parseFloat((n*D/100).toFixed(2)),T=parseFloat((n+C).toFixed(2));return{product_id:c.product_id,product_name:((P=c.product)==null?void 0:P.name)||"Unknown",quantity:parseInt(c.quantity,10),unit_price:parseFloat(c.unit_price||0),discount:y,tax_rate:D,tax:C,total:T,notes:c.notes||""}}):this.cartItems=[],this.calculateTotals()}catch(s){console.error("Failed to load sale for edit:",s),console.error("Error response:",(t=s.response)==null?void 0:t.data),this.showError(((x=(f=s.response)==null?void 0:f.data)==null?void 0:x.message)||"Failed to load sale details")}},showSuccess(a){window.Toast?window.Toast.fire({icon:"success",title:a}):window.Swal?window.Swal.fire({icon:"success",title:a,timer:2e3,showConfirmButton:!1}):alert(a)},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)},async save(a=null){var t,f,x;if(this.cartItems.length===0){this.showError("Please add at least one product");return}if(this.$refs.formRef){const{valid:s}=await this.$refs.formRef.validate();if(!s){this.showError("Please fill in all required fields");return}}if(!this.form.customer_id){this.showError("Please select a customer");return}if(!this.form.warehouse_id){this.showError("Please select a warehouse");return}if(!this.form.invoice_date){this.showError("Please select an invoice date");return}this.saving=!0;try{const s=this.cartItems.reduce((n,D)=>n+(D.discount||0),0),i=this.cartItems.reduce((n,D)=>n+(D.tax||0),0),c={customer_id:Number(this.form.customer_id),warehouse_id:Number(this.form.warehouse_id),invoice_date:this.form.invoice_date,due_date:this.form.due_date||null,paid_amount:parseFloat(this.form.paid_amount)||0,shipping_cost:parseFloat(this.form.shipping_cost)||0,notes:this.form.notes||"",payment_method:this.paymentMethod||"cash",items:this.cartItems.map(n=>({product_id:Number(n.product_id),quantity:parseInt(n.quantity,10),unit_price:parseFloat(n.unit_price),discount:parseFloat(n.discount)||0,tax:parseFloat(n.tax)||0,notes:n.notes||""}))},v=parseFloat(this.form.discount_amount)||0;(v>0||this.discountAmountManuallySet||v===0&&s===0)&&(c.discount_amount=v),a&&typeof a=="string"?c.status=String(a):this.isEdit&&this.form.status&&(c.status=String(this.form.status)),console.log("Saving sale with payload:",JSON.stringify(c,null,2));let y;this.isEdit?(y=await q.put(`/api/v1/sales/${this.form.id}`,c),this.showSuccess(a==="draft"?"Sale draft updated successfully":"Sale updated successfully")):(y=await q.post("/api/v1/sales",c),this.showSuccess(a==="draft"?"Sale saved as draft successfully":"Sale created successfully")),console.log("Sale saved successfully:",y.data),this.$emit("saved"),this.close()}catch(s){console.error("Failed to save sale:",s),console.error("Error response:",(t=s.response)==null?void 0:t.data),console.error("Error status:",(f=s.response)==null?void 0:f.status);let i="Failed to save sale. Please check the console for details.";(x=s.response)!=null&&x.data?s.response.data.message?i=s.response.data.message:s.response.data.error?i=s.response.data.error:s.response.data.errors&&(i=Object.values(s.response.data.errors).flat().join(", ")):s.message&&(i=s.message),this.showError(i)}finally{this.saving=!1}},async saveAsDraft(){await this.save("draft")},close(){this.$emit("update:modelValue",!1),this.form=this.getEmptyForm(),this.cartItems=[],this.searchResults=[],this.discountAmountManuallySet=!1}}},ot={class:"d-flex align-center gap-2"},it={class:"text-h6 text-white font-weight-medium"},lt={key:0,class:"mt-3"},nt={class:"text-caption text-grey mb-2"},rt={class:"d-flex flex-wrap gap-2"},dt={class:"ml-1 text-caption"},ct={key:1,class:"search-results-container"},ut={class:"text-body-2 font-weight-medium"},mt={class:"text-body-2"},pt={class:"pa-1"},ht={class:"pa-1"},ft={class:"pa-1"},_t={class:"pa-1"},vt={class:"text-body-2 font-weight-bold text-end"},gt={class:"text-center"},xt={class:"mb-2"},yt={class:"mb-2"},bt={key:0,class:"mb-2"},wt={key:1,class:"mb-2"},St={class:"totals-section"},kt={class:"d-flex justify-space-between mb-1"},Dt={class:"text-body-2 font-weight-medium"},Ft={key:0,class:"d-flex justify-space-between mb-1"},Pt={class:"text-body-2 text-error"},Ct={class:"d-flex justify-space-between mb-1"},It={key:1,class:"d-flex justify-space-between mb-1"},Vt={class:"text-body-2 font-weight-medium"},Tt={class:"d-flex justify-space-between mb-2"},zt={class:"d-flex justify-space-between mb-2 total-amount"},Ut={class:"text-h6 font-weight-bold text-primary"},Et={class:"mb-2"},At={class:"mb-2"},Mt={key:2,class:"mb-2"};function qt(a,t,f,x,s,i){const c=u("v-icon"),v=u("v-btn"),y=u("v-card-title"),n=u("v-text-field"),D=u("v-chip"),C=u("v-img"),T=u("v-avatar"),z=u("v-list-item-title"),P=u("v-list-item-subtitle"),w=u("v-list-item"),F=u("v-list"),E=u("v-card-text"),I=u("v-card"),g=u("v-divider"),A=u("v-table"),M=u("v-alert"),h=u("v-col"),k=u("v-autocomplete"),V=u("v-select"),j=u("DatePickerVuetifyInput"),R=u("v-row"),G=u("v-textarea"),J=u("v-form"),X=u("v-card-actions"),Z=u("v-dialog");return r(),S(Z,{"model-value":f.modelValue,"onUpdate:modelValue":t[14]||(t[14]=m=>a.$emit("update:modelValue",m)),"max-width":"1400px",persistent:"",scrollable:""},{default:l(()=>[o(I,{class:"pos-dialog"},{default:l(()=>[o(y,{class:"pos-header d-flex justify-space-between align-center pa-3"},{default:l(()=>[e("div",ot,[o(c,{color:"white"},{default:l(()=>t[15]||(t[15]=[p("mdi-point-of-sale")])),_:1,__:[15]}),e("span",it,d(i.isEdit?"Edit Sale":"New Sale - POS"),1)]),o(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:i.close},null,8,["onClick"])]),_:1}),o(E,{class:"pa-3"},{default:l(()=>[o(J,{ref:"formRef",modelValue:s.formValid,"onUpdate:modelValue":t[13]||(t[13]=m=>s.formValid=m)},{default:l(()=>[o(R,{dense:"",class:"ma-0"},{default:l(()=>[o(h,{cols:"12",lg:"8",class:"pa-2"},{default:l(()=>[o(I,{variant:"flat",class:"mb-3 search-card",elevation:"1"},{default:l(()=>[o(E,{class:"pa-3"},{default:l(()=>[o(n,{modelValue:s.productSearch,"onUpdate:modelValue":t[0]||(t[0]=m=>s.productSearch=m),label:"Search Product (Name/SKU/Barcode)","prepend-inner-icon":"mdi-magnify",clearable:"",autofocus:"",variant:"outlined","hide-details":"auto",hint:"Type product name, SKU, or barcode and press Enter to search","persistent-hint":"",onKeyup:$(i.searchProducts,["enter"]),"onClick:clear":t[1]||(t[1]=m=>s.searchResults=[])},null,8,["modelValue","onKeyup"]),s.mostSoldProducts.length>0&&s.searchResults.length===0?(r(),_("div",lt,[e("div",nt,[o(c,{size:"14",class:"mr-1"},{default:l(()=>t[16]||(t[16]=[p("mdi-fire")])),_:1,__:[16]}),t[17]||(t[17]=p(" Most Sold Products "))]),e("div",rt,[(r(!0),_(N,null,O(s.mostSoldProducts,m=>(r(),S(D,{key:m.id,color:"primary",variant:"flat",size:"small",class:"product-chip",onClick:B=>i.addToCart(m),disabled:!m.stock_quantity||m.stock_quantity<=0},{default:l(()=>[o(c,{size:"14",class:"mr-1"},{default:l(()=>t[18]||(t[18]=[p("mdi-package-variant")])),_:1,__:[18]}),p(" "+d(m.name)+" ",1),e("span",dt,"(৳"+d(m.sale_price)+")",1)]),_:2},1032,["onClick","disabled"]))),128))])])):b("",!0),s.searchResults.length>0?(r(),_("div",ct,[o(F,{class:"search-results"},{default:l(()=>[(r(!0),_(N,null,O(s.searchResults,m=>(r(),S(w,{key:m.id,onClick:B=>i.addToCart(m),class:"search-item"},{prepend:l(()=>[o(T,{size:"40",color:"grey-lighten-4"},{default:l(()=>[m.image?(r(),S(C,{key:0,src:m.image},null,8,["src"])):(r(),S(c,{key:1},{default:l(()=>t[19]||(t[19]=[p("mdi-package-variant")])),_:1,__:[19]}))]),_:2},1024)]),append:l(()=>[o(D,{color:"primary",size:"small",variant:"flat"},{default:l(()=>[p("৳"+d(m.sale_price),1)]),_:2},1024)]),default:l(()=>[o(z,null,{default:l(()=>[p(d(m.name),1)]),_:2},1024),o(P,null,{default:l(()=>[p(" SKU: "+d(m.sku||"N/A")+" | Stock: "+d(m.stock_quantity||0),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})])):b("",!0)]),_:1})]),_:1}),o(I,{variant:"flat",class:"cart-card",elevation:"1"},{default:l(()=>[o(y,{class:"cart-header pa-2"},{default:l(()=>[o(c,{size:"18",class:"mr-1"},{default:l(()=>t[20]||(t[20]=[p("mdi-cart")])),_:1,__:[20]}),e("span",ut,"Cart Items ("+d(s.cartItems.length)+")",1)]),_:1}),o(g),o(E,{class:"pa-2"},{default:l(()=>[s.cartItems.length>0?(r(),S(A,{key:0,density:"compact",class:"cart-table"},{default:l(()=>[t[21]||(t[21]=e("thead",null,[e("tr",null,[e("th",{class:"text-caption"},"Product"),e("th",{class:"text-caption text-center",style:{width:"70px"}},"Qty"),e("th",{class:"text-caption text-end",style:{width:"90px"}},"Price"),e("th",{class:"text-caption text-end",style:{width:"80px"}},"Disc."),e("th",{class:"text-caption text-end",style:{width:"80px"}},"Tax"),e("th",{class:"text-caption text-end",style:{width:"100px"}},"Total"),e("th",{class:"text-caption",style:{width:"40px"}})])],-1)),e("tbody",null,[(r(!0),_(N,null,O(s.cartItems,(m,B)=>(r(),_("tr",{key:B,class:"cart-row"},[e("td",mt,d(m.product_name),1),e("td",pt,[o(n,{modelValue:m.quantity,"onUpdate:modelValue":[U=>m.quantity=U,U=>i.updateCartItem(B)],modelModifiers:{number:!0},type:"number",min:"1",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ht,[o(n,{modelValue:m.unit_price,"onUpdate:modelValue":[U=>m.unit_price=U,U=>i.updateCartItem(B)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",ft,[o(n,{modelValue:m.discount,"onUpdate:modelValue":[U=>m.discount=U,U=>i.updateCartItem(B)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",_t,[o(n,{modelValue:m.tax,"onUpdate:modelValue":[U=>m.tax=U,U=>i.updateCartItem(B,!0)],modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact","hide-details":"",variant:"outlined",class:"cart-input"},null,8,["modelValue","onUpdate:modelValue"])]),e("td",vt,"৳"+d(m.total.toFixed(2)),1),e("td",gt,[o(v,{icon:"mdi-delete",size:"x-small",variant:"text",color:"error",onClick:U=>i.removeFromCart(B)},null,8,["onClick"])])]))),128))])]),_:1,__:[21]})):(r(),S(M,{key:1,type:"info",variant:"tonal",density:"compact",class:"mt-2 mb-0"},{default:l(()=>t[22]||(t[22]=[e("span",{class:"text-caption"},"Cart is empty. Search and add products.",-1)])),_:1,__:[22]}))]),_:1})]),_:1})]),_:1}),o(h,{cols:"12",lg:"4",class:"pa-2"},{default:l(()=>[o(I,{variant:"flat",class:"details-card",elevation:"1"},{default:l(()=>[o(E,{class:"pa-2"},{default:l(()=>[e("div",xt,[o(k,{modelValue:s.form.customer_id,"onUpdate:modelValue":t[2]||(t[2]=m=>s.form.customer_id=m),items:s.customers,"item-value":"id","item-title":"name",clearable:"",density:"compact",variant:"outlined","hide-details":"auto",rules:[s.rules.required],hint:"Select or search for a customer","persistent-hint":""},{"prepend-inner":l(()=>[o(c,{size:"18"},{default:l(()=>t[23]||(t[23]=[p("mdi-account")])),_:1,__:[23]})]),label:l(()=>t[24]||(t[24]=[p(" Customer "),e("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","items","rules"])]),e("div",yt,[o(V,{modelValue:s.form.warehouse_id,"onUpdate:modelValue":t[3]||(t[3]=m=>s.form.warehouse_id=m),items:s.warehouses,"item-value":"id","item-title":"name",density:"compact",variant:"outlined","hide-details":"auto",rules:[s.rules.required],hint:"Select the warehouse for this sale","persistent-hint":""},{"prepend-inner":l(()=>[o(c,{size:"18"},{default:l(()=>t[25]||(t[25]=[p("mdi-warehouse")])),_:1,__:[25]})]),label:l(()=>t[26]||(t[26]=[p(" Warehouse "),e("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","items","rules"])]),i.isEdit&&s.form.invoice_number?(r(),_("div",bt,[o(n,{"model-value":s.form.invoice_number,label:"Invoice Number",density:"compact",variant:"outlined",readonly:"","hide-details":"auto",hint:"Invoice number (auto-generated)","persistent-hint":""},{"prepend-inner":l(()=>[o(c,{size:"18"},{default:l(()=>t[27]||(t[27]=[p("mdi-receipt")])),_:1,__:[27]})]),_:1},8,["model-value"])])):b("",!0),i.isEdit&&s.form.status?(r(),_("div",wt,[o(n,{"model-value":i.getStatusLabel(s.form.status),label:"Status",density:"compact",variant:"outlined",readonly:"","hide-details":"auto",hint:"Current sale status","persistent-hint":""},{"prepend-inner":l(()=>[o(c,{size:"18"},{default:l(()=>t[28]||(t[28]=[p("mdi-information")])),_:1,__:[28]})]),_:1},8,["model-value"])])):b("",!0),o(R,{dense:"",class:"ma-0 mb-2"},{default:l(()=>[o(h,{cols:"6",class:"pa-1"},{default:l(()=>[o(j,{"field-label":"Invoice Date",required:"true",variant:"outlined","initial-date":s.form.invoice_date,onTrigerInputValue:t[4]||(t[4]=m=>{s.form.invoice_date=m})},null,8,["initial-date"]),t[29]||(t[29]=e("div",{class:"text-caption text-grey mt-1 ml-2"},[e("span",{class:"text-error",style:{"font-size":"1.1em","font-weight":"bold"}},"*"),p(" Select the invoice date ")],-1))]),_:1,__:[29]}),o(h,{cols:"6",class:"pa-1"},{default:l(()=>[o(j,{"field-label":"Due Date",variant:"outlined","initial-date":s.form.due_date,onTrigerInputValue:t[5]||(t[5]=m=>{s.form.due_date=m})},null,8,["initial-date"]),t[30]||(t[30]=e("div",{class:"text-caption text-grey mt-1 ml-2"}," Optional: Select payment due date ",-1))]),_:1,__:[30]})]),_:1}),o(g,{class:"my-2"}),e("div",St,[e("div",kt,[t[31]||(t[31]=e("span",{class:"text-caption text-grey"},"Subtotal:",-1)),e("span",Dt,"৳"+d(s.form.subtotal.toFixed(2)),1)]),i.calculatedItemsDiscount>0?(r(),_("div",Ft,[t[32]||(t[32]=e("span",{class:"text-caption text-grey"},"Item Discounts:",-1)),e("span",Pt,"-৳"+d(i.calculatedItemsDiscount.toFixed(2)),1)])):b("",!0),e("div",Ct,[t[33]||(t[33]=e("span",{class:"text-caption text-grey"},"Order Discount:",-1)),o(n,{modelValue:s.form.discount_amount,"onUpdate:modelValue":[t[6]||(t[6]=m=>s.form.discount_amount=m),t[7]||(t[7]=()=>{s.discountAmountManuallySet=!0,i.calculateTotals()})],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue"])]),i.calculatedItemsTax>0?(r(),_("div",It,[t[34]||(t[34]=e("span",{class:"text-caption text-grey font-weight-medium"},"Total Tax:",-1)),e("span",Vt,"৳"+d(i.calculatedItemsTax.toFixed(2)),1)])):b("",!0),e("div",Tt,[t[35]||(t[35]=e("span",{class:"text-caption text-grey"},"Shipping:",-1)),o(n,{modelValue:s.form.shipping_cost,"onUpdate:modelValue":[t[8]||(t[8]=m=>s.form.shipping_cost=m),i.calculateTotals],modelModifiers:{number:!0},type:"number",density:"compact",variant:"outlined","hide-details":"",min:"0",step:"0.01",class:"compact-input"},null,8,["modelValue","onUpdate:modelValue"])]),o(g,{class:"my-2"}),e("div",zt,[t[36]||(t[36]=e("span",{class:"text-body-1 font-weight-bold"},"Total:",-1)),e("span",Ut,"৳"+d(s.form.total_amount.toFixed(2)),1)]),e("div",Et,[o(n,{modelValue:s.form.paid_amount,"onUpdate:modelValue":[t[9]||(t[9]=m=>s.form.paid_amount=m),i.calculateBalance],modelModifiers:{number:!0},type:"number",label:"Paid Amount",density:"compact",variant:"outlined",min:"0",step:"0.01","prepend-inner-icon":"mdi-cash","hide-details":"auto",hint:"Enter the amount paid by the customer (e.g., 1000.00)","persistent-hint":""},null,8,["modelValue","onUpdate:modelValue"])]),e("div",At,[o(n,{modelValue:s.form.balance_amount,"onUpdate:modelValue":t[10]||(t[10]=m=>s.form.balance_amount=m),modelModifiers:{number:!0},label:"Balance (Due)",density:"compact",variant:"outlined",readonly:"",color:s.form.balance_amount>0?"error":"success",class:L(s.form.balance_amount>0?"text-error":"text-success")},null,8,["modelValue","color","class"])]),s.form.paid_amount>0?(r(),_("div",Mt,[o(V,{modelValue:s.paymentMethod,"onUpdate:modelValue":t[11]||(t[11]=m=>s.paymentMethod=m),items:s.paymentMethods,label:"Payment Method",density:"compact",variant:"outlined","hide-details":"auto",hint:"Select how the customer paid","persistent-hint":""},null,8,["modelValue","items"])])):b("",!0)]),o(g,{class:"my-2"}),o(G,{modelValue:s.form.notes,"onUpdate:modelValue":t[12]||(t[12]=m=>s.form.notes=m),label:"Notes",rows:"2",density:"compact",variant:"outlined","hide-details":"auto",hint:"Optional: Enter any additional notes or comments about this sale","persistent-hint":""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(g),o(X,{class:"pa-2 justify-end"},{default:l(()=>[o(v,{variant:"text",size:"small",onClick:i.close},{default:l(()=>t[37]||(t[37]=[p("Cancel")])),_:1,__:[37]},8,["onClick"]),i.isEdit?b("",!0):(r(),S(v,{key:0,color:"grey",size:"small",loading:s.saving,disabled:s.cartItems.length===0,onClick:i.saveAsDraft},{default:l(()=>[o(c,{size:"18",class:"mr-1"},{default:l(()=>t[38]||(t[38]=[p("mdi-content-save-outline")])),_:1,__:[38]}),t[39]||(t[39]=p(" Save as Draft "))]),_:1,__:[39]},8,["loading","disabled","onClick"])),o(v,{color:"success",size:"small",loading:s.saving,disabled:s.cartItems.length===0,onClick:i.save},{default:l(()=>[o(c,{size:"18",class:"mr-1"},{default:l(()=>t[40]||(t[40]=[p("mdi-content-save")])),_:1,__:[40]}),p(" "+d(i.isEdit?"Update":"Save Sale"),1)]),_:1},8,["loading","disabled","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Bt=K(at,[["render",qt],["__scopeId","data-v-923f18d7"]]),H={async printInvoice(a,t){var f,x,s,i,c,v;try{const{data:y}=await q.get(`/api/v1/sales/${a.id}`),n=y.data||y.sale||y;if(!n){t&&t("Sale data not found");return}const D=window.open("","_blank","width=800,height=600");if(!D){t&&t("Please allow popups to print invoice");return}const C=(n.items||[]).reduce((k,V)=>k+parseFloat(V.discount||0),0),T=(n.items||[]).reduce((k,V)=>k+parseFloat(V.tax||0),0),z=parseFloat(n.subtotal||0),P=parseFloat(n.discount_amount||0),w=parseFloat(n.tax_amount||0),F=parseFloat(n.shipping_cost||0),E=P>0||P===0&&C===0?P:C;let I;w>0&&Math.abs(w-T)>=.01?I=w:I=Math.max(T,w);let g;n.total_amount!==void 0&&n.total_amount!==null?g=parseFloat(n.total_amount):g=z-E+I+F;const A=k=>k?new Date(k).toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"}):"",h=`<!DOCTYPE html>
<html>
<head>
    <title>Invoice #${n.invoice_number}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; padding: 20px; color: #000; }
        .invoice-container { max-width: 800px; margin: 0 auto; background: white; }
        .invoice-header { background: #1976d2; color: white; padding: 20px; text-align: center; }
        .invoice-header h1 { font-size: 24px; margin-bottom: 5px; }
        .invoice-header .invoice-number { font-size: 14px; opacity: 0.9; }
        .invoice-section { padding: 20px; border-bottom: 1px solid #ddd; }
        .invoice-row { display: flex; margin-bottom: 20px; }
        .invoice-col { flex: 1; }
        .invoice-col h3 { font-size: 14px; margin-bottom: 10px; color: #666; }
        .invoice-col p { margin: 3px 0; font-size: 13px; }
        .invoice-meta { display: flex; gap: 30px; margin-top: 15px; }
        .invoice-meta-item { flex: 1; }
        .invoice-meta-item label { font-size: 12px; color: #666; display: block; }
        .invoice-meta-item span { font-size: 14px; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th { background: #f5f5f5; padding: 10px; text-align: left; border: 1px solid #ddd; font-size: 12px; font-weight: bold; }
        td { padding: 10px; border: 1px solid #ddd; font-size: 12px; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .totals-box { background: #f9f9f9; padding: 15px; border: 2px solid #1976d2; margin-top: 20px; }
        .totals-row { display: flex; justify-content: space-between; padding: 5px 0; }
        .totals-row.total { border-top: 2px solid #1976d2; border-bottom: 2px solid #1976d2; padding: 10px 0; margin: 10px 0; background: rgba(25, 118, 210, 0.05); font-weight: bold; }
        .totals-row.balance { border-top: 1px dashed #999; padding-top: 10px; margin-top: 10px; font-weight: bold; }
        .invoice-footer { text-align: center; padding: 20px; color: #666; font-size: 12px; }
        .status-badge { display: inline-block; padding: 4px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; text-transform: uppercase; }
        .status-draft { background: #9e9e9e; color: white; }
        .status-pending { background: #ff9800; color: white; }
        .status-partial { background: #2196f3; color: white; }
        .status-paid { background: #4caf50; color: white; }
        .status-cancelled { background: #f44336; color: white; }
        @media print {
            body { padding: 0; }
            .invoice-container { box-shadow: none; }
            @page { margin: 1.5cm; size: A4; }
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="invoice-header">
            <h1>INVOICE</h1>
            <div class="invoice-number">#${n.invoice_number}</div>
        </div>

        <div class="invoice-section">
            <div class="invoice-row">
                <div class="invoice-col">
                    <h3>From</h3>
                    <p><strong>Your Company Name</strong></p>
                    <p>Company Address, City, State</p>
                    <p>Phone: +1234567890 | Email: info@company.com</p>
                </div>
                <div class="invoice-col">
                    <h3>Bill To</h3>
                    <p><strong>${((f=n.customer)==null?void 0:f.name)||"Walk-in Customer"}</strong></p>
                    ${(x=n.customer)!=null&&x.phone?`<p>Phone: ${n.customer.phone}</p>`:""}
                    ${(s=n.customer)!=null&&s.email?`<p>Email: ${n.customer.email}</p>`:""}
                    ${(i=n.customer)!=null&&i.address?`<p>${n.customer.address}</p>`:""}
                </div>
            </div>
            <div class="invoice-meta">
                <div class="invoice-meta-item">
                    <label>Invoice Date</label>
                    <span>${A(n.invoice_date)}</span>
                </div>
                ${n.due_date?`
                <div class="invoice-meta-item">
                    <label>Due Date</label>
                    <span>${A(n.due_date)}</span>
                </div>
                `:""}
                <div class="invoice-meta-item">
                    <label>Status</label>
                    <span class="status-badge status-${n.status||"pending"}">${(n.status||"pending").toUpperCase()}</span>
                </div>
            </div>
        </div>

        <div class="invoice-section">
            <h3 style="margin-bottom: 15px;">Items</h3>
            <table>
                <thead>
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th>Product</th>
                        <th class="text-center" style="width: 60px;">Qty</th>
                        <th class="text-right" style="width: 90px;">Price</th>
                        <th class="text-right" style="width: 80px;">Disc.</th>
                        <th class="text-right" style="width: 80px;">Tax</th>
                        <th class="text-right" style="width: 100px;">Total</th>
                    </tr>
                </thead>
                <tbody>
                    ${(n.items||[]).map((k,V)=>{var j,R;return`
                    <tr>
                        <td>${V+1}</td>
                        <td>
                            <strong>${((j=k.product)==null?void 0:j.name)||"Unknown"}</strong>
                            ${(R=k.product)!=null&&R.sku?`<br><small style="color: #666;">SKU: ${k.product.sku}</small>`:""}
                        </td>
                        <td class="text-center">${k.quantity}</td>
                        <td class="text-right">৳${parseFloat(k.unit_price||0).toFixed(2)}</td>
                        <td class="text-right" style="color: #f44336;">-৳${parseFloat(k.discount||0).toFixed(2)}</td>
                        <td class="text-right">৳${parseFloat(k.tax||0).toFixed(2)}</td>
                        <td class="text-right"><strong>৳${parseFloat(k.total||0).toFixed(2)}</strong></td>
                    </tr>
                    `}).join("")}
                </tbody>
            </table>
        </div>

        <div class="invoice-section">
            <div class="invoice-row">
                <div class="invoice-col">
                    ${n.notes?`
                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px; margin-bottom: 15px;">
                        <h3 style="margin-bottom: 5px; font-size: 13px;">Notes</h3>
                        <p style="font-size: 12px;">${n.notes}</p>
                    </div>
                    `:""}
                    ${n.warehouse?`
                    <div style="background: #f9f9f9; padding: 10px; border-radius: 4px;">
                        <h3 style="margin-bottom: 5px; font-size: 13px;">Warehouse</h3>
                        <p style="font-size: 12px;">${n.warehouse.name}</p>
                    </div>
                    `:""}
                </div>
                <div class="invoice-col">
                    <div class="totals-box">
                        <div class="totals-row">
                            <span>Subtotal:</span>
                            <span>৳${z.toFixed(2)}</span>
                        </div>
                        ${C>0&&(!P||P===0)?`
                        <div class="totals-row">
                            <span>Item Discounts:</span>
                            <span style="color: #f44336;">-৳${C.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${P>0?`
                        <div class="totals-row">
                            <span>Order Discount:</span>
                            <span style="color: #f44336;">-৳${P.toFixed(2)}</span>
                        </div>
                        `:""}
                        ${I>0?`
                        <div class="totals-row">
                            <span><strong>Total Tax:</strong></span>
                            <span><strong>৳${I.toFixed(2)}</strong></span>
                        </div>
                        `:""}
                        ${F>0?`
                        <div class="totals-row">
                            <span>Shipping:</span>
                            <span>৳${F.toFixed(2)}</span>
                        </div>
                        `:""}
                        <div class="totals-row total">
                            <span>Total:</span>
                            <span style="color: #1976d2;">৳${g.toFixed(2)}</span>
                        </div>
                        <div class="totals-row" style="color: #4caf50;">
                            <span><strong>Paid:</strong></span>
                            <span><strong>৳${parseFloat(n.paid_amount||0).toFixed(2)}</strong></span>
                        </div>
                        <div class="totals-row balance" style="color: ${n.balance_amount>0?"#f44336":"#4caf50"};">
                            <span><strong>Balance:</strong></span>
                            <span><strong>৳${parseFloat(n.balance_amount||0).toFixed(2)}</strong></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="invoice-footer">
            <p>Thank you for your business!</p>
        </div>
    </div>
    <script>
        window.onload = function() {
            window.print();
            window.onafterprint = function() {
                window.close();
            };
        };
    <\/script>
`+`</body>
</html>`;D.document.write(h),D.document.close()}catch(y){console.error("Failed to print invoice",y),t&&t(((v=(c=y.response)==null?void 0:c.data)==null?void 0:v.message)||"Failed to print invoice")}}},Nt={name:"ViewSaleDialog",props:{modelValue:{type:Boolean,required:!0},sale:{type:Object,default:null}},emits:["update:modelValue"],data(){return{saleData:null,loading:!1,currentSaleId:null}},watch:{modelValue:{immediate:!0,handler(a){a&&this.sale&&this.sale.id?this.currentSaleId!==this.sale.id&&this.loadSaleDetails(this.sale.id):a||(this.saleData=null,this.currentSaleId=null)}},sale:{immediate:!0,handler(a){a&&a.id&&this.modelValue&&this.currentSaleId!==a.id&&this.loadSaleDetails(a.id)}}},computed:{calculatedItemsDiscount(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.discount||0),0)},calculatedItemsTax(){return!this.saleData||!this.saleData.items?0:this.saleData.items.reduce((a,t)=>a+parseFloat(t.tax||0),0)},orderTaxAmount(){var a;return parseFloat(((a=this.saleData)==null?void 0:a.tax_amount)||0)},shouldShowOrderTax(){const a=this.calculatedItemsTax,t=this.orderTaxAmount;return t<=0?!1:!(a>0&&Math.abs(t-a)<.01)},calculatedTotalTax(){const a=this.calculatedItemsTax,t=this.orderTaxAmount;return t>0&&Math.abs(t-a)>=.01?t:Math.max(a,t)},calculatedTotalAmount(){if(!this.saleData)return 0;if(this.saleData.total_amount!==void 0&&this.saleData.total_amount!==null)return parseFloat(this.saleData.total_amount);const a=parseFloat(this.saleData.subtotal||0),t=parseFloat(this.saleData.discount_amount||0),f=parseFloat(this.saleData.shipping_cost||0),x=this.calculatedTotalTax,s=a-t+x+f;return parseFloat(s.toFixed(2))}},methods:{async loadSaleDetails(a){var t,f,x;if(!a){console.error("No sale ID provided");return}if(!(this.currentSaleId===a&&this.saleData)){this.currentSaleId=a,this.loading=!0,this.saleData=null;try{const{data:s}=await q.get(`/api/v1/sales/${a}`);this.saleData=s.data||s.sale||s,this.saleData||(this.showError("Sale data not found"),this.currentSaleId=null)}catch(s){console.error("Failed to load sale details:",s),console.error("Error response:",(t=s.response)==null?void 0:t.data),this.showError(((x=(f=s.response)==null?void 0:f.data)==null?void 0:x.message)||"Failed to load sale details"),this.currentSaleId=null}finally{this.loading=!1}}},formatDate:Q,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"},printInvoice(){if(!this.sale||!this.sale.id){this.showError("Sale information not available");return}H.printInvoice(this.sale,a=>{this.showError(a)})},close(){this.$emit("update:modelValue",!1),this.saleData=null,this.currentSaleId=null},showError(a){window.Toast?window.Toast.fire({icon:"error",title:a}):window.Swal?window.Swal.fire({icon:"error",title:a}):alert(a)}}},Ot={class:"ribbon-text"},jt={class:"d-flex align-center gap-2"},Rt={key:0,class:"text-caption text-white text-opacity-90"},Yt={key:0,class:"text-center py-8"},Lt={key:1,class:"text-center py-8"},Kt={key:2,class:"invoice-content"},Wt={class:"invoice-header-section pa-3"},Qt={class:"invoice-customer-info"},Ht={class:"text-body-2 font-weight-medium mb-0"},Gt={key:0,class:"text-caption text-grey"},Jt={key:1,class:"text-caption text-grey"},Xt={key:2,class:"text-caption text-grey"},Zt={class:"invoice-dates-compact mt-2"},$t={class:"invoice-date-item"},te={class:"text-body-2 font-weight-medium"},ee={key:0,class:"invoice-date-item"},se={class:"text-body-2 font-weight-medium"},ae={class:"invoice-items-section pa-3"},oe={key:0},ie={class:"text-grey text-caption"},le={class:"text-body-2 font-weight-medium"},ne={key:0,class:"text-caption text-grey"},re={class:"text-center text-body-2"},de={class:"text-right text-body-2"},ce={class:"text-right text-body-2 text-error"},ue={class:"text-right text-body-2"},me={class:"text-right text-body-2 font-weight-bold"},pe={class:"invoice-totals-section pa-3"},he={key:0,class:"invoice-notes"},fe={class:"text-body-2 text-caption"},_e={key:1,class:"invoice-warehouse mt-2"},ve={class:"text-body-2 text-caption"},ge={class:"invoice-totals-box"},xe={class:"invoice-totals-row"},ye={class:"invoice-totals-value text-body-2"},be={key:0,class:"invoice-totals-row"},we={class:"invoice-totals-value text-body-2 text-error"},Se={key:1,class:"invoice-totals-row"},ke={class:"invoice-totals-value text-body-2 text-error"},De={key:2,class:"invoice-totals-row invoice-totals-highlight"},Fe={class:"invoice-totals-value text-body-2 font-weight-medium"},Pe={key:3,class:"invoice-totals-row"},Ce={class:"invoice-totals-value text-body-2"},Ie={class:"invoice-totals-row invoice-totals-total"},Ve={class:"invoice-totals-value text-subtitle-1 font-weight-bold text-primary"},Te={class:"invoice-totals-row invoice-totals-paid"},ze={class:"invoice-totals-value text-body-2 font-weight-medium text-success"},Ue={class:"invoice-totals-value text-body-2 font-weight-bold"};function Ee(a,t,f,x,s,i){const c=u("v-icon"),v=u("v-btn"),y=u("v-card-title"),n=u("v-progress-circular"),D=u("v-alert"),C=u("v-col"),T=u("v-row"),z=u("v-table"),P=u("v-divider"),w=u("v-card-text"),F=u("v-card-actions"),E=u("v-card"),I=u("v-dialog");return r(),S(I,{"model-value":f.modelValue,"onUpdate:modelValue":t[0]||(t[0]=g=>a.$emit("update:modelValue",g)),"max-width":"900px",persistent:"",scrollable:""},{default:l(()=>[o(E,{class:"invoice-card"},{default:l(()=>[s.saleData?(r(),_("div",{key:0,class:L(["status-ribbon",`status-ribbon-${s.saleData.status||"pending"}`])},[e("span",Ot,d((s.saleData.status||"pending").toUpperCase()),1)],2)):b("",!0),o(y,{class:"invoice-header d-flex justify-space-between align-center pa-3"},{default:l(()=>[e("div",jt,[o(c,{color:"white",size:"24"},{default:l(()=>t[1]||(t[1]=[p("mdi-file-document-outline")])),_:1,__:[1]}),e("div",null,[t[2]||(t[2]=e("div",{class:"text-h6 text-white font-weight-bold"},"INVOICE",-1)),s.saleData?(r(),_("div",Rt," #"+d(s.saleData.invoice_number),1)):b("",!0)])]),o(v,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:i.close},null,8,["onClick"])]),_:1}),o(w,{class:"pa-0"},{default:l(()=>[s.loading?(r(),_("div",Yt,[o(n,{indeterminate:"",color:"primary",size:"48"}),t[3]||(t[3]=e("div",{class:"mt-3 text-body-2"},"Loading invoice details...",-1))])):s.saleData?(r(),_("div",Kt,[e("div",Wt,[o(T,{dense:""},{default:l(()=>[o(C,{cols:"12",md:"6"},{default:l(()=>t[5]||(t[5]=[e("div",{class:"invoice-company-info"},[e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"From"),e("div",{class:"text-body-2 font-weight-medium mb-0"},"Your Company Name"),e("div",{class:"text-caption text-grey"},"Company Address, City, State"),e("div",{class:"text-caption text-grey"},"Phone: +1234567890 | Email: info@company.com ")],-1)])),_:1,__:[5]}),o(C,{cols:"12",md:"6"},{default:l(()=>{var g,A,M,h;return[e("div",Qt,[t[6]||(t[6]=e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Bill To",-1)),e("div",Ht,d(((g=s.saleData.customer)==null?void 0:g.name)||"Walk-in Customer"),1),(A=s.saleData.customer)!=null&&A.phone?(r(),_("div",Gt," Phone: "+d(s.saleData.customer.phone),1)):b("",!0),(M=s.saleData.customer)!=null&&M.email?(r(),_("div",Jt," Email: "+d(s.saleData.customer.email),1)):b("",!0),(h=s.saleData.customer)!=null&&h.address?(r(),_("div",Xt,d(s.saleData.customer.address),1)):b("",!0)])]}),_:1})]),_:1}),e("div",Zt,[e("div",$t,[o(c,{size:"16",class:"mr-1"},{default:l(()=>t[7]||(t[7]=[p("mdi-calendar")])),_:1,__:[7]}),t[8]||(t[8]=e("span",{class:"text-caption text-grey mr-1"},"Invoice:",-1)),e("span",te,d(i.formatDate(s.saleData.invoice_date)),1)]),s.saleData.due_date?(r(),_("div",ee,[o(c,{size:"16",class:"mr-1"},{default:l(()=>t[9]||(t[9]=[p("mdi-calendar-clock")])),_:1,__:[9]}),t[10]||(t[10]=e("span",{class:"text-caption text-grey mr-1"},"Due:",-1)),e("span",se,d(i.formatDate(s.saleData.due_date)),1)])):b("",!0)])]),e("div",ae,[t[13]||(t[13]=e("div",{class:"text-subtitle-1 font-weight-bold mb-2"},"Items",-1)),o(z,{class:"invoice-table",density:"compact"},{default:l(()=>[t[12]||(t[12]=e("thead",null,[e("tr",{class:"invoice-table-header"},[e("th",{class:"text-left",style:{width:"30px"}},"#"),e("th",{class:"text-left"},"Product"),e("th",{class:"text-center",style:{width:"60px"}},"Qty"),e("th",{class:"text-right",style:{width:"90px"}},"Price"),e("th",{class:"text-right",style:{width:"80px"}},"Disc."),e("th",{class:"text-right",style:{width:"80px"}},"Tax"),e("th",{class:"text-right",style:{width:"100px"}},"Total")])],-1)),e("tbody",null,[!s.saleData.items||s.saleData.items.length===0?(r(),_("tr",oe,t[11]||(t[11]=[e("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):b("",!0),(r(!0),_(N,null,O(s.saleData.items||[],(g,A)=>{var M,h;return r(),_("tr",{key:g.id||g.product_id,class:"invoice-table-row"},[e("td",ie,d(A+1),1),e("td",null,[e("div",le,d(((M=g.product)==null?void 0:M.name)||"Unknown"),1),(h=g.product)!=null&&h.sku?(r(),_("div",ne,"SKU: "+d(g.product.sku),1)):b("",!0)]),e("td",re,d(g.quantity),1),e("td",de,"৳"+d(parseFloat(g.unit_price||0).toFixed(2)),1),e("td",ce,"-৳"+d(parseFloat(g.discount||0).toFixed(2)),1),e("td",ue,"৳"+d(parseFloat(g.tax||0).toFixed(2)),1),e("td",me,"৳"+d(parseFloat(g.total||0).toFixed(2)),1)])}),128))])]),_:1,__:[12]})]),e("div",pe,[o(T,{dense:""},{default:l(()=>[o(C,{cols:"12",md:"7"},{default:l(()=>[s.saleData.notes?(r(),_("div",he,[t[14]||(t[14]=e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Notes",-1)),e("div",fe,d(s.saleData.notes),1)])):b("",!0),s.saleData.warehouse?(r(),_("div",_e,[t[15]||(t[15]=e("div",{class:"text-subtitle-2 font-weight-bold mb-1"},"Warehouse",-1)),e("div",ve,d(s.saleData.warehouse.name),1)])):b("",!0)]),_:1}),o(C,{cols:"12",md:"5"},{default:l(()=>[e("div",ge,[e("div",xe,[t[16]||(t[16]=e("span",{class:"invoice-totals-label text-caption"},"Subtotal:",-1)),e("span",ye,"৳"+d(parseFloat(s.saleData.subtotal||0).toFixed(2)),1)]),i.calculatedItemsDiscount>0&&(!s.saleData.discount_amount||s.saleData.discount_amount===0)?(r(),_("div",be,[t[17]||(t[17]=e("span",{class:"invoice-totals-label text-caption"},"Item Discounts:",-1)),e("span",we,"-৳"+d(i.calculatedItemsDiscount.toFixed(2)),1)])):b("",!0),s.saleData.discount_amount>0?(r(),_("div",Se,[t[18]||(t[18]=e("span",{class:"invoice-totals-label text-caption"},"Order Discount:",-1)),e("span",ke,"-৳"+d(parseFloat(s.saleData.discount_amount).toFixed(2)),1)])):b("",!0),i.calculatedTotalTax>0?(r(),_("div",De,[t[19]||(t[19]=e("span",{class:"invoice-totals-label text-body-2 font-weight-medium"},"Total Tax:",-1)),e("span",Fe,"৳"+d(i.calculatedTotalTax.toFixed(2)),1)])):b("",!0),s.saleData.shipping_cost>0?(r(),_("div",Pe,[t[20]||(t[20]=e("span",{class:"invoice-totals-label text-caption"},"Shipping:",-1)),e("span",Ce,"৳"+d(parseFloat(s.saleData.shipping_cost).toFixed(2)),1)])):b("",!0),o(P,{class:"my-2"}),e("div",Ie,[t[21]||(t[21]=e("span",{class:"invoice-totals-label text-subtitle-1 font-weight-bold"},"Total:",-1)),e("span",Ve,"৳"+d(i.calculatedTotalAmount.toFixed(2)),1)]),e("div",Te,[t[22]||(t[22]=e("span",{class:"invoice-totals-label text-body-2 font-weight-medium text-success"},"Paid:",-1)),e("span",ze,"৳"+d(parseFloat(s.saleData.paid_amount||0).toFixed(2)),1)]),e("div",{class:L(["invoice-totals-row invoice-totals-balance",s.saleData.balance_amount>0?"text-error":"text-success"])},[t[23]||(t[23]=e("span",{class:"invoice-totals-label text-body-2 font-weight-bold"},"Balance:",-1)),e("span",Ue,"৳"+d(parseFloat(s.saleData.balance_amount||0).toFixed(2)),1)],2)])]),_:1})]),_:1})]),t[24]||(t[24]=e("div",{class:"invoice-footer pa-2 text-center"},[e("div",{class:"text-caption text-grey"}," Thank you for your business! ")],-1))])):(r(),_("div",Lt,[o(D,{type:"error",variant:"tonal",class:"ma-3",density:"compact"},{default:l(()=>t[4]||(t[4]=[p(" Failed to load invoice details ")])),_:1,__:[4]})]))]),_:1}),o(P),o(F,{class:"justify-end pa-2 bg-grey-lighten-5"},{default:l(()=>[o(v,{color:"primary","prepend-icon":"mdi-printer",variant:"flat",size:"small",onClick:i.printInvoice},{default:l(()=>t[25]||(t[25]=[p(" Print Invoice ")])),_:1,__:[25]},8,["onClick"]),o(v,{variant:"text",size:"small",onClick:i.close},{default:l(()=>t[26]||(t[26]=[p("Close")])),_:1,__:[26]},8,["onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const Ae=K(Nt,[["render",Ee],["__scopeId","data-v-bd68f24e"]]),Me={name:"AdminSales",mixins:[W],components:{SaleDialog:Bt,ViewSaleDialog:Ae,DatePicker:et,PaginationControls:st},data(){return{sales:[],dialog:!1,viewDialog:!1,selectedSale:null,filters:{search:"",status:null,date_from:"",date_to:""},statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}],currentPage:1,perPage:10,perPageOptions:[{title:"10",value:10,description:"Quick view"},{title:"25",value:25,description:"Standard"},{title:"50",value:50,description:"Comfortable"},{title:"100",value:100,description:"Extended"},{title:"500",value:500,description:"Large dataset"},{title:"Show All",value:"all",description:"All records"}],pagination:{current_page:1,last_page:1,per_page:10,total:0}}},async mounted(){await this.fetchSales()},methods:{async fetchSales(){try{this.loading=!0;const a=this.buildPaginationParams();this.perPage==="all"&&(a.per_page=999999),this.filters.search&&(a.search=this.filters.search),this.filters.status&&(a.status=this.filters.status),this.filters.date_from&&String(this.filters.date_from).trim()!==""&&(a.from_date=this.filters.date_from),this.filters.date_to&&String(this.filters.date_to).trim()!==""&&(a.to_date=this.filters.date_to);const t=await this.$axios.get("/api/v1/sales",{params:a,headers:this.getAuthHeaders()});this.sales=t.data.data||t.data.sales||[],this.updatePagination(t.data)}catch(a){this.handleApiError(a,"Failed to load sales")}finally{this.loading=!1}},openDialog(){this.selectedSale=null,this.dialog=!0},editSale(a){this.selectedSale=a,this.dialog=!0},viewSale(a){this.selectedSale=a,this.viewDialog=!0},async confirmDelete(a){if(confirm(`Are you sure you want to delete sale ${a.invoice_number}?`))try{await this.$axios.delete(`/api/v1/sales/${a.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Sale deleted successfully"),await this.fetchSales()}catch(t){this.handleApiError(t,"Error deleting sale")}},printInvoice(a){H.printInvoice(a,t=>{this.showError(t)})},handleSaved(){this.fetchSales()},resetFilters(){this.filters={search:"",status:null,date_from:"",date_to:""},this.resetPagination(),this.fetchSales()},buildPaginationParams(a={}){return Y.buildPaginationParams(this.currentPage,this.perPage,a,this.sortBy,this.sortDirection)},updatePagination(a){Y.updatePagination(this,a)},resetPagination(){Y.resetPagination(this)},onPerPageUpdate(a){this.perPage=a,this.onPerPageChange()},onPageChange(a){this.currentPage=a,this.fetchSales()},onPerPageChange(){this.resetPagination(),this.fetchSales()},onSort(a){this.handleSort(a),this.currentPage=1,this.fetchSales()},onDateFromChange(a){this.filters.date_from=a||"",this.resetPagination(),this.fetchSales()},onDateToChange(a){this.filters.date_to=a||"",this.resetPagination(),this.fetchSales()},formatDateDDMMYYYY:Q,getStatusColor(a){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[a]||"grey"}}},qe={class:"page-header"},Be={class:"text-caption text-grey"},Ne={class:"sortable-header"},Oe={class:"sortable-header"},je={class:"sortable-header justify-end"},Re={class:"sortable-header justify-end"},Ye={class:"sortable-header justify-end"},Le={class:"sortable-header"},Ke={class:"d-flex"},We={class:"font-weight-bold"},Qe={class:"text-end"},He={class:"text-end"},Ge={class:"text-end"},Je={key:0},Xe={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},Ze={class:"text-caption text-grey"},$e={key:0},ts={key:0},es={key:1},ss={key:1};function as(a,t,f,x,s,i){const c=u("v-btn"),v=u("v-select"),y=u("v-col"),n=u("DatePicker"),D=u("v-text-field"),C=u("v-row"),T=u("v-card-text"),z=u("v-card"),P=u("v-card-title"),w=u("v-icon"),F=u("v-skeleton-loader"),E=u("v-chip"),I=u("v-table"),g=u("PaginationControls"),A=u("SaleDialog"),M=u("ViewSaleDialog");return r(),_("div",null,[e("div",qe,[t[14]||(t[14]=e("h1",{class:"text-h4 page-title"},"Sales / POS",-1)),o(c,{color:"primary","prepend-icon":"mdi-plus",onClick:i.openDialog,class:"add-button"},{default:l(()=>t[13]||(t[13]=[p(" New Sale ")])),_:1,__:[13]},8,["onClick"])]),o(z,{class:"mb-4"},{default:l(()=>[o(T,null,{default:l(()=>[o(C,null,{default:l(()=>[o(y,{cols:"12",md:"3"},{default:l(()=>[o(v,{modelValue:s.filters.status,"onUpdate:modelValue":[t[0]||(t[0]=h=>s.filters.status=h),i.fetchSales],items:s.statusOptions,label:"Filter by Status","prepend-inner-icon":"mdi-filter",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(y,{cols:"12",md:"3"},{default:l(()=>[o(n,{modelValue:s.filters.date_from,"onUpdate:modelValue":[t[1]||(t[1]=h=>s.filters.date_from=h),i.onDateFromChange],label:"From Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(y,{cols:"12",md:"3"},{default:l(()=>[o(n,{modelValue:s.filters.date_to,"onUpdate:modelValue":[t[2]||(t[2]=h=>s.filters.date_to=h),i.onDateToChange],label:"To Date",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(y,{cols:"12",md:"3"},{default:l(()=>[o(D,{modelValue:s.filters.search,"onUpdate:modelValue":t[3]||(t[3]=h=>s.filters.search=h),label:"Search Invoice/Customer","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:i.fetchSales},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(z,null,{default:l(()=>[o(P,{class:"d-flex justify-space-between align-center"},{default:l(()=>[t[16]||(t[16]=e("span",null,"Sales",-1)),e("span",Be,[t[15]||(t[15]=p(" Total Records: ")),e("strong",null,d(s.pagination.total||0),1)])]),_:1,__:[16]}),o(T,null,{default:l(()=>[o(I,null,{default:l(()=>[e("thead",null,[e("tr",null,[e("th",{class:"sortable",onClick:t[4]||(t[4]=h=>i.onSort("invoice_number"))},[e("div",Ne,[t[18]||(t[18]=e("span",null,"Invoice #",-1)),a.sortBy==="invoice_number"?(r(),S(w,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(d(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),S(w,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[17]||(t[17]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[17]}))])]),t[29]||(t[29]=e("th",null,"Customer",-1)),e("th",{class:"sortable",onClick:t[5]||(t[5]=h=>i.onSort("invoice_date"))},[e("div",Oe,[t[20]||(t[20]=e("span",null,"Date",-1)),a.sortBy==="invoice_date"?(r(),S(w,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(d(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),S(w,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[19]||(t[19]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[19]}))])]),e("th",{class:"text-end sortable",onClick:t[6]||(t[6]=h=>i.onSort("total_amount"))},[e("div",je,[t[22]||(t[22]=e("span",null,"Total",-1)),a.sortBy==="total_amount"?(r(),S(w,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(d(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),S(w,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[21]||(t[21]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),e("th",{class:"text-end sortable",onClick:t[7]||(t[7]=h=>i.onSort("paid_amount"))},[e("div",Re,[t[24]||(t[24]=e("span",null,"Paid",-1)),a.sortBy==="paid_amount"?(r(),S(w,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(d(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),S(w,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[23]||(t[23]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),e("th",{class:"text-end sortable",onClick:t[8]||(t[8]=h=>i.onSort("balance_amount"))},[e("div",Ye,[t[26]||(t[26]=e("span",null,"Due",-1)),a.sortBy==="balance_amount"?(r(),S(w,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(d(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),S(w,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[25]||(t[25]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[25]}))])]),e("th",{class:"sortable",onClick:t[9]||(t[9]=h=>i.onSort("status"))},[e("div",Le,[t[28]||(t[28]=e("span",null,"Status",-1)),a.sortBy==="status"?(r(),S(w,{key:0,size:"18",class:"sort-icon active"},{default:l(()=>[p(d(a.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),S(w,{key:1,size:"18",class:"sort-icon inactive"},{default:l(()=>t[27]||(t[27]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[27]}))])]),t[30]||(t[30]=e("th",null,"Actions",-1))])]),e("tbody",null,[a.loading?(r(),_(N,{key:0},O(5,h=>e("tr",{key:`skeleton-${h}`},[e("td",null,[o(F,{type:"text",width:"100"})]),e("td",null,[o(F,{type:"text",width:"120"})]),e("td",null,[o(F,{type:"text",width:"90"})]),e("td",null,[o(F,{type:"text",width:"80"})]),e("td",null,[o(F,{type:"text",width:"80"})]),e("td",null,[o(F,{type:"chip",width:"80",height:"24"})]),e("td",null,[o(F,{type:"chip",width:"80",height:"24"})]),e("td",null,[e("div",Ke,[o(F,{type:"button",width:"32",height:"32",class:"mr-1"}),o(F,{type:"button",width:"32",height:"32",class:"mr-1"}),o(F,{type:"button",width:"32",height:"32",class:"mr-1"}),o(F,{type:"button",width:"32",height:"32"})])])])),64)):(r(),_(N,{key:1},[(r(!0),_(N,null,O(s.sales,h=>{var k;return r(),_("tr",{key:h.id},[e("td",null,[e("span",We,d(h.invoice_number),1)]),e("td",null,d(((k=h.customer)==null?void 0:k.name)||"Walk-in"),1),e("td",null,d(i.formatDateDDMMYYYY(h.invoice_date)),1),e("td",Qe," ৳"+d(parseFloat(h.total_amount).toFixed(2)),1),e("td",He," ৳"+d(parseFloat(h.paid_amount).toFixed(2)),1),e("td",Ge,[o(E,{color:h.balance_amount>0?"error":"success",size:"small"},{default:l(()=>[p(" ৳"+d(parseFloat(h.balance_amount).toFixed(2)),1)]),_:2},1032,["color"])]),e("td",null,[o(E,{color:i.getStatusColor(h.status),size:"small"},{default:l(()=>[p(d(h.status),1)]),_:2},1032,["color"])]),e("td",null,[o(c,{icon:"mdi-eye",size:"small",variant:"text",onClick:V=>i.viewSale(h)},null,8,["onClick"]),o(c,{icon:"mdi-pencil",size:"small",variant:"text",onClick:V=>i.editSale(h)},null,8,["onClick"]),o(c,{icon:"mdi-printer",size:"small",variant:"text",onClick:V=>i.printInvoice(h)},null,8,["onClick"]),o(c,{icon:"mdi-delete",size:"small",variant:"text",color:"error",onClick:V=>i.confirmDelete(h)},null,8,["onClick"])])])}),128)),s.sales.length===0?(r(),_("tr",Je,t[31]||(t[31]=[e("td",{colspan:"8",class:"text-center py-4"},"No sales found",-1)]))):b("",!0)],64))])]),_:1}),e("div",Xe,[e("div",Ze,[s.sales.length>0&&s.pagination.total>0?(r(),_("span",$e,[s.perPage==="all"?(r(),_("span",ts,[t[32]||(t[32]=p(" Showing ")),e("strong",null,"all "+d(s.pagination.total.toLocaleString()),1),t[33]||(t[33]=p(" records "))])):(r(),_("span",es,[t[34]||(t[34]=p(" Showing ")),e("strong",null,d((s.currentPage-1)*s.perPage+1),1),t[35]||(t[35]=p(" to ")),e("strong",null,d(Math.min(s.currentPage*s.perPage,s.pagination.total)),1),t[36]||(t[36]=p(" of ")),e("strong",null,d(s.pagination.total.toLocaleString()),1),t[37]||(t[37]=p(" records "))]))])):(r(),_("span",ss,"No records found"))]),o(g,{modelValue:s.currentPage,"onUpdate:modelValue":t[10]||(t[10]=h=>s.currentPage=h),pagination:s.pagination,"per-page-value":s.perPage,"per-page-options":s.perPageOptions,"onUpdate:perPage":i.onPerPageUpdate,onPageChange:i.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),o(A,{"model-value":s.dialog,"onUpdate:modelValue":t[11]||(t[11]=h=>s.dialog=h),sale:s.selectedSale,onSaved:i.handleSaved},null,8,["model-value","sale","onSaved"]),o(M,{"model-value":s.viewDialog,"onUpdate:modelValue":t[12]||(t[12]=h=>s.viewDialog=h),sale:s.selectedSale},null,8,["model-value","sale"])])}const cs=K(Me,[["render",as],["__scopeId","data-v-4c85482e"]]);export{cs as default};
