import{_ as S,i as f,d as E,w as o,a as t,r as n,b as a,t as p,f as x,o as g,c as y,l as A,e as N,F as B,h as q}from"./app-CHlE1Mvy.js";const K={name:"ProductDialog",props:{modelValue:{type:Boolean,required:!0},product:{type:Object,default:null}},emits:["update:modelValue","saved"],data(){return{form:this.getEmptyForm(),formValid:!1,saving:!1,categoryOptions:[],unitOptions:[],rules:{required:s=>!!s||"Required"}}},computed:{isEdit(){return!!this.form.id}},watch:{product:{immediate:!0,handler(s){this.form=s?{...this.getEmptyForm(),...s}:this.getEmptyForm()}}},created(){this.fetchOptions()},methods:{getEmptyForm(){return{id:null,name:"",sku:"",barcode:"",brand:"",category_id:null,unit_id:null,description:"",image:"",purchase_price:0,sale_price:0,tax_rate:0,minimum_stock_level:0,is_active:!0}},async fetchOptions(){try{const[s,e]=await Promise.all([f.get("/api/v1/products/categories"),f.get("/api/v1/products/units")]);this.categoryOptions=s.data.categories||[],this.unitOptions=e.data.units||[]}catch(s){console.error("Failed to load options",s)}},close(){this.$emit("update:modelValue",!1)},async save(){var e;if(await this.$refs.formRef.validate()){this.saving=!0;try{const m={...this.form};this.isEdit?await f.put(`/api/v1/products/${this.form.id}`,m):await f.post("/api/v1/products",m),this.$emit("saved"),this.close()}catch(m){console.error("Failed to save product",m),(e=this.$toast)==null||e.error("Failed to save product")}finally{this.saving=!1}}}}},M={class:"text-h6"};function R(s,e,m,b,l,d){const _=n("v-btn"),P=n("v-card-title"),v=n("v-divider"),c=n("v-text-field"),u=n("v-col"),h=n("v-switch"),V=n("v-select"),U=n("v-textarea"),k=n("v-row"),F=n("v-form"),C=n("v-card-text"),w=n("v-card-actions"),O=n("v-card"),i=n("v-dialog");return g(),E(i,{"model-value":m.modelValue,"onUpdate:modelValue":e[14]||(e[14]=r=>s.$emit("update:modelValue",r)),"max-width":"700px",persistent:""},{default:o(()=>[t(O,null,{default:o(()=>[t(P,{class:"d-flex justify-space-between align-center"},{default:o(()=>[a("span",M,p(d.isEdit?"Edit Product":"Add Product"),1),t(_,{icon:"mdi-close",variant:"text",onClick:d.close},null,8,["onClick"])]),_:1}),t(v),t(C,null,{default:o(()=>[t(F,{ref:"formRef",modelValue:l.formValid,"onUpdate:modelValue":e[13]||(e[13]=r=>l.formValid=r),"lazy-validation":""},{default:o(()=>[t(k,{dense:""},{default:o(()=>[t(u,{cols:"12",sm:"8"},{default:o(()=>[t(c,{modelValue:l.form.name,"onUpdate:modelValue":e[0]||(e[0]=r=>l.form.name=r),label:"Product Name",rules:[l.rules.required]},null,8,["modelValue","rules"])]),_:1}),t(u,{cols:"12",sm:"4"},{default:o(()=>[t(h,{modelValue:l.form.is_active,"onUpdate:modelValue":e[1]||(e[1]=r=>l.form.is_active=r),inset:"",label:"Active"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.sku,"onUpdate:modelValue":e[2]||(e[2]=r=>l.form.sku=r),label:"SKU"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.barcode,"onUpdate:modelValue":e[3]||(e[3]=r=>l.form.barcode=r),label:"Barcode"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.brand,"onUpdate:modelValue":e[4]||(e[4]=r=>l.form.brand=r),label:"Brand"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.image,"onUpdate:modelValue":e[5]||(e[5]=r=>l.form.image=r),label:"Image URL"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(V,{modelValue:l.form.category_id,"onUpdate:modelValue":e[6]||(e[6]=r=>l.form.category_id=r),items:l.categoryOptions,"item-value":"value","item-title":"label",label:"Category",clearable:""},null,8,["modelValue","items"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(V,{modelValue:l.form.unit_id,"onUpdate:modelValue":e[7]||(e[7]=r=>l.form.unit_id=r),items:l.unitOptions,"item-value":"value","item-title":"label",label:"Unit",clearable:""},null,8,["modelValue","items"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.purchase_price,"onUpdate:modelValue":e[8]||(e[8]=r=>l.form.purchase_price=r),modelModifiers:{number:!0},label:"Purchase Price",type:"number",min:"0",step:"0.01",rules:[l.rules.required]},null,8,["modelValue","rules"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.sale_price,"onUpdate:modelValue":e[9]||(e[9]=r=>l.form.sale_price=r),modelModifiers:{number:!0},label:"Sale Price",type:"number",min:"0",step:"0.01",rules:[l.rules.required]},null,8,["modelValue","rules"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.tax_rate,"onUpdate:modelValue":e[10]||(e[10]=r=>l.form.tax_rate=r),modelModifiers:{number:!0},label:"VAT/Tax (%)",type:"number",min:"0",step:"0.01"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12",sm:"6"},{default:o(()=>[t(c,{modelValue:l.form.minimum_stock_level,"onUpdate:modelValue":e[11]||(e[11]=r=>l.form.minimum_stock_level=r),modelModifiers:{number:!0},label:"Minimum Stock Alert",type:"number",min:"0"},null,8,["modelValue"])]),_:1}),t(u,{cols:"12"},{default:o(()=>[t(U,{modelValue:l.form.description,"onUpdate:modelValue":e[12]||(e[12]=r=>l.form.description=r),label:"Description",rows:"2"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}),t(v),t(w,{class:"d-flex justify-end"},{default:o(()=>[t(_,{variant:"text",onClick:d.close},{default:o(()=>e[15]||(e[15]=[x("Cancel")])),_:1,__:[15]},8,["onClick"]),t(_,{color:"primary",loading:l.saving,onClick:d.save},{default:o(()=>[x(p(d.isEdit?"Update":"Save"),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const j=S(K,[["render",R]]),z={name:"AdminProducts",components:{ProductDialog:j},data(){return{products:[],pagination:{},loading:!1,page:1,perPage:10,search:"",categoryOptions:[],categoryFilter:null,activeOptions:[{title:"Active",value:!0},{title:"Inactive",value:!1}],activeFilter:null,dialog:!1,editingProduct:null}},created(){this.loadOptions(),this.loadProducts()},methods:{async loadOptions(){try{const{data:s}=await f.get("/api/v1/products/categories");this.categoryOptions=s.categories||[]}catch(s){console.error("Failed to load categories",s)}},async loadProducts(){var s;try{this.loading=!0;const e={page:this.page,per_page:this.perPage};this.search&&(e.search=this.search),this.categoryFilter&&(e.category_id=this.categoryFilter),this.activeFilter!==null&&(e.is_active=this.activeFilter);const{data:m}=await f.get("/api/v1/products",{params:e});this.products=m.data||[],this.pagination=m}catch(e){console.error("Failed to load products",e),(s=this.$toast)==null||s.error("Failed to load products")}finally{this.loading=!1}},openDialog(s){this.editingProduct=s,this.dialog=!0},async deleteProduct(s){var e,m,b,l;if(confirm(`Delete ${s.name}?`))try{await f.delete(`/api/v1/products/${s.id}`),(e=this.$toast)==null||e.success("Product deleted"),this.loadProducts()}catch(d){console.error("Failed to delete product",d),(l=this.$toast)==null||l.error(((b=(m=d.response)==null?void 0:m.data)==null?void 0:b.message)||"Delete failed")}},formatCurrency(s){const e=Number(s)||0;return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e)}}},I={class:"page-header d-flex align-center justify-space-between mb-4"},L={key:0},T={key:1},G={class:"text-right"},H={class:"text-right"},J={class:"text-right"},Q={class:"text-right"};function W(s,e,m,b,l,d){const _=n("v-btn"),P=n("v-text-field"),v=n("v-col"),c=n("v-select"),u=n("v-row"),h=n("v-card-text"),V=n("v-card"),U=n("v-card-title"),k=n("v-divider"),F=n("v-chip"),C=n("v-table"),w=n("v-pagination"),O=n("product-dialog");return g(),y("div",null,[a("div",I,[e[7]||(e[7]=a("h1",{class:"text-h4 page-title"},"Products",-1)),t(_,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=i=>d.openDialog(null))},{default:o(()=>e[6]||(e[6]=[x("Add Product")])),_:1,__:[6]})]),t(V,{class:"mb-4"},{default:o(()=>[t(h,null,{default:o(()=>[t(u,{dense:""},{default:o(()=>[t(v,{cols:"12",md:"4"},{default:o(()=>[t(P,{modelValue:l.search,"onUpdate:modelValue":e[1]||(e[1]=i=>l.search=i),label:"Search by name, SKU, barcode","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onKeyup:A(d.loadProducts,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(v,{cols:"12",md:"3"},{default:o(()=>[t(c,{modelValue:l.categoryFilter,"onUpdate:modelValue":[e[2]||(e[2]=i=>l.categoryFilter=i),d.loadProducts],items:l.categoryOptions,"item-value":"value","item-title":"label",label:"Category",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),t(v,{cols:"12",md:"3"},{default:o(()=>[t(c,{modelValue:l.activeFilter,"onUpdate:modelValue":[e[3]||(e[3]=i=>l.activeFilter=i),d.loadProducts],items:l.activeOptions,label:"Status",clearable:"",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(V,null,{default:o(()=>[t(U,{class:"d-flex justify-space-between align-center"},{default:o(()=>[e[8]||(e[8]=a("span",null,"Products",-1)),t(_,{size:"small",icon:"mdi-refresh",variant:"text",onClick:d.loadProducts,loading:l.loading},null,8,["onClick","loading"])]),_:1,__:[8]}),t(k),t(h,null,{default:o(()=>[t(C,{density:"compact"},{default:o(()=>[e[11]||(e[11]=a("thead",null,[a("tr",null,[a("th",null,"Name"),a("th",null,"SKU"),a("th",null,"Category"),a("th",{class:"text-right"},"Purchase"),a("th",{class:"text-right"},"Sale"),a("th",{class:"text-right"},"Min Stock"),a("th",null,"Status"),a("th")])],-1)),a("tbody",null,[l.loading?(g(),y("tr",L,e[9]||(e[9]=[a("td",{colspan:"8",class:"text-center text-grey"},"Loading...",-1)]))):l.products.length===0?(g(),y("tr",T,e[10]||(e[10]=[a("td",{colspan:"8",class:"text-center text-grey"},"No products found",-1)]))):N("",!0),(g(!0),y(B,null,q(l.products,i=>{var r;return g(),y("tr",{key:i.id},[a("td",null,p(i.name),1),a("td",null,p(i.sku||"-"),1),a("td",null,p(((r=i.category)==null?void 0:r.name)||"-"),1),a("td",G,p(d.formatCurrency(i.purchase_price)),1),a("td",H,p(d.formatCurrency(i.sale_price)),1),a("td",J,p(i.minimum_stock_level||0),1),a("td",null,[t(F,{size:"small",color:i.is_active?"success":"error",variant:"tonal"},{default:o(()=>[x(p(i.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),a("td",Q,[t(_,{icon:"mdi-pencil",variant:"text",size:"small",onClick:D=>d.openDialog(i)},null,8,["onClick"]),t(_,{icon:"mdi-delete",variant:"text",size:"small",color:"error",onClick:D=>d.deleteProduct(i)},null,8,["onClick"])])])}),128))])]),_:1,__:[11]}),t(w,{modelValue:l.page,"onUpdate:modelValue":[e[4]||(e[4]=i=>l.page=i),d.loadProducts],length:l.pagination.last_page||1,class:"mt-3"},null,8,["modelValue","length","onUpdate:modelValue"])]),_:1})]),_:1}),t(O,{modelValue:l.dialog,"onUpdate:modelValue":e[5]||(e[5]=i=>l.dialog=i),product:l.editingProduct,onSaved:d.loadProducts},null,8,["modelValue","product","onSaved"])])}const Y=S(z,[["render",W]]);export{Y as default};
