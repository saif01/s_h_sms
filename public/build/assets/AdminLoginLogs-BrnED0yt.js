import{c as E}from"./commonMixin-LD1l2-5e.js";import{p as I,P as N}from"./PaginationControls-CGFLaHsK.js";import{f as T}from"./formatters-DzU97YYy.js";import{_ as q,c as u,b as e,a as s,w as o,r as g,f as n,t as a,d as c,F as L,y as x,e as P,o as r}from"./app-CYStQJ0f.js";const M={components:{PaginationControls:N},mixins:[E,I],data(){return{logs:[],statistics:{total:0,successful:0,failed:0,unique_users:0,unique_ips:0},statusFilter:null,statusOptions:[{title:"Success",value:"success"},{title:"Failed",value:"failed"}],viewDialog:!1,selectedLog:null}},async mounted(){await this.loadStatistics(),await this.loadLogs()},methods:{async loadStatistics(){try{const l=await this.$axios.get("/api/v1/login-logs/statistics",{headers:this.getAuthHeaders()});this.statistics=l.data}catch(l){console.error("Error loading statistics:",l)}},async loadLogs(){try{this.loading=!0;const l=this.buildPaginationParams();this.search&&(l.search=this.search),this.statusFilter&&(l.status=this.statusFilter);const t=await this.$axios.get("/api/v1/login-logs",{params:l,headers:this.getAuthHeaders()});this.logs=t.data.data||[],this.updatePagination(t.data)}catch(l){this.handleApiError(l,"Failed to load login logs")}finally{this.loading=!1}},viewLog(l){this.selectedLog=l,this.viewDialog=!0},async deleteLog(l){if(confirm("Are you sure you want to delete this login log?"))try{await this.$axios.delete(`/api/v1/login-logs/${l.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Login log deleted successfully"),await this.loadStatistics(),await this.loadLogs()}catch(t){this.handleApiError(t,"Error deleting login log")}},formatDate(l){return T(l)},truncateText(l,t){return l?l.length>t?l.substring(0,t)+"...":l:"-"}}},R={class:"d-flex align-center"},H={class:"text-h6"},O={class:"d-flex align-center"},j={class:"text-h6"},G={class:"d-flex align-center"},J={class:"text-h6"},K={class:"d-flex align-center"},Q={class:"text-h6"},W={class:"d-flex align-center"},X={class:"text-h6"},Y={class:"text-caption text-grey"},Z={class:"sortable-header"},$={class:"sortable-header"},tt={class:"sortable-header"},et={class:"sortable-header"},st={class:"d-flex"},lt={key:1,class:"text-grey"},ot=["title"],nt={key:0,class:"text-caption text-grey"},it={key:1},at={key:0},rt={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},dt={class:"text-caption text-grey"},ut={key:0},gt={key:0},mt={key:1},pt={key:1},ct={class:"mb-3"},ft={class:"mb-3"},vt={key:1,class:"text-grey ml-2"},_t={class:"mb-3"},yt={class:"mb-3"},wt={class:"mb-3"},ht={key:0,class:"text-grey ml-2"},kt={key:1,class:"text-grey ml-2"},Lt={class:"mb-3"},bt={key:0,class:"ml-2"},xt={key:1,class:"text-grey ml-2"},Pt={class:"mb-2"};function zt(l,t,St,Ct,d,v){const m=g("v-icon"),_=g("v-card-text"),y=g("v-card"),p=g("v-col"),h=g("v-row"),z=g("v-select"),S=g("v-text-field"),b=g("v-card-title"),f=g("v-skeleton-loader"),w=g("v-chip"),k=g("v-btn"),C=g("v-table"),D=g("PaginationControls"),V=g("v-textarea"),A=g("v-spacer"),U=g("v-card-actions"),F=g("v-dialog");return r(),u("div",null,[t[50]||(t[50]=e("div",{class:"page-header"},[e("h1",{class:"text-h4 page-title"},"Login Log Management")],-1)),s(h,{class:"mb-4"},{default:o(()=>[s(p,{cols:"12",md:"3"},{default:o(()=>[s(y,null,{default:o(()=>[s(_,null,{default:o(()=>[e("div",R,[s(m,{color:"primary",size:"40",class:"mr-3"},{default:o(()=>t[9]||(t[9]=[n("mdi-login")])),_:1,__:[9]}),e("div",null,[e("div",H,a(d.statistics.total||0),1),t[10]||(t[10]=e("div",{class:"text-caption text-grey"},"Total Logins",-1))])])]),_:1})]),_:1})]),_:1}),s(p,{cols:"12",md:"3"},{default:o(()=>[s(y,null,{default:o(()=>[s(_,null,{default:o(()=>[e("div",O,[s(m,{color:"success",size:"40",class:"mr-3"},{default:o(()=>t[11]||(t[11]=[n("mdi-check-circle")])),_:1,__:[11]}),e("div",null,[e("div",j,a(d.statistics.successful||0),1),t[12]||(t[12]=e("div",{class:"text-caption text-grey"},"Successful",-1))])])]),_:1})]),_:1})]),_:1}),s(p,{cols:"12",md:"3"},{default:o(()=>[s(y,null,{default:o(()=>[s(_,null,{default:o(()=>[e("div",G,[s(m,{color:"error",size:"40",class:"mr-3"},{default:o(()=>t[13]||(t[13]=[n("mdi-close-circle")])),_:1,__:[13]}),e("div",null,[e("div",J,a(d.statistics.failed||0),1),t[14]||(t[14]=e("div",{class:"text-caption text-grey"},"Failed",-1))])])]),_:1})]),_:1})]),_:1}),s(p,{cols:"12",md:"3"},{default:o(()=>[s(y,null,{default:o(()=>[s(_,null,{default:o(()=>[e("div",K,[s(m,{color:"info",size:"40",class:"mr-3"},{default:o(()=>t[15]||(t[15]=[n("mdi-account-group")])),_:1,__:[15]}),e("div",null,[e("div",Q,a(d.statistics.unique_users||0),1),t[16]||(t[16]=e("div",{class:"text-caption text-grey"},"Unique Users",-1))])])]),_:1})]),_:1})]),_:1}),s(p,{cols:"12",md:"3"},{default:o(()=>[s(y,null,{default:o(()=>[s(_,null,{default:o(()=>[e("div",W,[s(m,{color:"purple",size:"40",class:"mr-3"},{default:o(()=>t[17]||(t[17]=[n("mdi-database")])),_:1,__:[17]}),e("div",null,[e("div",X,a((l.pagination.total||0).toLocaleString()),1),t[18]||(t[18]=e("div",{class:"text-caption text-grey"},"Total Records",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),s(y,{class:"mb-4"},{default:o(()=>[s(_,null,{default:o(()=>[s(h,null,{default:o(()=>[s(p,{cols:"12",md:"4"},{default:o(()=>[s(z,{modelValue:d.statusFilter,"onUpdate:modelValue":[t[0]||(t[0]=i=>d.statusFilter=i),v.loadLogs],items:d.statusOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(p,{cols:"12",md:"8"},{default:o(()=>[s(S,{modelValue:l.search,"onUpdate:modelValue":t[1]||(t[1]=i=>l.search=i),label:"Search (email, IP, user agent)","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:v.loadLogs},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),s(y,null,{default:o(()=>[s(b,{class:"d-flex justify-space-between align-center"},{default:o(()=>[t[20]||(t[20]=e("span",null,"Login Logs",-1)),e("span",Y,[t[19]||(t[19]=n(" Total Records: ")),e("strong",null,a((l.pagination.total||0).toLocaleString()),1)])]),_:1,__:[20]}),s(_,null,{default:o(()=>[s(C,null,{default:o(()=>[e("thead",null,[e("tr",null,[e("th",{class:"sortable",onClick:t[2]||(t[2]=i=>l.onSort("email"))},[e("div",Z,[t[22]||(t[22]=e("span",null,"Email",-1)),l.sortBy==="email"?(r(),c(m,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[n(a(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),c(m,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[21]||(t[21]=[n(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),t[29]||(t[29]=e("th",null,"User",-1)),e("th",{class:"sortable",onClick:t[3]||(t[3]=i=>l.onSort("ip_address"))},[e("div",$,[t[24]||(t[24]=e("span",null,"IP Address",-1)),l.sortBy==="ip_address"?(r(),c(m,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[n(a(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),c(m,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[23]||(t[23]=[n(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),t[30]||(t[30]=e("th",null,"User Agent",-1)),e("th",{class:"sortable",onClick:t[4]||(t[4]=i=>l.onSort("status"))},[e("div",tt,[t[26]||(t[26]=e("span",null,"Status",-1)),l.sortBy==="status"?(r(),c(m,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[n(a(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),c(m,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[25]||(t[25]=[n(" mdi-unfold-more-horizontal ")])),_:1,__:[25]}))])]),t[31]||(t[31]=e("th",null,"Failure Reason",-1)),e("th",{class:"sortable",onClick:t[5]||(t[5]=i=>l.onSort("created_at"))},[e("div",et,[t[28]||(t[28]=e("span",null,"Date",-1)),l.sortBy==="created_at"?(r(),c(m,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[n(a(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(r(),c(m,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[27]||(t[27]=[n(" mdi-unfold-more-horizontal ")])),_:1,__:[27]}))])]),t[32]||(t[32]=e("th",null,"Actions",-1))])]),e("tbody",null,[l.loading?(r(),u(L,{key:0},x(5,i=>e("tr",{key:`skeleton-${i}`},[e("td",null,[s(f,{type:"text",width:"180"})]),e("td",null,[s(f,{type:"chip",width:"100",height:"24"})]),e("td",null,[s(f,{type:"chip",width:"120",height:"24"})]),e("td",null,[s(f,{type:"text",width:"200"})]),e("td",null,[s(f,{type:"chip",width:"80",height:"24"})]),e("td",null,[s(f,{type:"text",width:"120"})]),e("td",null,[s(f,{type:"text",width:"140"})]),e("td",null,[e("div",st,[s(f,{type:"button",width:"32",height:"32",class:"mr-1"}),s(f,{type:"button",width:"32",height:"32"})])])])),64)):(r(),u(L,{key:1},[(r(!0),u(L,null,x(d.logs,i=>(r(),u("tr",{key:i.id},[e("td",null,a(i.email),1),e("td",null,[i.user?(r(),c(w,{key:0,size:"small",color:"primary",variant:"text"},{default:o(()=>[n(a(i.user.name),1)]),_:2},1024)):(r(),u("span",lt,"-"))]),e("td",null,[s(w,{size:"small",variant:"outlined"},{default:o(()=>[n(a(i.ip_address||"-"),1)]),_:2},1024)]),e("td",null,[e("span",{class:"text-caption",title:i.user_agent},a(v.truncateText(i.user_agent,50)),9,ot)]),e("td",null,[s(w,{color:i.status==="success"?"success":"error",size:"small"},{default:o(()=>[n(a(i.status),1)]),_:2},1032,["color"])]),e("td",null,[i.failure_reason?(r(),u("span",nt,a(i.failure_reason),1)):(r(),u("span",it,"-"))]),e("td",null,a(v.formatDate(i.created_at)),1),e("td",null,[s(k,{size:"small",icon:"mdi-eye",onClick:B=>v.viewLog(i),variant:"text"},null,8,["onClick"]),s(k,{size:"small",icon:"mdi-delete",onClick:B=>v.deleteLog(i),variant:"text",color:"error"},null,8,["onClick"])])]))),128)),d.logs.length===0?(r(),u("tr",at,t[33]||(t[33]=[e("td",{colspan:"8",class:"text-center py-4"},"No login logs found",-1)]))):P("",!0)],64))])]),_:1}),e("div",rt,[e("div",dt,[d.logs.length>0&&l.pagination.total>0?(r(),u("span",ut,[l.perPage==="all"?(r(),u("span",gt,[t[34]||(t[34]=n(" Showing ")),e("strong",null,"all "+a(l.pagination.total.toLocaleString()),1),t[35]||(t[35]=n(" records "))])):(r(),u("span",mt,[t[36]||(t[36]=n(" Showing ")),e("strong",null,a((l.currentPage-1)*l.perPage+1),1),t[37]||(t[37]=n(" to ")),e("strong",null,a(Math.min(l.currentPage*l.perPage,l.pagination.total).toLocaleString()),1),t[38]||(t[38]=n(" of ")),e("strong",null,a(l.pagination.total.toLocaleString()),1),t[39]||(t[39]=n(" records "))]))])):(r(),u("span",pt,"No records found"))]),s(D,{modelValue:l.currentPage,"onUpdate:modelValue":t[6]||(t[6]=i=>l.currentPage=i),pagination:l.pagination,"per-page-value":l.perPage,"per-page-options":l.perPageOptions,"onUpdate:perPage":l.onPerPageUpdate,onPageChange:l.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),s(F,{modelValue:d.viewDialog,"onUpdate:modelValue":t[8]||(t[8]=i=>d.viewDialog=i),"max-width":"700"},{default:o(()=>[d.selectedLog?(r(),c(y,{key:0},{default:o(()=>[s(b,null,{default:o(()=>t[40]||(t[40]=[n("Login Log Details")])),_:1,__:[40]}),s(_,null,{default:o(()=>[s(h,null,{default:o(()=>[s(p,{cols:"12",md:"6"},{default:o(()=>[e("div",ct,[t[41]||(t[41]=e("strong",null,"Email:",-1)),n(" "+a(d.selectedLog.email),1)]),e("div",ft,[t[42]||(t[42]=e("strong",null,"User:",-1)),d.selectedLog.user?(r(),c(w,{key:0,size:"small",color:"primary",variant:"text",class:"ml-2"},{default:o(()=>[n(a(d.selectedLog.user.name)+" ("+a(d.selectedLog.user.email)+") ",1)]),_:1})):(r(),u("span",vt,"-"))]),e("div",_t,[t[43]||(t[43]=e("strong",null,"Status:",-1)),s(w,{color:d.selectedLog.status==="success"?"success":"error",size:"small",class:"ml-2"},{default:o(()=>[n(a(d.selectedLog.status),1)]),_:1},8,["color"])])]),_:1}),s(p,{cols:"12",md:"6"},{default:o(()=>[e("div",yt,[t[44]||(t[44]=e("strong",null,"IP Address:",-1)),n(" "+a(d.selectedLog.ip_address||"-"),1)]),e("div",wt,[t[45]||(t[45]=e("strong",null,"Failure Reason:",-1)),d.selectedLog.failure_reason?(r(),u("span",ht,a(d.selectedLog.failure_reason),1)):(r(),u("span",kt,"-"))]),e("div",Lt,[t[46]||(t[46]=e("strong",null,"Logged In At:",-1)),d.selectedLog.logged_in_at?(r(),u("span",bt,a(v.formatDate(d.selectedLog.logged_in_at)),1)):(r(),u("span",xt,"-"))])]),_:1}),s(p,{cols:"12"},{default:o(()=>[t[47]||(t[47]=e("div",{class:"mb-2"},[e("strong",null,"User Agent:")],-1)),s(V,{value:d.selectedLog.user_agent||"-",readonly:"",variant:"outlined",density:"compact",rows:"3"},null,8,["value"])]),_:1,__:[47]}),s(p,{cols:"12"},{default:o(()=>[e("div",Pt,[t[48]||(t[48]=e("strong",null,"Created At:",-1)),n(" "+a(v.formatDate(d.selectedLog.created_at)),1)])]),_:1})]),_:1})]),_:1}),s(U,null,{default:o(()=>[s(A),s(k,{onClick:t[7]||(t[7]=i=>d.viewDialog=!1),variant:"text"},{default:o(()=>t[49]||(t[49]=[n("Close")])),_:1,__:[49]})]),_:1})]),_:1})):P("",!0)]),_:1},8,["modelValue"])])}const Ft=q(M,[["render",zt]]);export{Ft as default};
