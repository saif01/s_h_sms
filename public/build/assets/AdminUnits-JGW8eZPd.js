import{_ as I,c,b as t,a as o,w as s,f as a,r as u,t as p,d as f,F as k,h as z,e as M,g as O,i as T,o as d}from"./app-CHfYI-xI.js";import{c as j}from"./commonMixin-BwIVv23E.js";import{P as K,p as C,d as _}from"./PaginationControls-6l2F_IVt.js";const G={name:"AdminUnits",components:{PaginationControls:K},mixins:[j],data(){return{units:[],dialog:!1,editingUnit:null,saving:!1,form:this.getEmptyForm(),rules:{required:n=>!!n||"This field is required"},currentPage:_.currentPage,perPage:_.perPage,perPageOptions:_.perPageOptions,pagination:{..._.pagination}}},mounted(){this.loadUnits()},methods:{getEmptyForm(){return{id:null,name:"",code:"",description:"",is_active:!0}},async loadUnits(){try{this.loading=!0;const n=this.buildPaginationParams();this.perPage==="all"&&(n.per_page=999999),this.search&&(n.search=this.search);const e=await this.$axios.get("/api/v1/units",{params:n,headers:this.getAuthHeaders()});this.units=e.data.data||e.data.units||[],e.data.total!==void 0||e.data.last_page!==void 0?this.updatePagination(e.data):this.pagination={current_page:1,last_page:1,per_page:this.units.length,total:this.units.length}}catch(n){console.error("Failed to fetch units",n),this.handleApiError(n,"Failed to load units")}finally{this.loading=!1}},openDialog(n){n?(this.editingUnit=n,this.form={id:n.id,name:n.name||"",code:n.code||"",description:n.description||"",is_active:n.is_active!==void 0?n.is_active:!0}):(this.editingUnit=null,this.form=this.getEmptyForm()),this.dialog=!0},closeDialog(){this.dialog=!1,this.editingUnit=null,this.form=this.getEmptyForm(),this.$refs.formRef&&this.$refs.formRef.resetValidation()},async saveUnit(){var n,e,y,P;if(this.$refs.formRef.validate()){this.saving=!0;try{const i=localStorage.getItem("admin_token"),r=this.editingUnit?`/api/v1/units/${this.editingUnit.id}`:"/api/v1/units",g=this.editingUnit?"put":"post",v={...this.form};await T[g](r,v,{headers:{Authorization:`Bearer ${i}`}}),this.showSuccess(this.editingUnit?"Unit updated successfully":"Unit created successfully"),this.closeDialog(),await this.loadUnits()}catch(i){console.error("Error saving unit:",i);let r="Error saving unit";if((e=(n=i.response)==null?void 0:n.data)!=null&&e.errors){const g=i.response.data.errors,v=[];Object.keys(g).forEach(b=>{v.push(g[b][0])}),r=v.join(", ")}else(P=(y=i.response)==null?void 0:y.data)!=null&&P.message&&(r=i.response.data.message);this.showError(r)}finally{this.saving=!1}}},async deleteUnit(n){if(confirm(`Are you sure you want to delete ${n.name}?`))try{await this.$axios.delete(`/api/v1/units/${n.id}`,{headers:this.getAuthHeaders()}),this.showSuccess("Unit deleted successfully"),await this.loadUnits()}catch(e){this.handleApiError(e,"Error deleting unit")}},buildPaginationParams(n={}){return C.buildPaginationParams(this.currentPage,this.perPage,n,this.sortBy,this.sortDirection)},updatePagination(n){C.updatePagination(this,n)},resetPagination(){C.resetPagination(this)},onPerPageChange(){this.resetPagination(),this.loadUnits()},onPerPageUpdate(n){this.perPage=n,this.onPerPageChange()},onPageChange(n){this.currentPage=n,this.loadUnits()},onSort(n){this.handleSort(n),this.currentPage=1,this.loadUnits()}}},H={class:"page-header"},J={class:"text-caption text-grey"},Q={class:"sortable-header"},W={class:"sortable-header"},X={class:"sortable-header"},Y={class:"sortable-header"},Z={class:"sortable-header"},$={class:"d-flex"},ee={class:"d-flex align-center"},te={key:0},ne={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},ie={class:"text-caption text-grey"},oe={key:0},se={key:0},le={key:1},ae={key:1},re={class:"pa-6"};function de(n,e,y,P,i,r){const g=u("v-btn"),v=u("v-text-field"),b=u("v-col"),S=u("v-row"),w=u("v-card-text"),U=u("v-card"),V=u("v-card-title"),m=u("v-icon"),h=u("v-skeleton-loader"),x=u("v-chip"),E=u("v-table"),D=u("PaginationControls"),A=u("v-textarea"),B=u("v-switch"),N=u("v-form"),F=u("v-spacer"),R=u("v-card-actions"),q=u("v-dialog");return d(),c("div",null,[t("div",H,[e[14]||(e[14]=t("h1",{class:"text-h4 page-title"},"Unit Management",-1)),o(g,{color:"primary","prepend-icon":"mdi-plus",onClick:e[0]||(e[0]=l=>r.openDialog(null)),class:"add-button"},{default:s(()=>e[13]||(e[13]=[a(" Add New Unit ")])),_:1,__:[13]})]),o(U,{class:"mb-4"},{default:s(()=>[o(w,null,{default:s(()=>[o(S,null,{default:s(()=>[o(b,{cols:"12",md:"8"},{default:s(()=>[o(v,{modelValue:n.search,"onUpdate:modelValue":e[1]||(e[1]=l=>n.search=l),label:"Search by name, code","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:r.loadUnits},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(U,null,{default:s(()=>[o(V,{class:"d-flex justify-space-between align-center"},{default:s(()=>[e[16]||(e[16]=t("span",null,"Units",-1)),t("span",J,[e[15]||(e[15]=a(" Total Records: ")),t("strong",null,p(i.pagination.total||0),1)])]),_:1,__:[16]}),o(w,null,{default:s(()=>[o(E,null,{default:s(()=>[t("thead",null,[t("tr",null,[t("th",{class:"sortable",onClick:e[2]||(e[2]=l=>r.onSort("name"))},[t("div",Q,[e[18]||(e[18]=t("span",null,"Name",-1)),n.sortBy==="name"?(d(),f(m,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[a(p(n.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),f(m,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[17]||(e[17]=[a(" mdi-unfold-more-horizontal ")])),_:1,__:[17]}))])]),t("th",{class:"sortable",onClick:e[3]||(e[3]=l=>r.onSort("code"))},[t("div",W,[e[20]||(e[20]=t("span",null,"Code",-1)),n.sortBy==="code"?(d(),f(m,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[a(p(n.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),f(m,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[19]||(e[19]=[a(" mdi-unfold-more-horizontal ")])),_:1,__:[19]}))])]),t("th",{class:"sortable",onClick:e[4]||(e[4]=l=>r.onSort("description"))},[t("div",X,[e[22]||(e[22]=t("span",null,"Description",-1)),n.sortBy==="description"?(d(),f(m,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[a(p(n.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),f(m,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[21]||(e[21]=[a(" mdi-unfold-more-horizontal ")])),_:1,__:[21]}))])]),t("th",{class:"sortable",onClick:e[5]||(e[5]=l=>r.onSort("is_active"))},[t("div",Y,[e[24]||(e[24]=t("span",null,"Status",-1)),n.sortBy==="is_active"?(d(),f(m,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[a(p(n.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),f(m,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[23]||(e[23]=[a(" mdi-unfold-more-horizontal ")])),_:1,__:[23]}))])]),t("th",{class:"sortable",onClick:e[6]||(e[6]=l=>r.onSort("created_at"))},[t("div",Z,[e[26]||(e[26]=t("span",null,"Created",-1)),n.sortBy==="created_at"?(d(),f(m,{key:0,size:"18",class:"sort-icon active"},{default:s(()=>[a(p(n.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(d(),f(m,{key:1,size:"18",class:"sort-icon inactive"},{default:s(()=>e[25]||(e[25]=[a(" mdi-unfold-more-horizontal ")])),_:1,__:[25]}))])]),e[27]||(e[27]=t("th",null,"Actions",-1))])]),t("tbody",null,[n.loading?(d(),c(k,{key:0},z(5,l=>t("tr",{key:`skeleton-${l}`},[t("td",null,[o(h,{type:"text",width:"150"})]),t("td",null,[o(h,{type:"text",width:"80"})]),t("td",null,[o(h,{type:"text",width:"200"})]),t("td",null,[o(h,{type:"chip",width:"80",height:"24"})]),t("td",null,[o(h,{type:"text",width:"100"})]),t("td",null,[t("div",$,[o(h,{type:"button",width:"32",height:"32",class:"mr-1"}),o(h,{type:"button",width:"32",height:"32"})])])])),64)):(d(),c(k,{key:1},[(d(!0),c(k,null,z(i.units,l=>(d(),c("tr",{key:l.id},[t("td",null,[t("div",ee,[o(m,{size:"small",color:"primary",class:"mr-2"},{default:s(()=>e[28]||(e[28]=[a(" mdi-weight-kilogram ")])),_:1,__:[28]}),a(" "+p(l.name),1)])]),t("td",null,[o(x,{size:"small",variant:"outlined"},{default:s(()=>[a(p(l.code),1)]),_:2},1024)]),t("td",null,p(l.description||"-"),1),t("td",null,[o(x,{color:l.is_active?"success":"error",size:"small"},{default:s(()=>[a(p(l.is_active?"Active":"Inactive"),1)]),_:2},1032,["color"])]),t("td",null,p(n.formatDate(l.created_at)),1),t("td",null,[o(g,{size:"small",icon:"mdi-pencil",onClick:L=>r.openDialog(l),variant:"text",title:"Edit Unit"},null,8,["onClick"]),o(g,{size:"small",icon:"mdi-delete",onClick:L=>r.deleteUnit(l),variant:"text",color:"error",title:"Delete Unit"},null,8,["onClick"])])]))),128)),i.units.length===0?(d(),c("tr",te,e[29]||(e[29]=[t("td",{colspan:"6",class:"text-center py-4"},"No units found",-1)]))):M("",!0)],64))])]),_:1}),t("div",ne,[t("div",ie,[i.units.length>0&&i.pagination.total>0?(d(),c("span",oe,[i.perPage==="all"?(d(),c("span",se,[e[30]||(e[30]=a(" Showing ")),t("strong",null,"all "+p(i.pagination.total.toLocaleString()),1),e[31]||(e[31]=a(" records "))])):(d(),c("span",le,[e[32]||(e[32]=a(" Showing ")),t("strong",null,p((i.currentPage-1)*i.perPage+1),1),e[33]||(e[33]=a(" to ")),t("strong",null,p(Math.min(i.currentPage*i.perPage,i.pagination.total)),1),e[34]||(e[34]=a(" of ")),t("strong",null,p(i.pagination.total.toLocaleString()),1),e[35]||(e[35]=a(" records "))]))])):(d(),c("span",ae,"No records found"))]),o(D,{modelValue:i.currentPage,"onUpdate:modelValue":e[7]||(e[7]=l=>i.currentPage=l),pagination:i.pagination,"per-page-value":i.perPage,"per-page-options":i.perPageOptions,"onUpdate:perPage":r.onPerPageUpdate,onPageChange:r.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),o(q,{modelValue:i.dialog,"onUpdate:modelValue":e[12]||(e[12]=l=>i.dialog=l),"max-width":"700",scrollable:"",persistent:""},{default:s(()=>[o(U,null,{default:s(()=>[o(V,null,{default:s(()=>[a(p(i.editingUnit?"Edit Unit":"Add New Unit"),1)]),_:1}),o(w,{class:"pa-0"},{default:s(()=>[o(N,{ref:"formRef",onSubmit:O(r.saveUnit,["prevent"])},{default:s(()=>[t("div",re,[o(v,{modelValue:i.form.name,"onUpdate:modelValue":e[8]||(e[8]=l=>i.form.name=l),placeholder:"Enter unit name (e.g., Kilogram, Piece, Liter)",rules:[i.rules.required],required:"",variant:"outlined",density:"comfortable","hide-details":"auto",hint:"Enter the full name of the measurement unit","persistent-hint":"",class:"mb-4"},{label:s(()=>e[36]||(e[36]=[a(" Unit Name "),t("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","rules"]),o(v,{modelValue:i.form.code,"onUpdate:modelValue":e[9]||(e[9]=l=>i.form.code=l),placeholder:"Enter unit code (e.g., KG, PCS, LTR)",hint:"Short code or abbreviation for the unit (e.g., KG, PCS, LTR)","persistent-hint":"",rules:[i.rules.required],required:"",variant:"outlined",density:"comfortable","hide-details":"auto",class:"mb-4"},{label:s(()=>e[37]||(e[37]=[a(" Code "),t("span",{class:"text-error",style:{"font-size":"1.2em","font-weight":"bold"}},"*",-1)])),_:1},8,["modelValue","rules"]),o(A,{modelValue:i.form.description,"onUpdate:modelValue":e[10]||(e[10]=l=>i.form.description=l),label:"Description",placeholder:"Enter a brief description about the unit (optional)",variant:"outlined",density:"comfortable",rows:"3",hint:"Optional: Brief description about the unit","persistent-hint":"","hide-details":"auto",class:"mb-4"},null,8,["modelValue"]),o(B,{modelValue:i.form.is_active,"onUpdate:modelValue":e[11]||(e[11]=l=>i.form.is_active=l),label:"Active Unit",color:"success",class:"mb-4"},null,8,["modelValue"])])]),_:1},8,["onSubmit"])]),_:1}),o(R,null,{default:s(()=>[o(F),o(g,{onClick:r.closeDialog,variant:"text"},{default:s(()=>e[38]||(e[38]=[a("Cancel")])),_:1,__:[38]},8,["onClick"]),o(g,{onClick:r.saveUnit,color:"primary",loading:i.saving},{default:s(()=>[a(p(i.editingUnit?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])])}const ge=I(G,[["render",de],["__scopeId","data-v-8728b89f"]]);export{ge as default};
