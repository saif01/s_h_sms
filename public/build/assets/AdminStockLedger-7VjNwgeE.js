import{a as O}from"./adminPaginationMixin-DN7Wb3ng.js";import{_ as D,c as p,b as l,a as o,w as r,r as d,f as c,e as y,t as s,F as v,h as T,o as m}from"./app-CHlE1Mvy.js";const I={mixins:[O],data(){return{ledgers:[],products:[],warehouses:[],productFilter:null,productOptions:[],warehouseFilter:null,warehouseOptions:[],typeFilter:null,typeOptions:[{title:"Stock In",value:"in"},{title:"Stock Out",value:"out"}],referenceTypeFilter:null,referenceTypeOptions:[{title:"Purchase",value:"purchase"},{title:"Sales",value:"sales"},{title:"Return",value:"return"},{title:"Damage",value:"damage"},{title:"Lost",value:"lost"}],dateFrom:null,dateTo:null}},async mounted(){await this.loadProducts(),await this.loadWarehouses(),await this.loadLedger()},methods:{async loadLedger(){try{this.loading=!0;const t=this.buildPaginationParams();this.search&&(t.search=this.search),this.productFilter&&(t.product_id=this.productFilter),this.warehouseFilter&&(t.warehouse_id=this.warehouseFilter),this.typeFilter&&(t.type=this.typeFilter),this.referenceTypeFilter&&(t.reference_type=this.referenceTypeFilter),this.dateFrom&&(t.date_from=this.dateFrom),this.dateTo&&(t.date_to=this.dateTo);const e=await this.$axios.get("/api/v1/stock-ledger",{params:t,headers:this.getAuthHeaders()});this.ledgers=e.data.data||[],this.updatePagination(e.data)}catch(t){this.handleApiError(t,"Failed to load stock ledger")}finally{this.loading=!1}},async loadProducts(){try{const t=await this.$axios.get("/api/v1/products",{params:{per_page:1e3},headers:this.getAuthHeaders()});this.products=t.data.data||[],this.productOptions=this.products.map(e=>({title:`${e.name} (${e.sku})`,value:e.id}))}catch(t){console.error("Error loading products:",t)}},async loadWarehouses(){try{const t=await this.$axios.get("/api/v1/stock-ledger/warehouses",{headers:this.getAuthHeaders()});this.warehouses=t.data.warehouses||[],this.warehouseOptions=this.warehouses.map(e=>({title:e.label,value:e.value}))}catch(t){console.error("Error loading warehouses:",t)}},formatReferenceType(t){return{purchase:"Purchase",sales:"Sales",return:"Return",damage:"Damage",lost:"Lost"}[t]||t},formatCurrency(t){return t==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(t)},onPerPageChange(){this.resetPagination(),this.loadLedger()},onSort(t){this.handleSort(t),this.loadLedger()}}},N={class:"text-caption text-grey"},R={key:0},A={class:"d-flex align-center"},B={class:"d-flex align-center"},z={class:"d-flex flex-column"},E={class:"font-weight-medium"},M={class:"text-caption text-grey"},W={class:"d-flex flex-column"},q={class:"text-body-2"},H={class:"text-caption text-grey"},j={class:"text-right"},Q={class:"text-right"},G={class:"text-right"},J={class:"text-right"},K={key:0},X={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},Y={class:"text-caption text-grey"},Z={key:0},$={key:1},ee={key:0,class:"d-flex align-center gap-2"};function te(t,e,le,oe,a,i){const h=d("v-select"),g=d("v-col"),f=d("v-text-field"),U=d("v-row"),w=d("v-card-text"),_=d("v-card"),S=d("v-card-title"),b=d("v-icon"),u=d("v-skeleton-loader"),V=d("v-chip"),L=d("v-table"),C=d("v-pagination");return m(),p("div",null,[e[28]||(e[28]=l("div",{class:"page-header"},[l("h1",{class:"text-h4 page-title"},"Stock Ledger")],-1)),o(_,{class:"mb-4"},{default:r(()=>[o(w,null,{default:r(()=>[o(U,null,{default:r(()=>[o(g,{cols:"12",md:"3"},{default:r(()=>[o(h,{modelValue:t.perPage,"onUpdate:modelValue":[e[0]||(e[0]=n=>t.perPage=n),i.onPerPageChange],items:t.perPageOptions,label:"Items per page","prepend-inner-icon":"mdi-format-list-numbered",variant:"outlined",density:"compact"},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(g,{cols:"12",md:"3"},{default:r(()=>[o(h,{modelValue:a.productFilter,"onUpdate:modelValue":[e[1]||(e[1]=n=>a.productFilter=n),i.loadLedger],items:a.productOptions,label:"Filter by Product",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(g,{cols:"12",md:"3"},{default:r(()=>[o(h,{modelValue:a.warehouseFilter,"onUpdate:modelValue":[e[2]||(e[2]=n=>a.warehouseFilter=n),i.loadLedger],items:a.warehouseOptions,label:"Filter by Warehouse",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(g,{cols:"12",md:"3"},{default:r(()=>[o(h,{modelValue:a.typeFilter,"onUpdate:modelValue":[e[3]||(e[3]=n=>a.typeFilter=n),i.loadLedger],items:a.typeOptions,label:"Filter by Type",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(g,{cols:"12",md:"3"},{default:r(()=>[o(h,{modelValue:a.referenceTypeFilter,"onUpdate:modelValue":[e[4]||(e[4]=n=>a.referenceTypeFilter=n),i.loadLedger],items:a.referenceTypeOptions,label:"Filter by Reference",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),o(g,{cols:"12",md:"3"},{default:r(()=>[o(f,{modelValue:a.dateFrom,"onUpdate:modelValue":[e[5]||(e[5]=n=>a.dateFrom=n),i.loadLedger],label:"Date From",type:"date",variant:"outlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(g,{cols:"12",md:"3"},{default:r(()=>[o(f,{modelValue:a.dateTo,"onUpdate:modelValue":[e[6]||(e[6]=n=>a.dateTo=n),i.loadLedger],label:"Date To",type:"date",variant:"outlined",density:"compact"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),o(g,{cols:"12",md:"3"},{default:r(()=>[o(f,{modelValue:t.search,"onUpdate:modelValue":e[7]||(e[7]=n=>t.search=n),label:"Search by reference number or product","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:i.loadLedger},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),o(_,null,{default:r(()=>[o(S,{class:"d-flex justify-space-between align-center"},{default:r(()=>[e[12]||(e[12]=l("span",null,"Stock Movements",-1)),l("span",N,[e[11]||(e[11]=c(" Total Records: ")),l("strong",null,s(t.pagination.total||0),1),a.ledgers.length>0?(m(),p("span",R," | Showing "+s((t.currentPage-1)*t.perPage+1)+" to "+s(Math.min(t.currentPage*t.perPage,t.pagination.total))+" of "+s(t.pagination.total),1)):y("",!0)])]),_:1,__:[12]}),o(w,null,{default:r(()=>[o(L,null,{default:r(()=>[l("thead",null,[l("tr",null,[l("th",{class:"sortable",onClick:e[8]||(e[8]=n=>i.onSort("transaction_date"))},[l("div",A,[e[13]||(e[13]=c(" Date ")),o(b,{icon:t.getSortIcon("transaction_date"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[15]||(e[15]=l("th",null,"Product",-1)),e[16]||(e[16]=l("th",null,"Warehouse",-1)),e[17]||(e[17]=l("th",null,"Type",-1)),e[18]||(e[18]=l("th",null,"Reference",-1)),l("th",{class:"sortable",onClick:e[9]||(e[9]=n=>i.onSort("quantity"))},[l("div",B,[e[14]||(e[14]=c(" Quantity ")),o(b,{icon:t.getSortIcon("quantity"),size:"small",class:"ml-1"},null,8,["icon"])])]),e[19]||(e[19]=l("th",null,"Unit Cost",-1)),e[20]||(e[20]=l("th",null,"Total Cost",-1)),e[21]||(e[21]=l("th",null,"Balance After",-1)),e[22]||(e[22]=l("th",null,"Created By",-1))])]),l("tbody",null,[t.loading?(m(),p(v,{key:0},T(5,n=>l("tr",{key:`skeleton-${n}`},[l("td",null,[o(u,{type:"text",width:"100"})]),l("td",null,[o(u,{type:"text",width:"150"})]),l("td",null,[o(u,{type:"text",width:"120"})]),l("td",null,[o(u,{type:"chip",width:"80",height:"24"})]),l("td",null,[o(u,{type:"text",width:"120"})]),l("td",null,[o(u,{type:"text",width:"80"})]),l("td",null,[o(u,{type:"text",width:"80"})]),l("td",null,[o(u,{type:"text",width:"80"})]),l("td",null,[o(u,{type:"text",width:"80"})]),l("td",null,[o(u,{type:"text",width:"100"})])])),64)):(m(),p(v,{key:1},[(m(!0),p(v,null,T(a.ledgers,n=>{var F,P,k,x;return m(),p("tr",{key:n.id},[l("td",null,s(t.formatDate(n.transaction_date)),1),l("td",null,[l("div",z,[l("span",E,s((F=n.product)==null?void 0:F.name),1),l("span",M,s((P=n.product)==null?void 0:P.sku),1)])]),l("td",null,s((k=n.warehouse)==null?void 0:k.name),1),l("td",null,[o(V,{color:n.type==="in"?"success":"error",size:"small"},{default:r(()=>[c(s(n.type==="in"?"IN":"OUT"),1)]),_:2},1032,["color"])]),l("td",null,[l("div",W,[l("span",q,s(i.formatReferenceType(n.reference_type)),1),l("span",H,s(n.reference_number||"-"),1)])]),l("td",j,s(n.quantity),1),l("td",Q,s(i.formatCurrency(n.unit_cost)),1),l("td",G,s(i.formatCurrency(n.total_cost)),1),l("td",J,[o(V,{size:"small",color:n.balance_after<0?"error":"default"},{default:r(()=>[c(s(n.balance_after),1)]),_:2},1032,["color"])]),l("td",null,s(((x=n.creator)==null?void 0:x.name)||"-"),1)])}),128)),a.ledgers.length===0?(m(),p("tr",K,e[23]||(e[23]=[l("td",{colspan:"10",class:"text-center py-4"},"No stock movements found",-1)]))):y("",!0)],64))])]),_:1}),l("div",X,[l("div",Y,[a.ledgers.length>0&&t.pagination.total>0?(m(),p("span",Z,[e[24]||(e[24]=c(" Showing ")),l("strong",null,s((t.currentPage-1)*t.perPage+1),1),e[25]||(e[25]=c(" to ")),l("strong",null,s(Math.min(t.currentPage*t.perPage,t.pagination.total)),1),e[26]||(e[26]=c(" of ")),l("strong",null,s(t.pagination.total.toLocaleString()),1),e[27]||(e[27]=c(" records "))])):(m(),p("span",$,"No records found"))]),t.pagination.last_page>1?(m(),p("div",ee,[o(C,{modelValue:t.currentPage,"onUpdate:modelValue":[e[10]||(e[10]=n=>t.currentPage=n),i.loadLedger],length:t.pagination.last_page,"total-visible":7,density:"comfortable"},null,8,["modelValue","length","onUpdate:modelValue"])])):y("",!0)])]),_:1})]),_:1})])}const se=D(I,[["render",te],["__scopeId","data-v-34e140bd"]]);export{se as default};
