import{c as H}from"./commonMixin-BwIVv23E.js";import{D as L}from"./DatePickerVuetifyInput-D8pENmvL.js";import{_ as M,d as v,w as o,a as s,r as u,b as e,t as r,g as W,f as p,c as _,e as y,h as E,F as N,o as c,p as R}from"./app-BqLCFCMY.js";import{P as Q,p as j}from"./PaginationControls-DoA1lTDa.js";const G={name:"PurchaseDialog",components:{DatePickerVuetifyInput:L},props:{modelValue:{type:Boolean,default:!1},editingPurchase:{type:Object,default:null},supplierOptions:{type:Array,default:()=>[]},warehouseOptions:{type:Array,default:()=>[]},grnOptions:{type:Array,default:()=>[]},productOptions:{type:Array,default:()=>[]},saving:{type:Boolean,default:!1}},emits:["update:modelValue","save","cancel"],data(){return{activeTab:"basic",localForm:{supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},rules:{required:l=>!!l||"This field is required",minValue:l=>l>0||"Quantity must be greater than 0"}}},computed:{calculatedSubtotal(){return this.localForm.items.reduce((l,t)=>l+(t.quantity||0)*(t.unit_price||0),0)},calculatedTax(){return this.localForm.items.reduce((l,t)=>l+(t.tax||0),0)},calculatedDiscount(){return this.localForm.items.reduce((l,t)=>l+(t.discount||0),0)},calculatedTotal(){return this.calculatedSubtotal+this.calculatedTax+(this.localForm.shipping_cost||0)-this.calculatedDiscount},validProductOptions(){if(!Array.isArray(this.productOptions))return console.warn("ProductOptions is not an array:",this.productOptions),[];if(this.productOptions.length===0)return console.warn("ProductOptions is empty"),[];const l=this.productOptions.filter(t=>{const i=t&&(t.label||t.title),I=t&&t.value!==void 0&&t.value!==null;return i&&I});return l.length===0&&this.productOptions.length>0&&console.warn("No valid product options found. ProductOptions:",this.productOptions),l}},watch:{modelValue(l){l&&this.editingPurchase?this.initializeForm(this.editingPurchase):l&&this.resetForm()},editingPurchase:{handler(l){l&&this.modelValue&&this.initializeForm(l)},deep:!0},productOptions:{handler(l){l&&Array.isArray(l)&&l.length>0&&console.log("ProductOptions updated:",l.length,"products")},immediate:!0}},methods:{initializeForm(l){var t;this.activeTab="basic",this.localForm={supplier_id:l.supplier_id,warehouse_id:l.warehouse_id,grn_id:l.grn_id,invoice_date:l.invoice_date?l.invoice_date.includes("T")?l.invoice_date.split("T")[0]:l.invoice_date:new Date().toISOString().split("T")[0],due_date:l.due_date?l.due_date.includes("T")?l.due_date.split("T")[0]:l.due_date:null,shipping_cost:l.shipping_cost||0,notes:l.notes||"",items:((t=l.items)==null?void 0:t.map(i=>({product_id:i.product_id,quantity:i.quantity,unit_price:i.unit_price,discount:i.discount||0,tax:i.tax||0,total:i.total||0})))||[]}},resetForm(){this.activeTab="basic",this.localForm={supplier_id:null,warehouse_id:null,grn_id:null,invoice_date:new Date().toISOString().split("T")[0],due_date:null,shipping_cost:0,notes:"",items:[]},this.$refs.form&&this.$refs.form.resetValidation()},calculateItemTotal(l){const t=this.localForm.items[l];if(t.quantity&&t.unit_price){const i=t.quantity*t.unit_price-(t.discount||0)+(t.tax||0);this.$set(this.localForm.items[l],"total",i)}},calculateTotals(){},addPurchaseItem(){this.localForm.items.push({product_id:null,quantity:1,unit_price:0,discount:0,tax:0,total:0})},removePurchaseItem(l){this.localForm.items.splice(l,1)},handleSave(){if(!this.$refs.form.validate())return;if(this.localForm.items.length===0){this.$emit("save",{...this.localForm},"Please add at least one item");return}const l={...this.localForm,subtotal:this.calculatedSubtotal,tax_amount:this.calculatedTax,discount_amount:this.calculatedDiscount,shipping_cost:this.localForm.shipping_cost||0,items:this.localForm.items.map(t=>({product_id:t.product_id,quantity:t.quantity,unit_price:t.unit_price,discount:t.discount||0,tax:t.tax||0,notes:t.notes||null}))};this.$emit("save",l,null)},handleCancel(){this.resetForm(),this.$emit("cancel")},formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)}}},K={class:"text-h6"},J={class:"pa-3"},X={class:"pa-3"},Y={class:"d-flex justify-space-between align-center mb-2"},Z={class:"pa-1"},$={class:"pa-1"},tt={class:"pa-1"},et={class:"pa-1"},lt={class:"pa-1"},st={class:"text-body-2 font-weight-medium text-end"},at={class:"text-center"},ot={key:0},nt={key:1,class:"summary-row"},it={class:"text-body-2 font-weight-bold text-end"},rt={key:2},ut={class:"text-caption text-end"},dt={key:3},ct={class:"text-caption text-end"},mt={key:4},pt={class:"text-caption text-end"},ht={key:5,class:"total-row"},_t={class:"text-body-1 font-weight-bold text-end"};function vt(l,t,i,I,a,n){const k=u("v-card-title"),C=u("v-tab"),g=u("v-tabs"),x=u("v-select"),P=u("v-col"),S=u("DatePickerVuetifyInput"),V=u("v-text-field"),T=u("v-textarea"),w=u("v-row"),b=u("v-window-item"),F=u("v-btn"),U=u("v-table"),h=u("v-window"),A=u("v-form"),O=u("v-card-text"),d=u("v-spacer"),q=u("v-card-actions"),B=u("v-card"),z=u("v-dialog");return c(),v(z,{"model-value":i.modelValue,"onUpdate:modelValue":t[9]||(t[9]=m=>l.$emit("update:modelValue",m)),"max-width":"1200px",scrollable:"",persistent:""},{default:o(()=>[s(B,null,{default:o(()=>[s(k,{class:"pa-3 d-flex justify-space-between align-center"},{default:o(()=>[e("span",K,r(i.editingPurchase?"Edit Purchase Invoice":"New Purchase Invoice"),1)]),_:1}),s(O,{class:"pa-0"},{default:o(()=>[s(A,{ref:"form",onSubmit:W(n.handleSave,["prevent"])},{default:o(()=>[s(g,{modelValue:a.activeTab,"onUpdate:modelValue":t[0]||(t[0]=m=>a.activeTab=m),"bg-color":"grey-lighten-4"},{default:o(()=>[s(C,{value:"basic"},{default:o(()=>t[10]||(t[10]=[p("Basic Information")])),_:1,__:[10]}),s(C,{value:"items"},{default:o(()=>t[11]||(t[11]=[p("Items")])),_:1,__:[11]})]),_:1},8,["modelValue"]),s(h,{modelValue:a.activeTab,"onUpdate:modelValue":t[8]||(t[8]=m=>a.activeTab=m)},{default:o(()=>[s(b,{value:"basic"},{default:o(()=>[e("div",J,[s(w,{dense:"",class:"ma-0"},{default:o(()=>[s(P,{cols:"12",md:"6",class:"pa-2"},{default:o(()=>[s(x,{modelValue:a.localForm.supplier_id,"onUpdate:modelValue":t[1]||(t[1]=m=>a.localForm.supplier_id=m),items:i.supplierOptions,"item-title":"label","item-value":"value",label:"Supplier",density:"compact",variant:"outlined","hide-details":"auto",rules:[a.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),s(P,{cols:"12",md:"6",class:"pa-2"},{default:o(()=>[s(x,{modelValue:a.localForm.warehouse_id,"onUpdate:modelValue":t[2]||(t[2]=m=>a.localForm.warehouse_id=m),items:i.warehouseOptions,"item-title":"label","item-value":"value",label:"Warehouse",density:"compact",variant:"outlined","hide-details":"auto",rules:[a.rules.required],required:""},null,8,["modelValue","items","rules"])]),_:1}),s(P,{cols:"12",md:"6",class:"pa-2"},{default:o(()=>[s(x,{modelValue:a.localForm.grn_id,"onUpdate:modelValue":t[3]||(t[3]=m=>a.localForm.grn_id=m),items:i.grnOptions,"item-title":"label","item-value":"value",label:"GRN (Optional)",density:"compact",variant:"outlined","hide-details":"auto",clearable:""},null,8,["modelValue","items"])]),_:1}),s(P,{cols:"12",md:"6",class:"pa-2"},{default:o(()=>[s(S,{"field-label":"Invoice Date",required:"true",variant:"outlined","initial-date":a.localForm.invoice_date,onTrigerInputValue:t[4]||(t[4]=m=>{a.localForm.invoice_date=m})},null,8,["initial-date"]),t[12]||(t[12]=e("div",{class:"text-caption text-grey mt-1 ml-2"},[e("span",{class:"text-error",style:{"font-size":"1.1em","font-weight":"bold"}},"*"),p(" Select the invoice date ")],-1))]),_:1,__:[12]}),s(P,{cols:"12",md:"6",class:"pa-2"},{default:o(()=>[s(S,{"field-label":"Due Date",variant:"outlined","initial-date":a.localForm.due_date,onTrigerInputValue:t[5]||(t[5]=m=>{a.localForm.due_date=m})},null,8,["initial-date"]),t[13]||(t[13]=e("div",{class:"text-caption text-grey mt-1 ml-2"}," Optional: Select payment due date ",-1))]),_:1,__:[13]}),s(P,{cols:"12",md:"6",class:"pa-2"},{default:o(()=>[s(V,{modelValue:a.localForm.shipping_cost,"onUpdate:modelValue":t[6]||(t[6]=m=>a.localForm.shipping_cost=m),modelModifiers:{number:!0},label:"Shipping Cost",type:"number",min:"0",step:"0.01",prefix:"৳",density:"compact",variant:"outlined","hide-details":"auto",onInput:n.calculateTotals},null,8,["modelValue","onInput"])]),_:1}),s(P,{cols:"12",class:"pa-2"},{default:o(()=>[s(T,{modelValue:a.localForm.notes,"onUpdate:modelValue":t[7]||(t[7]=m=>a.localForm.notes=m),label:"Notes",variant:"outlined",density:"compact",rows:"2","hide-details":"auto"},null,8,["modelValue"])]),_:1})]),_:1})])]),_:1}),s(b,{value:"items"},{default:o(()=>[e("div",X,[e("div",Y,[t[15]||(t[15]=e("span",{class:"text-body-1 font-weight-medium"},"Invoice Items",-1)),s(F,{size:"small",color:"primary","prepend-icon":"mdi-plus",density:"compact",onClick:n.addPurchaseItem},{default:o(()=>t[14]||(t[14]=[p("Add Item")])),_:1,__:[14]},8,["onClick"])]),s(U,{density:"compact",class:"items-table"},{default:o(()=>[t[27]||(t[27]=e("thead",null,[e("tr",null,[e("th",{class:"text-caption"},"Product"),e("th",{class:"text-caption text-center",style:{width:"80px"}},"Qty"),e("th",{class:"text-caption text-end",style:{width:"100px"}},"Unit Price"),e("th",{class:"text-caption text-end",style:{width:"90px"}},"Discount"),e("th",{class:"text-caption text-end",style:{width:"90px"}},"Tax"),e("th",{class:"text-caption text-end",style:{width:"110px"}},"Total"),e("th",{class:"text-caption",style:{width:"50px"}})])],-1)),e("tbody",null,[(c(!0),_(N,null,E(a.localForm.items,(m,D)=>(c(),_("tr",{key:D},[e("td",Z,[s(x,{modelValue:m.product_id,"onUpdate:modelValue":[f=>m.product_id=f,f=>n.calculateItemTotal(D)],items:n.validProductOptions,"item-title":"label","item-value":"value",label:"Product",placeholder:"Select product",density:"compact",variant:"outlined","hide-details":"auto","menu-props":{maxHeight:400,offset:!0,attach:"body",zIndex:9999},rules:[a.rules.required],clearable:"","no-data-text":"No products available"},null,8,["modelValue","onUpdate:modelValue","items","rules"])]),e("td",$,[s(V,{modelValue:m.quantity,"onUpdate:modelValue":f=>m.quantity=f,modelModifiers:{number:!0},type:"number",min:"1",density:"compact",variant:"outlined","hide-details":"",onInput:f=>n.calculateItemTotal(D),rules:[a.rules.required,a.rules.minValue]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),e("td",tt,[s(V,{modelValue:m.unit_price,"onUpdate:modelValue":f=>m.unit_price=f,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",variant:"outlined","hide-details":"",onInput:f=>n.calculateItemTotal(D),rules:[a.rules.required]},null,8,["modelValue","onUpdate:modelValue","onInput","rules"])]),e("td",et,[s(V,{modelValue:m.discount,"onUpdate:modelValue":f=>m.discount=f,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",variant:"outlined","hide-details":"",onInput:f=>n.calculateItemTotal(D)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",lt,[s(V,{modelValue:m.tax,"onUpdate:modelValue":f=>m.tax=f,modelModifiers:{number:!0},type:"number",min:"0",step:"0.01",density:"compact",variant:"outlined","hide-details":"",onInput:f=>n.calculateItemTotal(D)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),e("td",st,r(n.formatCurrency(m.total||0)),1),e("td",at,[s(F,{size:"x-small",icon:"mdi-delete",variant:"text",color:"error",onClick:f=>n.removePurchaseItem(D)},null,8,["onClick"])])]))),128)),a.localForm.items.length===0?(c(),_("tr",ot,t[16]||(t[16]=[e("td",{colspan:"7",class:"text-center py-3 text-grey text-caption"},"No items added",-1)]))):y("",!0),a.localForm.items.length>0?(c(),_("tr",nt,[t[17]||(t[17]=e("td",{colspan:"5",class:"text-right text-body-2 font-weight-bold"},"Subtotal: ",-1)),e("td",it,r(n.formatCurrency(n.calculatedSubtotal)),1),t[18]||(t[18]=e("td",null,null,-1))])):y("",!0),a.localForm.items.length>0?(c(),_("tr",rt,[t[19]||(t[19]=e("td",{colspan:"5",class:"text-right text-caption"},"Tax:",-1)),e("td",ut,r(n.formatCurrency(n.calculatedTax)),1),t[20]||(t[20]=e("td",null,null,-1))])):y("",!0),a.localForm.items.length>0?(c(),_("tr",dt,[t[21]||(t[21]=e("td",{colspan:"5",class:"text-right text-caption"},"Shipping:",-1)),e("td",ct,r(n.formatCurrency(a.localForm.shipping_cost||0)),1),t[22]||(t[22]=e("td",null,null,-1))])):y("",!0),a.localForm.items.length>0?(c(),_("tr",mt,[t[23]||(t[23]=e("td",{colspan:"5",class:"text-right text-caption"},"Discount:",-1)),e("td",pt,r(n.formatCurrency(n.calculatedDiscount)),1),t[24]||(t[24]=e("td",null,null,-1))])):y("",!0),a.localForm.items.length>0?(c(),_("tr",ht,[t[25]||(t[25]=e("td",{colspan:"5",class:"text-right text-body-1 font-weight-bold"},"Total:",-1)),e("td",_t,r(n.formatCurrency(n.calculatedTotal)),1),t[26]||(t[26]=e("td",null,null,-1))])):y("",!0)])]),_:1,__:[27]})])]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),s(q,{class:"pa-3"},{default:o(()=>[s(d),s(F,{onClick:n.handleCancel,variant:"text",density:"compact"},{default:o(()=>t[28]||(t[28]=[p("Cancel")])),_:1,__:[28]},8,["onClick"]),s(F,{onClick:n.handleSave,color:"primary",loading:i.saving,density:"compact"},{default:o(()=>[p(r(i.editingPurchase?"Update":"Create"),1)]),_:1},8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["model-value"])}const gt=M(G,[["render",vt],["__scopeId","data-v-4a62e83e"]]),ft={name:"ViewPurchaseDialog",props:{modelValue:{type:Boolean,default:!1},purchase:{type:Object,default:null}},emits:["update:modelValue"],methods:{formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},formatDate(l){return l?new Date(l).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}):"N/A"},getStatusColor(l){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[l]||"default"}}},yt={class:"pa-6"},bt={class:"text-h6 font-weight-bold"},xt={class:"text-body-1"},wt={class:"text-body-1 font-weight-medium"},Pt={class:"text-body-1 font-weight-medium"},Vt={class:"text-body-1"},kt={class:"text-body-1"},Ft={class:"text-body-1"},Ct={class:"mt-4"},St={class:"font-weight-medium"},Dt={key:0},It={class:"d-flex justify-space-between mb-2"},Tt={class:"text-body-2 font-weight-medium"},Ot={class:"d-flex justify-space-between mb-2"},Ut={class:"text-body-2"},At={class:"d-flex justify-space-between mb-2"},zt={class:"text-body-2"},Nt={class:"d-flex justify-space-between mb-2"},qt={class:"text-body-2"},Bt={class:"d-flex justify-space-between mb-2"},Et={class:"text-h6 font-weight-bold"},jt={class:"d-flex justify-space-between mb-2"},Mt={class:"text-body-2"},Ht={class:"d-flex justify-space-between"};function Lt(l,t,i,I,a,n){const k=u("v-chip"),C=u("v-card-title"),g=u("v-col"),x=u("v-row"),P=u("v-table"),S=u("v-divider"),V=u("v-card-text"),T=u("v-card"),w=u("v-spacer"),b=u("v-btn"),F=u("v-card-actions"),U=u("v-dialog");return c(),v(U,{"model-value":i.modelValue,"onUpdate:modelValue":t[1]||(t[1]=h=>l.$emit("update:modelValue",h)),"max-width":"1000",scrollable:""},{default:o(()=>[i.purchase?(c(),v(T,{key:0},{default:o(()=>[s(C,{class:"d-flex justify-space-between align-center"},{default:o(()=>[t[2]||(t[2]=e("span",null,"Purchase Invoice Details",-1)),s(k,{color:n.getStatusColor(i.purchase.status),size:"small"},{default:o(()=>[p(r(i.purchase.status),1)]),_:1},8,["color"])]),_:1,__:[2]}),s(V,{class:"pa-0"},{default:o(()=>[e("div",yt,[s(x,{class:"mb-4"},{default:o(()=>[s(g,{cols:"12",md:"6"},{default:o(()=>[t[3]||(t[3]=e("div",{class:"text-caption text-grey mb-1"},"Invoice Number",-1)),e("div",bt,r(i.purchase.invoice_number),1)]),_:1,__:[3]}),s(g,{cols:"12",md:"6"},{default:o(()=>[t[4]||(t[4]=e("div",{class:"text-caption text-grey mb-1"},"Invoice Date",-1)),e("div",xt,r(n.formatDate(i.purchase.invoice_date)),1)]),_:1,__:[4]})]),_:1}),s(x,{class:"mb-4"},{default:o(()=>[s(g,{cols:"12",md:"6"},{default:o(()=>{var h;return[t[5]||(t[5]=e("div",{class:"text-caption text-grey mb-1"},"Supplier",-1)),e("div",wt,r(((h=i.purchase.supplier)==null?void 0:h.name)||"N/A"),1)]}),_:1,__:[5]}),s(g,{cols:"12",md:"6"},{default:o(()=>{var h;return[t[6]||(t[6]=e("div",{class:"text-caption text-grey mb-1"},"Warehouse",-1)),e("div",Pt,r(((h=i.purchase.warehouse)==null?void 0:h.name)||"N/A"),1)]}),_:1,__:[6]})]),_:1}),s(x,{class:"mb-4"},{default:o(()=>[i.purchase.grn?(c(),v(g,{key:0,cols:"12",md:"6"},{default:o(()=>{var h;return[t[7]||(t[7]=e("div",{class:"text-caption text-grey mb-1"},"GRN",-1)),e("div",Vt,r(((h=i.purchase.grn)==null?void 0:h.grn_number)||"N/A"),1)]}),_:1,__:[7]})):y("",!0),i.purchase.due_date?(c(),v(g,{key:1,cols:"12",md:"6"},{default:o(()=>[t[8]||(t[8]=e("div",{class:"text-caption text-grey mb-1"},"Due Date",-1)),e("div",kt,r(n.formatDate(i.purchase.due_date)),1)]),_:1,__:[8]})):y("",!0)]),_:1}),i.purchase.notes?(c(),v(x,{key:0,class:"mb-4"},{default:o(()=>[s(g,{cols:"12"},{default:o(()=>[t[9]||(t[9]=e("div",{class:"text-caption text-grey mb-1"},"Notes",-1)),e("div",Ft,r(i.purchase.notes),1)]),_:1,__:[9]})]),_:1})):y("",!0),e("div",Ct,[t[19]||(t[19]=e("h3",{class:"text-h6 mb-3"},"Invoice Items",-1)),s(P,null,{default:o(()=>[t[11]||(t[11]=e("thead",null,[e("tr",null,[e("th",null,"Product"),e("th",null,"SKU"),e("th",null,"Quantity"),e("th",null,"Unit Price"),e("th",null,"Discount"),e("th",null,"Tax"),e("th",null,"Total")])],-1)),e("tbody",null,[(c(!0),_(N,null,E(i.purchase.items,(h,A)=>{var O,d;return c(),_("tr",{key:A},[e("td",null,r(((O=h.product)==null?void 0:O.name)||"N/A"),1),e("td",null,r(((d=h.product)==null?void 0:d.sku)||"N/A"),1),e("td",null,r(h.quantity),1),e("td",null,r(n.formatCurrency(h.unit_price)),1),e("td",null,r(n.formatCurrency(h.discount||0)),1),e("td",null,r(n.formatCurrency(h.tax||0)),1),e("td",St,r(n.formatCurrency(h.total||0)),1)])}),128)),!i.purchase.items||i.purchase.items.length===0?(c(),_("tr",Dt,t[10]||(t[10]=[e("td",{colspan:"7",class:"text-center py-4 text-grey"},"No items found",-1)]))):y("",!0)])]),_:1,__:[11]}),s(x,{class:"mt-4"},{default:o(()=>[s(g,{cols:"12",md:"6","offset-md":"6"},{default:o(()=>[s(T,{variant:"outlined"},{default:o(()=>[s(V,null,{default:o(()=>[e("div",It,[t[12]||(t[12]=e("span",{class:"text-body-2"},"Subtotal:",-1)),e("span",Tt,r(n.formatCurrency(i.purchase.subtotal||0)),1)]),e("div",Ot,[t[13]||(t[13]=e("span",{class:"text-body-2"},"Tax:",-1)),e("span",Ut,r(n.formatCurrency(i.purchase.tax_amount||0)),1)]),e("div",At,[t[14]||(t[14]=e("span",{class:"text-body-2"},"Shipping:",-1)),e("span",zt,r(n.formatCurrency(i.purchase.shipping_cost||0)),1)]),e("div",Nt,[t[15]||(t[15]=e("span",{class:"text-body-2"},"Discount:",-1)),e("span",qt,r(n.formatCurrency(i.purchase.discount_amount||0)),1)]),s(S,{class:"my-2"}),e("div",Bt,[t[16]||(t[16]=e("span",{class:"text-h6 font-weight-bold"},"Total:",-1)),e("span",Et,r(n.formatCurrency(i.purchase.total_amount||0)),1)]),e("div",jt,[t[17]||(t[17]=e("span",{class:"text-body-2"},"Paid:",-1)),e("span",Mt,r(n.formatCurrency(i.purchase.paid_amount||0)),1)]),e("div",Ht,[t[18]||(t[18]=e("span",{class:"text-body-2 font-weight-medium"},"Balance:",-1)),e("span",{class:R(["text-body-2 font-weight-medium",i.purchase.balance_amount>0?"text-warning":"text-success"])},r(n.formatCurrency(i.purchase.balance_amount||0)),3)])]),_:1})]),_:1})]),_:1})]),_:1})])])]),_:1}),s(F,null,{default:o(()=>[s(w),s(b,{onClick:t[0]||(t[0]=h=>l.$emit("update:modelValue",!1)),variant:"text"},{default:o(()=>t[20]||(t[20]=[p("Close")])),_:1,__:[20]})]),_:1})]),_:1})):y("",!0)]),_:1},8,["model-value"])}const Wt=M(ft,[["render",Lt]]),Rt={components:{PurchaseDialog:gt,ViewPurchaseDialog:Wt,PaginationControls:Q},mixins:[H],data(){return{purchases:[],suppliers:[],supplierOptions:[],warehouses:[],warehouseOptions:[],products:[],productOptions:[],statusFilter:null,statusOptions:[{title:"Draft",value:"draft"},{title:"Pending",value:"pending"},{title:"Partial",value:"partial"},{title:"Paid",value:"paid"},{title:"Cancelled",value:"cancelled"}],supplierFilter:null,warehouseFilter:null,dialog:!1,editingPurchase:null,saving:!1,viewDialog:!1,viewingPurchase:null,currentPage:1,perPage:10,perPageOptions:[{title:"10",value:10,description:"Quick view"},{title:"25",value:25,description:"Standard"},{title:"50",value:50,description:"Comfortable"},{title:"100",value:100,description:"Extended"},{title:"500",value:500,description:"Large dataset"},{title:"Show All",value:"all",description:"All records"}],pagination:{current_page:1,last_page:1,per_page:10,total:0}}},async mounted(){await this.loadSuppliers(),await this.loadWarehouses(),await this.loadProducts(),await this.loadPurchases()},methods:{async loadPurchases(){try{this.loading=!0;const l=this.buildPaginationParams();this.perPage==="all"&&(l.per_page=999999),this.search&&(l.search=this.search),this.statusFilter&&(l.status=this.statusFilter),this.supplierFilter&&(l.supplier_id=this.supplierFilter),this.warehouseFilter&&(l.warehouse_id=this.warehouseFilter);const t=await this.$axios.get("/api/v1/purchases",{params:l,headers:this.getAuthHeaders()});this.purchases=t.data.data||[],this.updatePagination(t.data)}catch(l){this.handleApiError(l,"Failed to load purchases")}finally{this.loading=!1}},async loadSuppliers(){try{const l=await this.$axios.get("/api/v1/suppliers",{params:{per_page:1e3},headers:this.getAuthHeaders()}),t=l.data.data||l.data||[];this.suppliers=t,this.supplierOptions=t.map(i=>({label:i.name,value:i.id}))}catch(l){console.error("Error loading suppliers:",l)}},async loadWarehouses(){try{const l=await this.$axios.get("/api/v1/stock-ledger/warehouses",{headers:this.getAuthHeaders()});this.warehouses=l.data.warehouses||[],this.warehouseOptions=this.warehouses.map(t=>({label:t.name,value:t.id}))}catch(l){console.error("Error loading warehouses:",l)}},async loadProducts(){try{const l=await this.$axios.get("/api/v1/products",{params:{per_page:1e3,is_active:!0},headers:this.getAuthHeaders()});this.products=l.data.data||[],this.productOptions=this.products.map(t=>({label:`${t.name} (${t.sku})`,value:t.id}))}catch(l){console.error("Error loading products:",l)}},openDialog(l){this.editingPurchase=l||null,this.dialog=!0},closeDialog(){this.dialog=!1,this.editingPurchase=null},async handleSavePurchase(l,t){if(t){this.showError(t);return}this.saving=!0;try{const i=localStorage.getItem("admin_token"),I=this.editingPurchase?`/api/v1/purchases/${this.editingPurchase.id}`:"/api/v1/purchases",a=this.editingPurchase?"put":"post";await axios[a](I,l,{headers:{Authorization:`Bearer ${i}`}}),this.showSuccess(this.editingPurchase?"Purchase updated successfully":"Purchase created successfully"),this.closeDialog(),await this.loadPurchases()}catch(i){this.handleApiError(i,"Error saving purchase")}finally{this.saving=!1}},async receivePurchase(l){if(confirm(`Receive stock for purchase ${l.invoice_number}? This will update stock levels.`))try{const t=localStorage.getItem("admin_token");await this.$axios.post(`/api/v1/purchases/${l.id}/receive`,{},{headers:{Authorization:`Bearer ${t}`}}),this.showSuccess("Purchase received and stock updated successfully"),await this.loadPurchases()}catch(t){this.handleApiError(t,"Error receiving purchase")}},async deletePurchase(l){if(confirm(`Delete purchase ${l.invoice_number}?`))try{const t=localStorage.getItem("admin_token");await this.$axios.delete(`/api/v1/purchases/${l.id}`,{headers:{Authorization:`Bearer ${t}`}}),this.showSuccess("Purchase deleted successfully"),await this.loadPurchases()}catch(t){this.handleApiError(t,"Error deleting purchase")}},async viewPurchase(l){try{const t=await this.$axios.get(`/api/v1/purchases/${l.id}`,{headers:this.getAuthHeaders()});this.viewingPurchase=t.data,this.viewDialog=!0}catch(t){this.handleApiError(t,"Failed to load purchase details")}},formatCurrency(l){return l==null?"৳0.00":"৳"+new Intl.NumberFormat("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}).format(l)},getStatusColor(l){return{draft:"grey",pending:"warning",partial:"info",paid:"success",cancelled:"error"}[l]||"default"},buildPaginationParams(l={}){return j.buildPaginationParams(this.currentPage,this.perPage,l,this.sortBy,this.sortDirection)},updatePagination(l){j.updatePagination(this,l)},resetPagination(){j.resetPagination(this)},onPerPageUpdate(l){this.perPage=l,this.onPerPageChange()},onPageChange(l){this.currentPage=l,this.loadPurchases()},onPerPageChange(){this.resetPagination(),this.loadPurchases()},onSort(l){this.handleSort(l),this.currentPage=1,this.loadPurchases()}}},Qt={class:"page-header"},Gt={class:"text-caption text-grey"},Kt={class:"sortable-header"},Jt={class:"sortable-header"},Xt={class:"sortable-header"},Yt={class:"sortable-header justify-end"},Zt={key:0},$t={class:"d-flex flex-column flex-md-row justify-space-between align-center align-md-start gap-3 mt-4"},te={class:"text-caption text-grey"},ee={key:0},le={key:0},se={key:1},ae={key:1};function oe(l,t,i,I,a,n){const k=u("v-btn"),C=u("v-select"),g=u("v-col"),x=u("v-text-field"),P=u("v-row"),S=u("v-card-text"),V=u("v-card"),T=u("v-card-title"),w=u("v-icon"),b=u("v-skeleton-loader"),F=u("v-chip"),U=u("v-table"),h=u("PaginationControls"),A=u("PurchaseDialog"),O=u("ViewPurchaseDialog");return c(),_("div",null,[e("div",Qt,[t[13]||(t[13]=e("h1",{class:"text-h4 page-title"},"Supplier Invoices (Purchases)",-1)),s(k,{color:"primary","prepend-icon":"mdi-plus",onClick:t[0]||(t[0]=d=>n.openDialog(null)),class:"add-button"},{default:o(()=>t[12]||(t[12]=[p(" New Purchase Invoice ")])),_:1,__:[12]})]),s(V,{class:"mb-4"},{default:o(()=>[s(S,null,{default:o(()=>[s(P,null,{default:o(()=>[s(g,{cols:"12",md:"3"},{default:o(()=>[s(C,{modelValue:a.statusFilter,"onUpdate:modelValue":[t[1]||(t[1]=d=>a.statusFilter=d),n.loadPurchases],items:a.statusOptions,label:"Filter by Status",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:o(()=>[s(C,{modelValue:a.supplierFilter,"onUpdate:modelValue":[t[2]||(t[2]=d=>a.supplierFilter=d),n.loadPurchases],items:a.supplierOptions,label:"Filter by Supplier",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:o(()=>[s(C,{modelValue:a.warehouseFilter,"onUpdate:modelValue":[t[3]||(t[3]=d=>a.warehouseFilter=d),n.loadPurchases],items:a.warehouseOptions,label:"Filter by Warehouse",variant:"outlined",density:"compact",clearable:""},null,8,["modelValue","items","onUpdate:modelValue"])]),_:1}),s(g,{cols:"12",md:"3"},{default:o(()=>[s(x,{modelValue:l.search,"onUpdate:modelValue":t[4]||(t[4]=d=>l.search=d),label:"Search by invoice number","prepend-inner-icon":"mdi-magnify",variant:"outlined",density:"compact",clearable:"",onInput:n.loadPurchases},null,8,["modelValue","onInput"])]),_:1})]),_:1})]),_:1})]),_:1}),s(V,null,{default:o(()=>[s(T,{class:"d-flex justify-space-between align-center"},{default:o(()=>[t[15]||(t[15]=e("span",null,"Supplier Invoices",-1)),e("span",Gt,[t[14]||(t[14]=p(" Total Records: ")),e("strong",null,r(a.pagination.total||0),1)])]),_:1,__:[15]}),s(S,null,{default:o(()=>[s(U,null,{default:o(()=>[e("thead",null,[e("tr",null,[e("th",{class:"sortable",onClick:t[5]||(t[5]=d=>n.onSort("invoice_number"))},[e("div",Kt,[t[17]||(t[17]=e("span",null,"Invoice #",-1)),l.sortBy==="invoice_number"?(c(),v(w,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(w,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[16]||(t[16]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[16]}))])]),t[24]||(t[24]=e("th",null,"Supplier",-1)),t[25]||(t[25]=e("th",null,"Warehouse",-1)),e("th",{class:"sortable",onClick:t[6]||(t[6]=d=>n.onSort("invoice_date"))},[e("div",Jt,[t[19]||(t[19]=e("span",null,"Invoice Date",-1)),l.sortBy==="invoice_date"?(c(),v(w,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(w,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[18]||(t[18]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[18]}))])]),e("th",{class:"sortable",onClick:t[7]||(t[7]=d=>n.onSort("status"))},[e("div",Xt,[t[21]||(t[21]=e("span",null,"Status",-1)),l.sortBy==="status"?(c(),v(w,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(w,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[20]||(t[20]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[20]}))])]),e("th",{class:"text-end sortable",onClick:t[8]||(t[8]=d=>n.onSort("total_amount"))},[e("div",Yt,[t[23]||(t[23]=e("span",null,"Total Amount",-1)),l.sortBy==="total_amount"?(c(),v(w,{key:0,size:"18",class:"sort-icon active"},{default:o(()=>[p(r(l.sortDirection==="asc"?"mdi-arrow-up":"mdi-arrow-down"),1)]),_:1})):(c(),v(w,{key:1,size:"18",class:"sort-icon inactive"},{default:o(()=>t[22]||(t[22]=[p(" mdi-unfold-more-horizontal ")])),_:1,__:[22]}))])]),t[26]||(t[26]=e("th",{class:"text-end"},[e("span",null,"Paid")],-1)),t[27]||(t[27]=e("th",{class:"text-end"},[e("span",null,"Balance")],-1)),t[28]||(t[28]=e("th",null,"Actions",-1))])]),e("tbody",null,[l.loading?(c(),_(N,{key:0},E(5,d=>e("tr",{key:`skeleton-${d}`},[e("td",null,[s(b,{type:"text",width:"120"})]),e("td",null,[s(b,{type:"text",width:"150"})]),e("td",null,[s(b,{type:"text",width:"100"})]),e("td",null,[s(b,{type:"text",width:"100"})]),e("td",null,[s(b,{type:"chip",width:"80",height:"24"})]),e("td",null,[s(b,{type:"text",width:"100"})]),e("td",null,[s(b,{type:"text",width:"100"})]),e("td",null,[s(b,{type:"text",width:"100"})]),e("td",null,[s(b,{type:"button",width:"32",height:"32"})])])),64)):(c(),_(N,{key:1},[(c(!0),_(N,null,E(a.purchases,d=>{var q,B;return c(),_("tr",{key:d.id},[e("td",null,r(d.invoice_number),1),e("td",null,r((q=d.supplier)==null?void 0:q.name),1),e("td",null,r((B=d.warehouse)==null?void 0:B.name),1),e("td",null,r(l.formatDate(d.invoice_date)),1),e("td",null,[s(F,{color:n.getStatusColor(d.status),size:"small"},{default:o(()=>[p(r(d.status),1)]),_:2},1032,["color"])]),e("td",null,r(n.formatCurrency(d.total_amount)),1),e("td",null,r(n.formatCurrency(d.paid_amount)),1),e("td",null,[s(F,{color:d.balance_amount>0?"warning":"success",size:"small"},{default:o(()=>[p(r(n.formatCurrency(d.balance_amount)),1)]),_:2},1032,["color"])]),e("td",null,[s(k,{size:"small",icon:"mdi-eye",onClick:z=>n.viewPurchase(d),variant:"text",title:"View"},null,8,["onClick"]),d.status==="draft"?(c(),v(k,{key:0,size:"small",icon:"mdi-pencil",onClick:z=>n.openDialog(d),variant:"text",title:"Edit"},null,8,["onClick"])):y("",!0),d.status==="draft"?(c(),v(k,{key:1,size:"small",icon:"mdi-package-variant",onClick:z=>n.receivePurchase(d),variant:"text",color:"success",title:"Receive Stock"},null,8,["onClick"])):y("",!0),d.status==="draft"?(c(),v(k,{key:2,size:"small",icon:"mdi-delete",onClick:z=>n.deletePurchase(d),variant:"text",color:"error",title:"Delete"},null,8,["onClick"])):y("",!0)])])}),128)),a.purchases.length===0?(c(),_("tr",Zt,t[29]||(t[29]=[e("td",{colspan:"9",class:"text-center py-4"},"No purchases found",-1)]))):y("",!0)],64))])]),_:1}),e("div",$t,[e("div",te,[a.purchases.length>0&&a.pagination.total>0?(c(),_("span",ee,[a.perPage==="all"?(c(),_("span",le,[t[30]||(t[30]=p(" Showing ")),e("strong",null,"all "+r(a.pagination.total.toLocaleString()),1),t[31]||(t[31]=p(" records "))])):(c(),_("span",se,[t[32]||(t[32]=p(" Showing ")),e("strong",null,r((a.currentPage-1)*a.perPage+1),1),t[33]||(t[33]=p(" to ")),e("strong",null,r(Math.min(a.currentPage*a.perPage,a.pagination.total)),1),t[34]||(t[34]=p(" of ")),e("strong",null,r(a.pagination.total.toLocaleString()),1),t[35]||(t[35]=p(" records "))]))])):(c(),_("span",ae,"No records found"))]),s(h,{modelValue:a.currentPage,"onUpdate:modelValue":t[9]||(t[9]=d=>a.currentPage=d),pagination:a.pagination,"per-page-value":a.perPage,"per-page-options":a.perPageOptions,"onUpdate:perPage":n.onPerPageUpdate,onPageChange:n.onPageChange},null,8,["modelValue","pagination","per-page-value","per-page-options","onUpdate:perPage","onPageChange"])])]),_:1})]),_:1}),s(A,{modelValue:a.dialog,"onUpdate:modelValue":t[10]||(t[10]=d=>a.dialog=d),"editing-purchase":a.editingPurchase,"supplier-options":a.supplierOptions,"warehouse-options":a.warehouseOptions,"product-options":a.productOptions,saving:a.saving,onSave:n.handleSavePurchase,onCancel:n.closeDialog},null,8,["modelValue","editing-purchase","supplier-options","warehouse-options","product-options","saving","onSave","onCancel"]),s(O,{modelValue:a.viewDialog,"onUpdate:modelValue":t[11]||(t[11]=d=>a.viewDialog=d),purchase:a.viewingPurchase},null,8,["modelValue","purchase"])])}const de=M(Rt,[["render",oe],["__scopeId","data-v-1bd7696d"]]);export{de as default};
