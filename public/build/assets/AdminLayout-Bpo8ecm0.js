import{h as z}from"./moment-C5S46NFB.js";import{_ as E,c as A,a as t,w as o,b as c,d,e as m,r as n,f as p,t as g,m as h,g as F,u as L,o as l}from"./app-CHlE1Mvy.js";import{r as j}from"./uploads-CnEkgyD_.js";import{U as q}from"./UserProfileDialog-BQc6qEnp.js";const G={components:{UserProfileDialog:q},data(){return{drawer:!0,authStore:null,currentUser:null,userRoles:[],userPermissions:[],currentDate:z().format("Do MMMM YYYY"),currentYear:new Date().getFullYear(),brandingLogo:null,siteName:null,profileDialogVisible:!1,footerPoweredByText:null,footerVersion:null,footerCopyrightText:null}},computed:{resolvedBrandingLogo(){return this.brandingLogo?this.resolveImageUrl(this.brandingLogo):null},resolvedUserAvatar(){return!this.currentUser||!this.currentUser.avatar?null:this.resolveImageUrl(this.currentUser.avatar)}},methods:{async loadUser(){var u;try{const e=localStorage.getItem("admin_token");if(!e){this.$router.push("/admin/login");return}const _=await this.$axios.get("/api/v1/auth/user",{headers:{Authorization:`Bearer ${e}`}});this.currentUser=_.data,this.userRoles=_.data.roles||[],this.authStore&&(this.authStore.user=_.data,this.authStore.token=e,this.authStore.isAuthenticated=!0,this.authStore.extractRolesAndPermissions(_.data)),this.userPermissions=[],this.userRoles&&this.userRoles.length>0&&this.userRoles.forEach(f=>{f.permissions&&f.permissions.length>0&&f.permissions.forEach(r=>{this.userPermissions.includes(r.slug)||this.userPermissions.push(r.slug)})})}catch(e){console.error("Error loading user:",e),((u=e.response)==null?void 0:u.status)===401&&(localStorage.removeItem("admin_token"),this.$router.push("/admin/login"))}},async loadSettings(){try{const u=localStorage.getItem("admin_token");if(!u)return;const e=await this.$axios.get("/api/v1/settings",{headers:{Authorization:`Bearer ${u}`}});e.data.general&&e.data.general.site_name&&e.data.general.site_name.value?this.siteName=e.data.general.site_name.value:this.siteName=null,e.data.branding&&e.data.branding.logo&&e.data.branding.logo.value?this.brandingLogo=e.data.branding.logo.value:this.brandingLogo=null,e.data.footer?(e.data.footer.powered_by_text&&e.data.footer.powered_by_text.value?this.footerPoweredByText=e.data.footer.powered_by_text.value:this.footerPoweredByText=null,e.data.footer.version&&e.data.footer.version.value?this.footerVersion=e.data.footer.version.value:this.footerVersion=null,e.data.footer.copyright_text&&e.data.footer.copyright_text.value?this.footerCopyrightText=e.data.footer.copyright_text.value:this.footerCopyrightText=null):(this.footerPoweredByText=null,this.footerVersion=null,this.footerCopyrightText=null)}catch(u){console.error("Error loading settings:",u)}},async logout(){await L().logout(),this.currentUser=null,this.userRoles=[],this.userPermissions=[],this.$router.push("/admin/login")},hasPermission(u){return this.authStore&&(this.authStore.hasRole&&this.authStore.hasRole(["administrator"])||this.authStore.hasPermission&&this.authStore.hasPermission(u))?!0:!this.currentUser||!this.userPermissions||this.userPermissions.length===0?!1:this.userRoles&&this.userRoles.length>0&&this.userRoles.some(e=>e.slug==="administrator")?!0:this.userPermissions.includes(u)},resolveImageUrl(u){return j(u)},showProfileDialog(){this.profileDialogVisible=!0}},mounted(){this.authStore=L(),localStorage.getItem("admin_token")?(this.loadUser(),this.loadSettings()):this.$router.push("/admin/login")},watch:{$route(u,e){(u.name==="AdminSettings"||e&&e.name==="AdminSettings")&&this.loadSettings()}}},H={class:"pa-2"},J={key:1,class:"d-flex align-center mr-4"},K={class:"footer-content"},O={class:"footer-brand"},Q={class:"logo-wrapper"},W=["src"],X={class:"brand-text"},Z={class:"brand-name"},$={class:"footer-info"},ee={class:"version-badge"},te={class:"copyright-text"};function oe(u,e,_,f,r,a){const y=n("v-img"),b=n("v-avatar"),P=n("v-list-item-title"),s=n("v-list-item"),w=n("v-divider"),v=n("v-list-group"),x=n("v-list"),k=n("v-icon"),R=n("v-btn"),V=n("v-navigation-drawer"),C=n("v-app-bar-nav-icon"),U=n("v-chip"),S=n("v-spacer"),D=n("v-menu"),B=n("v-app-bar"),T=n("router-view"),I=n("v-container"),M=n("v-main"),N=n("v-footer"),Y=n("UserProfileDialog");return l(),A("div",null,[t(V,{modelValue:r.drawer,"onUpdate:modelValue":e[1]||(e[1]=i=>r.drawer=i),class:"gradient_color",location:"left",permanent:"","hide-overlay":"",app:"",dark:""},{append:o(()=>[c("div",H,[t(R,{link:"",router:"",onClick:e[0]||(e[0]=i=>a.logout()),class:"logout-btn text-black",size:"small",block:""},{default:o(()=>[t(k,{left:""},{default:o(()=>e[5]||(e[5]=[p("mdi-logout")])),_:1,__:[5]}),e[6]||(e[6]=p("Logout "))]),_:1,__:[6]})])]),default:o(()=>[e[7]||(e[7]=c("div",{class:"sidebar-shapes"},[c("div",{class:"shape shape-1"}),c("div",{class:"shape shape-2"}),c("div",{class:"shape shape-3"})],-1)),r.currentUser?(l(),d(s,{key:0,class:"user-profile-header"},{prepend:o(()=>[t(b,{size:"48",class:"mr-3"},{default:o(()=>[t(y,{src:a.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"Logo",cover:""},null,8,["src"])]),_:1})]),default:o(()=>[t(P,{class:"text-h6 font-weight-bold"},{default:o(()=>[p(g(r.siteName||"Admin Panel"),1)]),_:1})]),_:1})):m("",!0),t(w,{class:"my-0 divider-glow"}),r.currentUser&&r.userPermissions.length>0?(l(),d(x,{key:1,density:"compact",nav:""},{default:o(()=>[a.hasPermission("access-dashboard")?(l(),d(s,{key:0,link:"",router:"","prepend-icon":"mdi-view-dashboard",title:"Dashboard",to:{name:"AdminDashboard"},value:"Dashboard",exact:""})):m("",!0),a.hasPermission("manage-users")?(l(),d(s,{key:1,link:"",router:"","prepend-icon":"mdi-account-group",title:"Users",to:{name:"AdminUsers"},value:"Users",exact:""})):m("",!0),a.hasPermission("manage-roles")?(l(),d(v,{key:2,value:"roles","prepend-icon":"mdi-shield-account","no-action":""},{activator:o(({props:i})=>[t(s,h(i,{title:"Roles & Permissions"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-shield-account",title:"Roles",to:{name:"AdminRoles"}}),t(s,{"prepend-icon":"mdi-key",title:"Permissions",to:{name:"AdminPermissions"}})]),_:1})):m("",!0),a.hasPermission("view-products")?(l(),d(v,{key:3,value:"inventory","prepend-icon":"mdi-package-variant","no-action":""},{activator:o(({props:i})=>[t(s,h(i,{title:"Inventory"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-package",title:"Products",to:{name:"AdminProducts"}}),t(s,{"prepend-icon":"mdi-folder-multiple",title:"Categories",to:{name:"AdminCategories"}})]),_:1})):m("",!0),a.hasPermission("view-stock-ledger")?(l(),d(v,{key:4,value:"stock","prepend-icon":"mdi-warehouse","no-action":""},{activator:o(({props:i})=>[t(s,h(i,{title:"Stock Management"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-book-open-variant",title:"Stock Ledger",to:{name:"AdminStockLedger"}})]),_:1})):m("",!0),a.hasPermission("view-purchases")?(l(),d(v,{key:5,value:"purchase","prepend-icon":"mdi-cart-arrow-down","no-action":""},{activator:o(({props:i})=>[t(s,h(i,{title:"Purchase Management"}),null,16)]),default:o(()=>[t(s,{"prepend-icon":"mdi-receipt",title:"Supplier Invoices",to:{name:"AdminPurchases"}})]),_:1})):m("",!0),a.hasPermission("manage-suppliers")||a.hasPermission("manage-customers")?(l(),d(v,{key:6,value:"master","prepend-icon":"mdi-database","no-action":""},{activator:o(({props:i})=>[t(s,h(i,{title:"Master Data"}),null,16)]),default:o(()=>[a.hasPermission("manage-suppliers")?(l(),d(s,{key:0,"prepend-icon":"mdi-truck-delivery",title:"Suppliers",to:{name:"AdminSuppliers"}})):m("",!0),a.hasPermission("manage-customers")?(l(),d(s,{key:1,"prepend-icon":"mdi-account-group",title:"Customers",to:{name:"AdminCustomers"}})):m("",!0)]),_:1})):m("",!0),a.hasPermission("manage-settings")?(l(),d(s,{key:7,link:"",router:"","prepend-icon":"mdi-cog",title:"Settings",to:{name:"AdminSettings"},value:"Settings",exact:""})):m("",!0),a.hasPermission("view-login-logs")?(l(),d(s,{key:8,link:"",router:"","prepend-icon":"mdi-login",title:"Login Logs",to:{name:"AdminLoginLogs"},value:"Login Logs",exact:""})):m("",!0)]),_:1})):m("",!0)]),_:1,__:[7]},8,["modelValue"]),t(B,{app:"",flat:"",density:"compact",class:"gradient_color app-bar-modern"},{default:o(()=>[t(C,{onClick:e[2]||(e[2]=F(i=>r.drawer=!r.drawer,["stop"]))}),t(U,{class:"mx-2 date-chip"},{default:o(()=>[p(g(r.currentDate),1)]),_:1}),t(S),r.currentUser&&r.userRoles&&r.userRoles.some(i=>i.slug==="administrator")?(l(),d(U,{key:0,"prepend-icon":"mdi-shield-account"},{default:o(()=>e[8]||(e[8]=[p("Administrator")])),_:1,__:[8]})):m("",!0),t(S),r.currentUser?(l(),A("div",J,[t(D,{"open-on-hover":""},{activator:o(({props:i})=>[t(b,h(i,{size:"42",class:"fill-image mr-2",title:r.currentUser.name}),{default:o(()=>[r.currentUser.avatar?(l(),d(y,{key:0,cover:"",src:a.resolvedUserAvatar,alt:r.currentUser.name},null,8,["src","alt"])):(l(),d(y,{key:1,cover:"",src:"/assets/logo/logo.png",alt:"image"}))]),_:2},1040,["title"])]),default:o(()=>[t(x,null,{default:o(()=>[t(s,{onClick:a.showProfileDialog,style:{cursor:"pointer"}},{prepend:o(()=>[t(k,null,{default:o(()=>e[9]||(e[9]=[p("mdi-account")])),_:1,__:[9]})]),append:o(()=>[t(k,{size:"small"},{default:o(()=>e[10]||(e[10]=[p("mdi-chevron-right")])),_:1,__:[10]})]),default:o(()=>[t(P,null,{default:o(()=>[p(g(r.currentUser.name),1)]),_:1})]),_:1},8,["onClick"]),t(w,{class:"my-2"}),t(s,{link:"",router:"",onClick:e[3]||(e[3]=i=>a.logout())},{prepend:o(()=>[t(k,null,{default:o(()=>e[11]||(e[11]=[p("mdi-logout")])),_:1,__:[11]})]),default:o(()=>[t(P,null,{default:o(()=>e[12]||(e[12]=[p("Logout")])),_:1,__:[12]})]),_:1})]),_:1})]),_:1})])):m("",!0)]),_:1}),t(M,null,{default:o(()=>[t(I,{fluid:""},{default:o(()=>[t(T)]),_:1})]),_:1}),t(N,{class:"footer-modern gradient_color rtl-footer",app:""},{default:o(()=>[c("div",K,[c("div",O,[c("div",Q,[c("img",{src:a.resolvedBrandingLogo||"/assets/logo/logo.png",alt:"cpb-it",height:"24",class:"footer-logo"},null,8,W)]),c("div",X,[c("span",Z,g(r.footerPoweredByText||"Powered By CPB-IT"),1)])]),e[13]||(e[13]=c("div",{class:"footer-divider"},null,-1)),c("div",$,[c("span",ee,g(r.footerVersion||"v1.0"),1),c("span",te,"Â© "+g(r.currentYear)+" "+g(r.footerCopyrightText||"All Rights Reserved"),1)])])]),_:1}),t(Y,{modelValue:r.profileDialogVisible,"onUpdate:modelValue":e[4]||(e[4]=i=>r.profileDialogVisible=i),user:r.currentUser},null,8,["modelValue","user"])])}const ae=E(G,[["render",oe],["__scopeId","data-v-0b2a50ed"]]);export{ae as default};
